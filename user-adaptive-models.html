<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9.4 User-Adaptive Models | Behavior Analysis with Machine Learning and R</title>
  <meta name="description" content="9.4 User-Adaptive Models | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors or stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="9.4 User-Adaptive Models | Behavior Analysis with Machine Learning and R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="9.4 User-Adaptive Models | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors or stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9.4 User-Adaptive Models | Behavior Analysis with Machine Learning and R" />
  
  <meta name="twitter:description" content="9.4 User-Adaptive Models | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors or stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Enrique Garcia Ceja" />


<meta name="date" content="2020-09-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="user-dependent-models.html"/>
<link rel="next" href="SummaryMultiUser.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/d3-4.9.0/d3.min.js"></script>
<script src="libs/d3-tip-0.7.1/index-min.js"></script>
<link href="libs/d3panels-1.4.9/d3panels.min.css" rel="stylesheet" />
<script src="libs/d3panels-1.4.9/d3panels.min.js"></script>
<script src="libs/qtlcharts_iplotCorr-0.11.6/iplotCorr.js"></script>
<script src="libs/qtlcharts_iplotCorr-0.11.6/iplotCorr_noscat.js"></script>
<script src="libs/iplotCorr-binding-0.11.6/iplotCorr.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-178679335-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178679335-1', { 'anonymize_ip': true });
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="#">Behavior Analysis with Machine Learning and R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#supplemental-material"><i class="fa fa-check"></i>Supplemental Material</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html"><i class="fa fa-check"></i><b>1.1</b> What is Machine Learning?</a></li>
<li class="chapter" data-level="1.2" data-path="taxonomy.html"><a href="taxonomy.html"><i class="fa fa-check"></i><b>1.2</b> Types of Machine Learning</a></li>
<li class="chapter" data-level="1.3" data-path="terminology.html"><a href="terminology.html"><i class="fa fa-check"></i><b>1.3</b> Terminology</a><ul>
<li class="chapter" data-level="1.3.1" data-path="terminology.html"><a href="terminology.html#tables"><i class="fa fa-check"></i><b>1.3.1</b> Tables</a></li>
<li class="chapter" data-level="1.3.2" data-path="terminology.html"><a href="terminology.html#variable-types"><i class="fa fa-check"></i><b>1.3.2</b> Variable types</a></li>
<li class="chapter" data-level="1.3.3" data-path="terminology.html"><a href="terminology.html#predictive-models"><i class="fa fa-check"></i><b>1.3.3</b> Predictive Models</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="pipeline.html"><a href="pipeline.html"><i class="fa fa-check"></i><b>1.4</b> Data Analysis Pipeline</a></li>
<li class="chapter" data-level="1.5" data-path="trainingeval.html"><a href="trainingeval.html"><i class="fa fa-check"></i><b>1.5</b> Evaluating Predictive Models</a></li>
<li class="chapter" data-level="1.6" data-path="simple-classification-example.html"><a href="simple-classification-example.html"><i class="fa fa-check"></i><b>1.6</b> Simple Classification Example</a><ul>
<li class="chapter" data-level="1.6.1" data-path="simple-classification-example.html"><a href="simple-classification-example.html#k-fold-cross-validation-example"><i class="fa fa-check"></i><b>1.6.1</b> K-fold Cross-Validation Example</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="simple-regression-example.html"><a href="simple-regression-example.html"><i class="fa fa-check"></i><b>1.7</b> Simple Regression Example</a></li>
<li class="chapter" data-level="1.8" data-path="underfitting-and-overfitting.html"><a href="underfitting-and-overfitting.html"><i class="fa fa-check"></i><b>1.8</b> Underfitting and Overfitting</a></li>
<li class="chapter" data-level="1.9" data-path="bias-and-variance.html"><a href="bias-and-variance.html"><i class="fa fa-check"></i><b>1.9</b> Bias and Variance</a></li>
<li class="chapter" data-level="1.10" data-path="SummaryIntro.html"><a href="SummaryIntro.html"><i class="fa fa-check"></i><b>1.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>2</b> Predicting Behavior with Classification Models</a><ul>
<li class="chapter" data-level="2.1" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html"><i class="fa fa-check"></i><b>2.1</b> <em>k</em>-nearest Neighbors</a><ul>
<li class="chapter" data-level="2.1.1" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html#indoor-location-with-wi-fi-signals"><i class="fa fa-check"></i><b>2.1.1</b> Indoor Location with Wi-Fi Signals</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="performance-metrics.html"><a href="performance-metrics.html"><i class="fa fa-check"></i><b>2.2</b> Performance Metrics</a></li>
<li class="chapter" data-level="2.3" data-path="decision-trees.html"><a href="decision-trees.html"><i class="fa fa-check"></i><b>2.3</b> Decision Trees</a><ul>
<li class="chapter" data-level="2.3.1" data-path="decision-trees.html"><a href="decision-trees.html#activityRecognition"><i class="fa fa-check"></i><b>2.3.1</b> Activity Recognition with Smartphones</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="dynamic-time-warping.html"><a href="dynamic-time-warping.html"><i class="fa fa-check"></i><b>2.4</b> Dynamic Time Warping</a><ul>
<li class="chapter" data-level="2.4.1" data-path="dynamic-time-warping.html"><a href="dynamic-time-warping.html#sechandgestures"><i class="fa fa-check"></i><b>2.4.1</b> Hand Gesture Recognition</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summaryClassification.html"><a href="summaryClassification.html"><i class="fa fa-check"></i><b>2.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ensemble.html"><a href="ensemble.html"><i class="fa fa-check"></i><b>3</b> Predicting Behavior with Ensemble Learning</a><ul>
<li class="chapter" data-level="3.1" data-path="bagging.html"><a href="bagging.html"><i class="fa fa-check"></i><b>3.1</b> Bagging</a><ul>
<li class="chapter" data-level="3.1.1" data-path="bagging.html"><a href="bagging.html#activity-recognition-with-bagging"><i class="fa fa-check"></i><b>3.1.1</b> Activity recognition with Bagging</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="random-forest.html"><a href="random-forest.html"><i class="fa fa-check"></i><b>3.2</b> Random Forest</a></li>
<li class="chapter" data-level="3.3" data-path="stacked-generalization.html"><a href="stacked-generalization.html"><i class="fa fa-check"></i><b>3.3</b> Stacked Generalization</a></li>
<li class="chapter" data-level="3.4" data-path="multiviewhometasks.html"><a href="multiviewhometasks.html"><i class="fa fa-check"></i><b>3.4</b> Multi-view Stacking for Home Tasks Recognition</a></li>
<li class="chapter" data-level="3.5" data-path="SummaryEnsemble.html"><a href="SummaryEnsemble.html"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="edavis.html"><a href="edavis.html"><i class="fa fa-check"></i><b>4</b> Exploring and Visualizing Behavioral Data</a><ul>
<li class="chapter" data-level="4.1" data-path="talking-with-field-experts.html"><a href="talking-with-field-experts.html"><i class="fa fa-check"></i><b>4.1</b> Talking with field experts</a></li>
<li class="chapter" data-level="4.2" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>4.2</b> Summary Statistics</a></li>
<li class="chapter" data-level="4.3" data-path="class-distributions.html"><a href="class-distributions.html"><i class="fa fa-check"></i><b>4.3</b> Class Distributions</a></li>
<li class="chapter" data-level="4.4" data-path="user-class-sparsity-matrix.html"><a href="user-class-sparsity-matrix.html"><i class="fa fa-check"></i><b>4.4</b> User-Class Sparsity Matrix</a></li>
<li class="chapter" data-level="4.5" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>4.5</b> Boxplots</a></li>
<li class="chapter" data-level="4.6" data-path="correlation-plots.html"><a href="correlation-plots.html"><i class="fa fa-check"></i><b>4.6</b> Correlation Plots</a><ul>
<li class="chapter" data-level="4.6.1" data-path="correlation-plots.html"><a href="correlation-plots.html#interactive-correlation-plots"><i class="fa fa-check"></i><b>4.6.1</b> Interactive Correlation Plots</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="timeseries.html"><a href="timeseries.html"><i class="fa fa-check"></i><b>4.7</b> Timeseries</a><ul>
<li class="chapter" data-level="4.7.1" data-path="timeseries.html"><a href="timeseries.html#interactive-timeseries"><i class="fa fa-check"></i><b>4.7.1</b> Interactive Timeseries</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="multidimensional-scaling-mds.html"><a href="multidimensional-scaling-mds.html"><i class="fa fa-check"></i><b>4.8</b> Multidimensional Scaling (MDS)</a></li>
<li class="chapter" data-level="4.9" data-path="heatmaps.html"><a href="heatmaps.html"><i class="fa fa-check"></i><b>4.9</b> Heatmaps</a></li>
<li class="chapter" data-level="4.10" data-path="automated-eda.html"><a href="automated-eda.html"><i class="fa fa-check"></i><b>4.10</b> Automated EDA</a></li>
<li class="chapter" data-level="4.11" data-path="SummaryExploratory.html"><a href="SummaryExploratory.html"><i class="fa fa-check"></i><b>4.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i><b>5</b> Preprocessing Behavioral Data</a><ul>
<li class="chapter" data-level="5.1" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>5.1</b> Missing Values</a><ul>
<li class="chapter" data-level="5.1.1" data-path="missing-values.html"><a href="missing-values.html#imputation"><i class="fa fa-check"></i><b>5.1.1</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="smoothing.html"><a href="smoothing.html"><i class="fa fa-check"></i><b>5.2</b> Smoothing</a></li>
<li class="chapter" data-level="5.3" data-path="normalization.html"><a href="normalization.html"><i class="fa fa-check"></i><b>5.3</b> Normalization</a></li>
<li class="chapter" data-level="5.4" data-path="imbalanced-classes.html"><a href="imbalanced-classes.html"><i class="fa fa-check"></i><b>5.4</b> Imbalanced Classes</a><ul>
<li class="chapter" data-level="5.4.1" data-path="imbalanced-classes.html"><a href="imbalanced-classes.html#random-oversampling"><i class="fa fa-check"></i><b>5.4.1</b> Random oversampling</a></li>
<li class="chapter" data-level="5.4.2" data-path="imbalanced-classes.html"><a href="imbalanced-classes.html#smote"><i class="fa fa-check"></i><b>5.4.2</b> SMOTE</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="infoinjection.html"><a href="infoinjection.html"><i class="fa fa-check"></i><b>5.5</b> Information Injection</a></li>
<li class="chapter" data-level="5.6" data-path="one-hot-encoding.html"><a href="one-hot-encoding.html"><i class="fa fa-check"></i><b>5.6</b> One-hot Encoding</a></li>
<li class="chapter" data-level="5.7" data-path="SummaryPreprocessing.html"><a href="SummaryPreprocessing.html"><i class="fa fa-check"></i><b>5.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unsupervised.html"><a href="unsupervised.html"><i class="fa fa-check"></i><b>6</b> Discovering Behaviors with Unsupervised Learning</a><ul>
<li class="chapter" data-level="6.1" data-path="k-means-clustering.html"><a href="k-means-clustering.html"><i class="fa fa-check"></i><b>6.1</b> K-means clustering</a><ul>
<li class="chapter" data-level="6.1.1" data-path="k-means-clustering.html"><a href="k-means-clustering.html#studentresponses"><i class="fa fa-check"></i><b>6.1.1</b> Grouping Student Responses</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-silhouette-index.html"><a href="the-silhouette-index.html"><i class="fa fa-check"></i><b>6.2</b> The Silhouette Index</a></li>
<li class="chapter" data-level="6.3" data-path="associationrules.html"><a href="associationrules.html"><i class="fa fa-check"></i><b>6.3</b> Mining Association Rules</a><ul>
<li class="chapter" data-level="6.3.1" data-path="associationrules.html"><a href="associationrules.html#finding-rules-for-criminal-behavior"><i class="fa fa-check"></i><b>6.3.1</b> Finding Rules for Criminal Behavior</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="SummaryUnsupervised.html"><a href="SummaryUnsupervised.html"><i class="fa fa-check"></i><b>6.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="representations.html"><a href="representations.html"><i class="fa fa-check"></i><b>7</b> Encoding Behavioral Data</a><ul>
<li class="chapter" data-level="7.1" data-path="feature-vectors.html"><a href="feature-vectors.html"><i class="fa fa-check"></i><b>7.1</b> Feature Vectors</a></li>
<li class="chapter" data-level="7.2" data-path="sectimeseries.html"><a href="sectimeseries.html"><i class="fa fa-check"></i><b>7.2</b> Timeseries</a></li>
<li class="chapter" data-level="7.3" data-path="transactions.html"><a href="transactions.html"><i class="fa fa-check"></i><b>7.3</b> Transactions</a></li>
<li class="chapter" data-level="7.4" data-path="images.html"><a href="images.html"><i class="fa fa-check"></i><b>7.4</b> Images</a></li>
<li class="chapter" data-level="7.5" data-path="recurrence-plots.html"><a href="recurrence-plots.html"><i class="fa fa-check"></i><b>7.5</b> Recurrence Plots</a><ul>
<li class="chapter" data-level="7.5.1" data-path="recurrence-plots.html"><a href="recurrence-plots.html#computing-recurence-plots"><i class="fa fa-check"></i><b>7.5.1</b> Computing Recurence Plots</a></li>
<li class="chapter" data-level="7.5.2" data-path="recurrence-plots.html"><a href="recurrence-plots.html#recurrence-plots-of-hand-gestures"><i class="fa fa-check"></i><b>7.5.2</b> Recurrence Plots of Hand Gestures</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="bag-of-words.html"><a href="bag-of-words.html"><i class="fa fa-check"></i><b>7.6</b> Bag-of-Words</a><ul>
<li class="chapter" data-level="7.6.1" data-path="bag-of-words.html"><a href="bag-of-words.html#bow-for-complex-activities."><i class="fa fa-check"></i><b>7.6.1</b> BoW for Complex Activities.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>7.7</b> Graphs</a><ul>
<li class="chapter" data-level="7.7.1" data-path="graphs.html"><a href="graphs.html#complex-activities-as-graphs"><i class="fa fa-check"></i><b>7.7.1</b> Complex activities as graphs</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="SummaryRepresentations.html"><a href="SummaryRepresentations.html"><i class="fa fa-check"></i><b>7.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="deeplearning.html"><a href="deeplearning.html"><i class="fa fa-check"></i><b>8</b> Predicting Behavior with Deep Learning</a><ul>
<li class="chapter" data-level="8.1" data-path="ann.html"><a href="ann.html"><i class="fa fa-check"></i><b>8.1</b> Introduction to Artificial Neural Networks</a><ul>
<li class="chapter" data-level="8.1.1" data-path="ann.html"><a href="ann.html#sigmoid-and-relu-units"><i class="fa fa-check"></i><b>8.1.1</b> Sigmoid and ReLU units</a></li>
<li class="chapter" data-level="8.1.2" data-path="ann.html"><a href="ann.html#assembling-units-into-layers"><i class="fa fa-check"></i><b>8.1.2</b> Assembling Units into Layers</a></li>
<li class="chapter" data-level="8.1.3" data-path="ann.html"><a href="ann.html#deep-neural-networks"><i class="fa fa-check"></i><b>8.1.3</b> Deep Neural Networks</a></li>
<li class="chapter" data-level="8.1.4" data-path="ann.html"><a href="ann.html#learning-the-parameters"><i class="fa fa-check"></i><b>8.1.4</b> Learning the Parameters</a></li>
<li class="chapter" data-level="8.1.5" data-path="ann.html"><a href="ann.html#parameter-learning-example-in-r"><i class="fa fa-check"></i><b>8.1.5</b> Parameter Learning Example in R</a></li>
<li class="chapter" data-level="8.1.6" data-path="ann.html"><a href="ann.html#stochastic-gradient-descent"><i class="fa fa-check"></i><b>8.1.6</b> Stochastic Gradient Descent</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="keras-and-tensorflow-with-r.html"><a href="keras-and-tensorflow-with-r.html"><i class="fa fa-check"></i><b>8.2</b> Keras and TensorFlow with R</a><ul>
<li class="chapter" data-level="8.2.1" data-path="keras-and-tensorflow-with-r.html"><a href="keras-and-tensorflow-with-r.html#keras-example"><i class="fa fa-check"></i><b>8.2.1</b> Keras Example</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="classification-with-neural-networks.html"><a href="classification-with-neural-networks.html"><i class="fa fa-check"></i><b>8.3</b> Classification with Neural Networks</a><ul>
<li class="chapter" data-level="8.3.1" data-path="classification-with-neural-networks.html"><a href="classification-with-neural-networks.html#classification-of-electromyography-signals"><i class="fa fa-check"></i><b>8.3.1</b> Classification of Electromyography Signals</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="overfitting.html"><a href="overfitting.html"><i class="fa fa-check"></i><b>8.4</b> Overfitting</a><ul>
<li class="chapter" data-level="8.4.1" data-path="overfitting.html"><a href="overfitting.html#early-stopping"><i class="fa fa-check"></i><b>8.4.1</b> Early Stopping</a></li>
<li class="chapter" data-level="8.4.2" data-path="overfitting.html"><a href="overfitting.html#dropout"><i class="fa fa-check"></i><b>8.4.2</b> Dropout</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="fine-tuning-a-neural-network.html"><a href="fine-tuning-a-neural-network.html"><i class="fa fa-check"></i><b>8.5</b> Fine-Tuning a Neural Network</a></li>
<li class="chapter" data-level="8.6" data-path="cnns.html"><a href="cnns.html"><i class="fa fa-check"></i><b>8.6</b> Convolutional Neural Networks</a><ul>
<li class="chapter" data-level="8.6.1" data-path="cnns.html"><a href="cnns.html#convolutions"><i class="fa fa-check"></i><b>8.6.1</b> Convolutions</a></li>
<li class="chapter" data-level="8.6.2" data-path="cnns.html"><a href="cnns.html#pooling-operations"><i class="fa fa-check"></i><b>8.6.2</b> Pooling Operations</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="cnns-with-keras.html"><a href="cnns-with-keras.html"><i class="fa fa-check"></i><b>8.7</b> CNNs with Keras</a><ul>
<li class="chapter" data-level="8.7.1" data-path="cnns-with-keras.html"><a href="cnns-with-keras.html#example-1"><i class="fa fa-check"></i><b>8.7.1</b> Example 1</a></li>
<li class="chapter" data-level="8.7.2" data-path="cnns-with-keras.html"><a href="cnns-with-keras.html#example-2"><i class="fa fa-check"></i><b>8.7.2</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="cnnSmile.html"><a href="cnnSmile.html"><i class="fa fa-check"></i><b>8.8</b> Smiles Detection with a CNN</a></li>
<li class="chapter" data-level="8.9" data-path="SummaryDeepLearning.html"><a href="SummaryDeepLearning.html"><i class="fa fa-check"></i><b>8.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="multiuser.html"><a href="multiuser.html"><i class="fa fa-check"></i><b>9</b> Multi-User Validation</a><ul>
<li class="chapter" data-level="9.1" data-path="mixed-models.html"><a href="mixed-models.html"><i class="fa fa-check"></i><b>9.1</b> Mixed Models</a><ul>
<li class="chapter" data-level="9.1.1" data-path="mixed-models.html"><a href="mixed-models.html#skeleton-action-recognition-with-mixed-models"><i class="fa fa-check"></i><b>9.1.1</b> Skeleton Action Recognition with Mixed Models</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="user-independent-models.html"><a href="user-independent-models.html"><i class="fa fa-check"></i><b>9.2</b> User-Independent Models</a></li>
<li class="chapter" data-level="9.3" data-path="user-dependent-models.html"><a href="user-dependent-models.html"><i class="fa fa-check"></i><b>9.3</b> User-Dependent Models</a></li>
<li class="chapter" data-level="9.4" data-path="user-adaptive-models.html"><a href="user-adaptive-models.html"><i class="fa fa-check"></i><b>9.4</b> User-Adaptive Models</a><ul>
<li class="chapter" data-level="9.4.1" data-path="user-adaptive-models.html"><a href="user-adaptive-models.html#transfer-learning"><i class="fa fa-check"></i><b>9.4.1</b> Transfer Learning</a></li>
<li class="chapter" data-level="9.4.2" data-path="user-adaptive-models.html"><a href="user-adaptive-models.html#a-user-adaptive-model-for-activity-recognition"><i class="fa fa-check"></i><b>9.4.2</b> A User-Adaptive Model for Activity Recognition</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="SummaryMultiUser.html"><a href="SummaryMultiUser.html"><i class="fa fa-check"></i><b>9.5</b> Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendixInstall.html"><a href="appendixInstall.html"><i class="fa fa-check"></i><b>A</b> Setup Your Environment</a><ul>
<li class="chapter" data-level="A.1" data-path="installing-the-datasets.html"><a href="installing-the-datasets.html"><i class="fa fa-check"></i><b>A.1</b> Installing the Datasets</a></li>
<li class="chapter" data-level="A.2" data-path="installing-the-examples-source-code.html"><a href="installing-the-examples-source-code.html"><i class="fa fa-check"></i><b>A.2</b> Installing the Examples Source Code</a></li>
<li class="chapter" data-level="A.3" data-path="installing-keras-and-tensorflow-.html"><a href="installing-keras-and-tensorflow-.html"><i class="fa fa-check"></i><b>A.3</b> Installing Keras and TensorFlow.</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendixDatasets.html"><a href="appendixDatasets.html"><i class="fa fa-check"></i><b>B</b> Datasets</a><ul>
<li class="chapter" data-level="B.1" data-path="complex-activities.html"><a href="complex-activities.html"><i class="fa fa-check"></i><b>B.1</b> COMPLEX ACTIVITIES</a></li>
<li class="chapter" data-level="B.2" data-path="depresjon.html"><a href="depresjon.html"><i class="fa fa-check"></i><b>B.2</b> DEPRESJON</a></li>
<li class="chapter" data-level="B.3" data-path="electromyography.html"><a href="electromyography.html"><i class="fa fa-check"></i><b>B.3</b> ELECTROMYOGRAPHY</a></li>
<li class="chapter" data-level="B.4" data-path="hand-gestures.html"><a href="hand-gestures.html"><i class="fa fa-check"></i><b>B.4</b> HAND GESTURES</a></li>
<li class="chapter" data-level="B.5" data-path="home-tasks.html"><a href="home-tasks.html"><i class="fa fa-check"></i><b>B.5</b> HOME TASKS</a></li>
<li class="chapter" data-level="B.6" data-path="homicide-reports.html"><a href="homicide-reports.html"><i class="fa fa-check"></i><b>B.6</b> HOMICIDE REPORTS</a></li>
<li class="chapter" data-level="B.7" data-path="indoor-location.html"><a href="indoor-location.html"><i class="fa fa-check"></i><b>B.7</b> INDOOR LOCATION</a></li>
<li class="chapter" data-level="B.8" data-path="sheep-goats.html"><a href="sheep-goats.html"><i class="fa fa-check"></i><b>B.8</b> SHEEP GOATS</a></li>
<li class="chapter" data-level="B.9" data-path="skeleton-actions.html"><a href="skeleton-actions.html"><i class="fa fa-check"></i><b>B.9</b> SKELETON ACTIONS</a></li>
<li class="chapter" data-level="B.10" data-path="smartphone-activities.html"><a href="smartphone-activities.html"><i class="fa fa-check"></i><b>B.10</b> SMARTPHONE ACTIVITIES</a></li>
<li class="chapter" data-level="B.11" data-path="smiles.html"><a href="smiles.html"><i class="fa fa-check"></i><b>B.11</b> SMILES</a></li>
<li class="chapter" data-level="B.12" data-path="students-mental-health.html"><a href="students-mental-health.html"><i class="fa fa-check"></i><b>B.12</b> STUDENTS’ MENTAL HEALTH</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="citing-this-book.html"><a href="citing-this-book.html"><i class="fa fa-check"></i>Citing this Book</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Behavior Analysis with Machine Learning and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="user-adaptive-models" class="section level2">
<h2><span class="header-section-number">9.4</span> User-Adaptive Models</h2>
<p>We have already talked about some of the limitations of <strong>user-dependent</strong> and <strong>user-independent</strong> models. On one hand, user-dependent models require training data from the target user. In many situations, collecting training data is difficult. On the other hand, user-independent models do not need data from the target user but are less accurate. To overcome those limitations, models that evolve over time as more information is available can be built. One can start with a user-independent model and as more data is available from the target user, the model can be updated accordingly. In this situation, there is no need to wait to start using the system and as new feedback is available, the model gets better and better by learning the specific patterns of a particular user.</p>
<p>In this section, I will explain how a technique called <strong>transfer learning</strong> can be used to build an <strong>adaptive model</strong> that updates itself as new training data is available. First, in the following subsection the idea of transfer learning is introduced and next, the method is used to build an adaptive model for activity recognition.</p>
<div id="transfer-learning" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Transfer Learning</h3>
<p>In machine learning, <strong>transfer learning</strong> refers to the idea of using the knowledge gained when solving a problem to solve another different problem. The new problem can be a similar one but also could be very unrelated. For example, a model trained to detect smiles from images could also be used to predict gender (of course with some fine-tuning). In humans, learning is a lifelong process in which many tasks are interrelated. When we are faced with a new problem, we tend to find solutions that have worked in the past for similar problems. However, in machine learning most of the time the models are trained from scratch for every new problem. For many tasks, training a model from scratch is very time consuming and requires a lot of effort, especially during the data collection and labeling phase.</p>
<p>The idea of transfer learning dates back to 1991 <span class="citation">(Pratt et al. <a href="#ref-pratt1991" role="doc-biblioref">1991</a>)</span> but with the advent of <em>deep learning</em> and in particular, with convolutional neural networks (see chapter <a href="deeplearning.html#deeplearning">8</a>), it has gained popularity because it has proven to be a valuable tool when solving challenging problems. In 2014 a CNN architecture called VGG16 was proposed by <span class="citation">Simonyan and Zisserman (<a href="#ref-simonyan2014" role="doc-biblioref">2014</a>)</span> and won the ILSVR image recognition competition. This CNN was trained with more than <span class="math inline">\(1\)</span> million images to recognize <span class="math inline">\(1000\)</span> categories and it consists of several convolution layers, max pooling operations, and fully connected layers. In total, the network has <span class="math inline">\(\approx 138\)</span> million parameters and it took some weeks to train.</p>
<p>What if you wanted to add a new category to the <span class="math inline">\(1000\)</span> labels? Or maybe, you only want to focus on a subset of the categories? With transfer learning you can take advantage of a network that has already been trained and adapt it to your particular problem. In the case of <em>deep learning</em>, the approach consists of ‘freezing’ the first layers of a network and only retrain and/or modify the last layers to adapt them for the particular problem. During training, the frozen layers’ parameters will not change and the unfrozen ones are updated as usual during the gradient descent procedure. As discussed in chapter <a href="deeplearning.html#deeplearning">8</a>, the first layers can act as feature extractors and can be reused. With this approach, you can easily retrain a VGG16 network in an average computer and within a reasonable time. In fact, Keras already provides interfaces to common pre-trained architectures that you can reuse.</p>
<p>In the following section we will use this idea to build a <strong>user-adaptive model</strong> for activity recognition using transfer learning.</p>
</div>
<div id="a-user-adaptive-model-for-activity-recognition" class="section level3">
<h3><span class="header-section-number">9.4.2</span> A User-Adaptive Model for Activity Recognition</h3>

<div class="rmdfolder">
<code>keras/adaptive_cnn.R</code>
</div>

<p>For this example, we will use the <em>SMARTPHONE ACTIVITIES</em> dataset <strong>encoded as images </strong>. In chapter <a href="representations.html#representations">7</a> (section: Images) I showed you how timeseries data can be represented as an image with an example of how an activity can be represented as an RBG color image where each channel corresponds to one of the acceleration axes (<em>x</em>, <em>y</em>, <em>z</em>). We will use the file <code>images.txt</code> that already contains the activities in image format. The procedure of converting the raw data into this format was explained in chapter <a href="representations.html#representations">7</a> and the corresponding code is in script <code>timeseries_to_images.R</code>. Since the input data are images, we will use a convolutional neural network (see chapter <a href="deeplearning.html#deeplearning">8</a>).</p>
<p>The main objective will be to build an adaptive model with a small amount of training data from the target user. What we will do first is build a <strong>user-independent model</strong>. That is, we will select one of the users as the <em>target user</em>. We will train a user-independent model with data from the remaining users (excluding the target user). Then, we will apply transfer learning on this model to adapt it to the target user.</p>
<p>The target user’s data will be split into a test set and an <strong>adaptive set</strong>. The test set will be used to evaluate the performance of the model and the adaptive set will be used to fine-tune the model. The adaptive set is used to simulate that we have obtained new data from the target user.</p>
<p>The complete code is in script <code>keras/adaptive_cnn.R</code>. First, we start by reading the images file. Each row corresponds to one activity. The last two columns are the <code>userid</code> and the <code>class</code>. The first <span class="math inline">\(300\)</span> columns correspond to the image pixels. Each image has a size of <span class="math inline">\(10 \times 10 \times 3\)</span> (height, width, depth).</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="user-adaptive-models.html#cb177-1"></a><span class="co"># Path to smartphone activities in image format.</span></span>
<span id="cb177-2"><a href="user-adaptive-models.html#cb177-2"></a>filepath &lt;-<span class="st"> </span><span class="kw">file.path</span>(datasets_path,</span>
<span id="cb177-3"><a href="user-adaptive-models.html#cb177-3"></a>                      <span class="st">&quot;smartphone_activities&quot;</span>,</span>
<span id="cb177-4"><a href="user-adaptive-models.html#cb177-4"></a>                      <span class="st">&quot;images.txt&quot;</span>)</span>
<span id="cb177-5"><a href="user-adaptive-models.html#cb177-5"></a></span>
<span id="cb177-6"><a href="user-adaptive-models.html#cb177-6"></a><span class="co"># Read data.</span></span>
<span id="cb177-7"><a href="user-adaptive-models.html#cb177-7"></a>df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(filepath, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb177-8"><a href="user-adaptive-models.html#cb177-8"></a></span>
<span id="cb177-9"><a href="user-adaptive-models.html#cb177-9"></a><span class="co"># Shuffle rows.</span></span>
<span id="cb177-10"><a href="user-adaptive-models.html#cb177-10"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb177-11"><a href="user-adaptive-models.html#cb177-11"></a>df &lt;-<span class="st"> </span>df[<span class="kw">sample</span>(<span class="kw">nrow</span>(df)),]</span></code></pre></div>
<p>The rows happen to be ordered by user and activity, so we shuffle them to ensure that the model is not biased towards the last users and activities.</p>
<p>Since we will train a CNN using keras, we need the classes to be in integer format. The following code is used to append a new column <code>intlabel</code> to the database. This new column contains the classes as integers. We also create a variable <code>mapping</code> to keep track of the mapping between integers and the actual labels. By printing the <code>mapping</code> variable we can see that for example, the <em>‘Walking’</em> label has a corresponding integer value of <span class="math inline">\(0\)</span>, <em>‘Downstairs’</em> <span class="math inline">\(1\)</span>, and so on.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="user-adaptive-models.html#cb178-1"></a><span class="co">## Convert labels to integers starting at 0. ##</span></span>
<span id="cb178-2"><a href="user-adaptive-models.html#cb178-2"></a></span>
<span id="cb178-3"><a href="user-adaptive-models.html#cb178-3"></a><span class="co"># Get the unique labels.</span></span>
<span id="cb178-4"><a href="user-adaptive-models.html#cb178-4"></a>labels &lt;-<span class="st"> </span><span class="kw">unique</span>(df<span class="op">$</span>label)</span>
<span id="cb178-5"><a href="user-adaptive-models.html#cb178-5"></a></span>
<span id="cb178-6"><a href="user-adaptive-models.html#cb178-6"></a>mapping &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span>(<span class="kw">length</span>(labels) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb178-7"><a href="user-adaptive-models.html#cb178-7"></a></span>
<span id="cb178-8"><a href="user-adaptive-models.html#cb178-8"></a><span class="kw">names</span>(mapping) &lt;-<span class="st"> </span>labels</span>
<span id="cb178-9"><a href="user-adaptive-models.html#cb178-9"></a></span>
<span id="cb178-10"><a href="user-adaptive-models.html#cb178-10"></a><span class="kw">print</span>(mapping)</span>
<span id="cb178-11"><a href="user-adaptive-models.html#cb178-11"></a><span class="co">#&gt;    Walking Downstairs    Jogging   Standing   Upstairs    Sitting </span></span>
<span id="cb178-12"><a href="user-adaptive-models.html#cb178-12"></a><span class="co">#&gt;         0          1          2          3          4          5 </span></span>
<span id="cb178-13"><a href="user-adaptive-models.html#cb178-13"></a></span>
<span id="cb178-14"><a href="user-adaptive-models.html#cb178-14"></a><span class="co"># Append labels as integers at the end of data frame.</span></span>
<span id="cb178-15"><a href="user-adaptive-models.html#cb178-15"></a>df<span class="op">$</span>intlabel &lt;-<span class="st"> </span>mapping[df<span class="op">$</span>label]</span></code></pre></div>
<p>Now we store the unique users’ ids in the <code>users</code> variable. After printing it, you can notice that there are <span class="math inline">\(19\)</span> distinct users in this database. The original database has more users but we only kept those that performed all the activities. Then, we can select one of the users to act as the <em>target user</em>. I will just select one of them at random (turned out to be user <span class="math inline">\(24\)</span>). Feel free to select another user if you want.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="user-adaptive-models.html#cb179-1"></a><span class="co"># Get the unique user ids.</span></span>
<span id="cb179-2"><a href="user-adaptive-models.html#cb179-2"></a>users &lt;-<span class="st"> </span><span class="kw">unique</span>(df<span class="op">$</span>userid)</span>
<span id="cb179-3"><a href="user-adaptive-models.html#cb179-3"></a></span>
<span id="cb179-4"><a href="user-adaptive-models.html#cb179-4"></a><span class="co"># Print all user ids.</span></span>
<span id="cb179-5"><a href="user-adaptive-models.html#cb179-5"></a><span class="kw">print</span>(users)</span>
<span id="cb179-6"><a href="user-adaptive-models.html#cb179-6"></a><span class="co">#&gt; [1] 29 20 18  8 32 27  3 36 34  5  7 12  6 21 24 31 13 33 19</span></span>
<span id="cb179-7"><a href="user-adaptive-models.html#cb179-7"></a></span>
<span id="cb179-8"><a href="user-adaptive-models.html#cb179-8"></a><span class="co"># Choose one user at random to be the target user.</span></span>
<span id="cb179-9"><a href="user-adaptive-models.html#cb179-9"></a>targetUser &lt;-<span class="st"> </span><span class="kw">sample</span>(users, <span class="dv">1</span>)</span></code></pre></div>
<p>Next, we split the data into two sets. The first set <code>trainset</code> contains the data from all users but <strong>excluding the target user</strong>. Then we create two variables: <code>train.y</code> and <code>train.x</code>. The first one has the labels as integers and the second one has the actual image pixels (features).</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="user-adaptive-models.html#cb180-1"></a><span class="co"># Split into train and target user sets.</span></span>
<span id="cb180-2"><a href="user-adaptive-models.html#cb180-2"></a><span class="co"># The train set includes data from all users excluding targetUser.</span></span>
<span id="cb180-3"><a href="user-adaptive-models.html#cb180-3"></a>trainset &lt;-<span class="st"> </span>df[df<span class="op">$</span>userid <span class="op">!=</span><span class="st"> </span>targetUser,]</span>
<span id="cb180-4"><a href="user-adaptive-models.html#cb180-4"></a></span>
<span id="cb180-5"><a href="user-adaptive-models.html#cb180-5"></a><span class="co"># Save train labels in a separate variable.</span></span>
<span id="cb180-6"><a href="user-adaptive-models.html#cb180-6"></a>train.y &lt;-<span class="st"> </span>trainset<span class="op">$</span>intlabel</span>
<span id="cb180-7"><a href="user-adaptive-models.html#cb180-7"></a></span>
<span id="cb180-8"><a href="user-adaptive-models.html#cb180-8"></a><span class="co"># Save train pixels in a separate variable.</span></span>
<span id="cb180-9"><a href="user-adaptive-models.html#cb180-9"></a>train.x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(trainset[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">301</span>,<span class="dv">302</span>,<span class="dv">303</span>)])</span></code></pre></div>
<p>Now we split the target’s user data into <span class="math inline">\(50\%\)</span> test data and <span class="math inline">\(50\%\)</span> adaptive data such that we end up with <span class="math inline">\(4\)</span> variables:</p>
<ol style="list-style-type: decimal">
<li><code>target.adaptive.y</code> Integer labels for the adaptive data of the target user.</li>
<li><code>target.adaptive.x</code> Pixels of the adaptive data of the target user.</li>
<li><code>target.test.y</code> Integer labels for the test data of the target user.</li>
<li><code>target.test.x</code> Pixels of the test data of the target user.</li>
</ol>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="user-adaptive-models.html#cb181-1"></a><span class="co"># This contains all data from the target user.</span></span>
<span id="cb181-2"><a href="user-adaptive-models.html#cb181-2"></a>target.data &lt;-<span class="st"> </span>df[df<span class="op">$</span>userid <span class="op">==</span><span class="st"> </span>targetUser,]</span>
<span id="cb181-3"><a href="user-adaptive-models.html#cb181-3"></a></span>
<span id="cb181-4"><a href="user-adaptive-models.html#cb181-4"></a><span class="co"># Split the target user&#39;s data into 50% adaptive</span></span>
<span id="cb181-5"><a href="user-adaptive-models.html#cb181-5"></a><span class="co"># and 50% test data.</span></span>
<span id="cb181-6"><a href="user-adaptive-models.html#cb181-6"></a>idxs &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(target.data),</span>
<span id="cb181-7"><a href="user-adaptive-models.html#cb181-7"></a>               <span class="dt">size =</span> <span class="kw">nrow</span>(target.data) <span class="op">*</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb181-8"><a href="user-adaptive-models.html#cb181-8"></a>               <span class="dt">replace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb181-9"><a href="user-adaptive-models.html#cb181-9"></a></span>
<span id="cb181-10"><a href="user-adaptive-models.html#cb181-10"></a><span class="co"># Target user adaptive set.</span></span>
<span id="cb181-11"><a href="user-adaptive-models.html#cb181-11"></a><span class="co"># This data is used to adapt the model to the target user.</span></span>
<span id="cb181-12"><a href="user-adaptive-models.html#cb181-12"></a>target.adaptive &lt;-<span class="st"> </span>target.data[idxs,]</span>
<span id="cb181-13"><a href="user-adaptive-models.html#cb181-13"></a></span>
<span id="cb181-14"><a href="user-adaptive-models.html#cb181-14"></a><span class="co"># Save target.adaptive labels in a separate variable.</span></span>
<span id="cb181-15"><a href="user-adaptive-models.html#cb181-15"></a>target.adaptive.y &lt;-<span class="st"> </span>target.adaptive<span class="op">$</span>intlabel</span>
<span id="cb181-16"><a href="user-adaptive-models.html#cb181-16"></a></span>
<span id="cb181-17"><a href="user-adaptive-models.html#cb181-17"></a><span class="co"># Save target.adaptive pixels in a separate variable.</span></span>
<span id="cb181-18"><a href="user-adaptive-models.html#cb181-18"></a>target.adaptive.x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(target.adaptive[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">301</span>,<span class="dv">302</span>,<span class="dv">303</span>)])</span>
<span id="cb181-19"><a href="user-adaptive-models.html#cb181-19"></a></span>
<span id="cb181-20"><a href="user-adaptive-models.html#cb181-20"></a><span class="co"># Target user test set.</span></span>
<span id="cb181-21"><a href="user-adaptive-models.html#cb181-21"></a><span class="co"># This data is used to test the performance.</span></span>
<span id="cb181-22"><a href="user-adaptive-models.html#cb181-22"></a>target.test &lt;-<span class="st"> </span>target.data[<span class="op">-</span>idxs,]</span>
<span id="cb181-23"><a href="user-adaptive-models.html#cb181-23"></a></span>
<span id="cb181-24"><a href="user-adaptive-models.html#cb181-24"></a><span class="co"># Save target.test labels in a separate variable.</span></span>
<span id="cb181-25"><a href="user-adaptive-models.html#cb181-25"></a>target.test.y &lt;-<span class="st"> </span>target.test<span class="op">$</span>intlabel</span>
<span id="cb181-26"><a href="user-adaptive-models.html#cb181-26"></a></span>
<span id="cb181-27"><a href="user-adaptive-models.html#cb181-27"></a><span class="co"># Save target.test pixels in a separate variable.</span></span>
<span id="cb181-28"><a href="user-adaptive-models.html#cb181-28"></a>target.test.x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(target.test[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">301</span>,<span class="dv">302</span>,<span class="dv">303</span>)])</span></code></pre></div>
<p>We also need to normalize the data and reshape it into the actual image format since in their current form, the pixels are stored into <span class="math inline">\(1\)</span>-dimensional arrays. We learn the normalization parameters only from the train set and then we used the <code>normalize.reshape()</code> function (defined in the same script file) to perform the actual normalization and formatting.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="user-adaptive-models.html#cb182-1"></a><span class="co"># Learn min and max values from train set for normalization.</span></span>
<span id="cb182-2"><a href="user-adaptive-models.html#cb182-2"></a>maxv &lt;-<span class="st"> </span><span class="kw">max</span>(train.x)</span>
<span id="cb182-3"><a href="user-adaptive-models.html#cb182-3"></a>minv &lt;-<span class="st"> </span><span class="kw">min</span>(train.x)</span>
<span id="cb182-4"><a href="user-adaptive-models.html#cb182-4"></a></span>
<span id="cb182-5"><a href="user-adaptive-models.html#cb182-5"></a><span class="co"># Normalize and reshape. May take some minutes.</span></span>
<span id="cb182-6"><a href="user-adaptive-models.html#cb182-6"></a>train.x &lt;-<span class="st"> </span><span class="kw">normalize.reshape</span>(train.x, minv, maxv)</span>
<span id="cb182-7"><a href="user-adaptive-models.html#cb182-7"></a>target.adaptive.x &lt;-<span class="st"> </span><span class="kw">normalize.reshape</span>(target.adaptive.x, minv, maxv)</span>
<span id="cb182-8"><a href="user-adaptive-models.html#cb182-8"></a>target.test.x &lt;-<span class="st"> </span><span class="kw">normalize.reshape</span>(target.test.x, minv, maxv)</span></code></pre></div>
<p>Let’s inspect how the structure of the final datasets looks like.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="user-adaptive-models.html#cb183-1"></a><span class="kw">dim</span>(train.x)</span>
<span id="cb183-2"><a href="user-adaptive-models.html#cb183-2"></a><span class="co">#&gt; [1] 6399   10   10    3</span></span>
<span id="cb183-3"><a href="user-adaptive-models.html#cb183-3"></a><span class="kw">dim</span>(target.adaptive.x)</span>
<span id="cb183-4"><a href="user-adaptive-models.html#cb183-4"></a><span class="co">#&gt; [1] 124  10  10   3</span></span>
<span id="cb183-5"><a href="user-adaptive-models.html#cb183-5"></a><span class="kw">dim</span>(target.test.x)</span>
<span id="cb183-6"><a href="user-adaptive-models.html#cb183-6"></a><span class="co">#&gt; [1] 124  10  10   3</span></span></code></pre></div>
<p>Here, we see that the train set has <span class="math inline">\(6399\)</span> instances (images). The adaptive and test sets both have <span class="math inline">\(124\)</span> instances.</p>
<p>Now that we are finally done with all the preprocessing, it is time to build the CNN model! This one will be the initial user-independent model and is trained with all the training data <code>train.x</code>, <code>train.y</code>.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="user-adaptive-models.html#cb184-1"></a>model &lt;-<span class="st"> </span><span class="kw">keras_model_sequential</span>()</span>
<span id="cb184-2"><a href="user-adaptive-models.html#cb184-2"></a></span>
<span id="cb184-3"><a href="user-adaptive-models.html#cb184-3"></a>model <span class="op">%&gt;%</span></span>
<span id="cb184-4"><a href="user-adaptive-models.html#cb184-4"></a><span class="st">  </span><span class="kw">layer_conv_2d</span>(<span class="dt">name =</span> <span class="st">&quot;conv1&quot;</span>,</span>
<span id="cb184-5"><a href="user-adaptive-models.html#cb184-5"></a>                <span class="dt">filters =</span> <span class="dv">8</span>,</span>
<span id="cb184-6"><a href="user-adaptive-models.html#cb184-6"></a>                <span class="dt">kernel_size =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb184-7"><a href="user-adaptive-models.html#cb184-7"></a>                <span class="dt">activation =</span> <span class="st">&#39;relu&#39;</span>,</span>
<span id="cb184-8"><a href="user-adaptive-models.html#cb184-8"></a>                <span class="dt">input_shape =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">3</span>)) <span class="op">%&gt;%</span></span>
<span id="cb184-9"><a href="user-adaptive-models.html#cb184-9"></a><span class="st">  </span><span class="kw">layer_conv_2d</span>(<span class="dt">name =</span> <span class="st">&quot;conv2&quot;</span>,</span>
<span id="cb184-10"><a href="user-adaptive-models.html#cb184-10"></a>                <span class="dt">filters =</span> <span class="dv">16</span>,</span>
<span id="cb184-11"><a href="user-adaptive-models.html#cb184-11"></a>                <span class="dt">kernel_size =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb184-12"><a href="user-adaptive-models.html#cb184-12"></a>                <span class="dt">activation =</span> <span class="st">&#39;relu&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb184-13"><a href="user-adaptive-models.html#cb184-13"></a><span class="st">  </span><span class="kw">layer_max_pooling_2d</span>(<span class="dt">pool_size =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb184-14"><a href="user-adaptive-models.html#cb184-14"></a><span class="st">  </span><span class="kw">layer_flatten</span>() <span class="op">%&gt;%</span></span>
<span id="cb184-15"><a href="user-adaptive-models.html#cb184-15"></a><span class="st">  </span><span class="kw">layer_dense</span>(<span class="dt">name =</span> <span class="st">&quot;hidden1&quot;</span>, <span class="dt">units =</span> <span class="dv">32</span>,</span>
<span id="cb184-16"><a href="user-adaptive-models.html#cb184-16"></a>              <span class="dt">activation =</span> <span class="st">&#39;relu&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb184-17"><a href="user-adaptive-models.html#cb184-17"></a><span class="st">  </span><span class="kw">layer_dropout</span>(<span class="fl">0.25</span>) <span class="op">%&gt;%</span></span>
<span id="cb184-18"><a href="user-adaptive-models.html#cb184-18"></a><span class="st">  </span><span class="kw">layer_dense</span>(<span class="dt">units =</span> <span class="dv">6</span>, <span class="dt">activation =</span> <span class="st">&#39;softmax&#39;</span>)</span></code></pre></div>
<p>This CNN has two convolutional layers followed by a max pooling operation, a fully connected layer, and an output layer. One important thing to note is that <strong>we have specified a name for each layer</strong> with the <code>name</code> parameter. For example, the first convolution’s name is <code>conv1</code>, the second one is <code>conv2</code>, and the fully connected layer was named <code>hidden1</code>. These names must be unique because they will allow us to later select specific layers fo freeze and unfreeze.</p>
<p>If we print the model’s summary we can see that in total it has <span class="math inline">\(9,054\)</span> <strong>trainable parameters</strong> and <span class="math inline">\(0\)</span> <strong>non-trainable parameters</strong>. This means that all the parameters of the network will be updated during the gradient descent procedure, as usual.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="user-adaptive-models.html#cb185-1"></a><span class="co"># Print summary.</span></span>
<span id="cb185-2"><a href="user-adaptive-models.html#cb185-2"></a><span class="kw">summary</span>(model)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:adaptSummary1"></span>
<img src="images/adaptive_summary.png" alt="Summary of initial user-independent model." width="90%" />
<p class="caption">
Figure 9.5: Summary of initial user-independent model.
</p>
</div>
<p>The next code will compile the model and initiate the training phase.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="user-adaptive-models.html#cb186-1"></a><span class="co"># Compile model.</span></span>
<span id="cb186-2"><a href="user-adaptive-models.html#cb186-2"></a>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">compile</span>(</span>
<span id="cb186-3"><a href="user-adaptive-models.html#cb186-3"></a>  <span class="dt">loss =</span> <span class="st">&#39;sparse_categorical_crossentropy&#39;</span>,</span>
<span id="cb186-4"><a href="user-adaptive-models.html#cb186-4"></a>  <span class="dt">optimizer =</span> <span class="kw">optimizer_sgd</span>(<span class="dt">lr =</span> <span class="fl">0.01</span>),</span>
<span id="cb186-5"><a href="user-adaptive-models.html#cb186-5"></a>  <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb186-6"><a href="user-adaptive-models.html#cb186-6"></a>)</span>
<span id="cb186-7"><a href="user-adaptive-models.html#cb186-7"></a></span>
<span id="cb186-8"><a href="user-adaptive-models.html#cb186-8"></a><span class="co"># Fit the user-independent model.</span></span>
<span id="cb186-9"><a href="user-adaptive-models.html#cb186-9"></a>history &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(</span>
<span id="cb186-10"><a href="user-adaptive-models.html#cb186-10"></a>  train.x, train.y,</span>
<span id="cb186-11"><a href="user-adaptive-models.html#cb186-11"></a>  <span class="dt">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb186-12"><a href="user-adaptive-models.html#cb186-12"></a>  <span class="dt">batch_size =</span> <span class="dv">8</span>,</span>
<span id="cb186-13"><a href="user-adaptive-models.html#cb186-13"></a>  <span class="dt">validation_split =</span> <span class="fl">0.15</span>,</span>
<span id="cb186-14"><a href="user-adaptive-models.html#cb186-14"></a>  <span class="dt">verbose =</span> <span class="dv">1</span>,</span>
<span id="cb186-15"><a href="user-adaptive-models.html#cb186-15"></a>  <span class="dt">view_metrics =</span> <span class="ot">TRUE</span></span>
<span id="cb186-16"><a href="user-adaptive-models.html#cb186-16"></a>)</span>
<span id="cb186-17"><a href="user-adaptive-models.html#cb186-17"></a></span>
<span id="cb186-18"><a href="user-adaptive-models.html#cb186-18"></a><span class="kw">plot</span>(history)</span></code></pre></div>

<div class="rmdinfo">
Note that this time the loss was defined as <code>loss = 'sparse_categorical_crossentropy'</code> instead of the usual <code>loss = 'categorical_crossentropy'</code>. Here, the <code>sparse_</code> suffix was added. You may have noted that in this example we did not one-hot encode the labels but they were only transformed into integers. By adding the <code>sparse_</code> suffix we are telling Keras that our labels are not one-hot-encoded but encoded as integers starting at <span class="math inline">\(0\)</span> so it will perform the one-hot encoding for us. This is a little trick that saved us some time.
</div>

<p><img src="images/adapt_loss1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>We save the model so we can load it later. Let’s also estimate the model’s performance on the target user test set.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="user-adaptive-models.html#cb187-1"></a><span class="co"># Save model.</span></span>
<span id="cb187-2"><a href="user-adaptive-models.html#cb187-2"></a><span class="kw">save_model_hdf5</span>(model, <span class="st">&quot;user-independent.hdf5&quot;</span>)</span>
<span id="cb187-3"><a href="user-adaptive-models.html#cb187-3"></a></span>
<span id="cb187-4"><a href="user-adaptive-models.html#cb187-4"></a><span class="co"># Compute performance (accuracy) on the target user test set.</span></span>
<span id="cb187-5"><a href="user-adaptive-models.html#cb187-5"></a>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">evaluate</span>(target.test.x, target.test.y)</span>
<span id="cb187-6"><a href="user-adaptive-models.html#cb187-6"></a><span class="co">#&gt;      loss  accuracy </span></span>
<span id="cb187-7"><a href="user-adaptive-models.html#cb187-7"></a><span class="co">#&gt; 2.1888916 0.6129032</span></span></code></pre></div>
<p>The overall <em>accuracy</em> of this user-independent model when tested on the target user was <span class="math inline">\(61.2\%\)</span> (quite low). Now, we can apply transfer learning and see if we can do better. We will ‘freeze’ the first convolution layer and only update the second convolution layer and the remaining fully connected layers using the target user-adaptive data. The following code loads the previously trained user-independent model. Then all the CNN’s weights are frozen using the <code>freeze_weights()</code> function. The <code>from</code> parameter specifies the first layer (inclusive) from which the parameters are to be frozen. Here, we set it to <span class="math inline">\(1\)</span> so all parameters in the network are ‘frozen’. Then, we can use the <code>unfreeze_weights()</code> function to specify from which layer (inclusive) the parameters should be unfrozen. In this case, we want to retrain from the second convolutional layer so we set it to <code>conv2</code> which is how we named this layer earlier.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="user-adaptive-models.html#cb188-1"></a>adaptive.model &lt;-<span class="st"> </span><span class="kw">load_model_hdf5</span>(<span class="st">&quot;user-independent.hdf5&quot;</span>)</span>
<span id="cb188-2"><a href="user-adaptive-models.html#cb188-2"></a></span>
<span id="cb188-3"><a href="user-adaptive-models.html#cb188-3"></a><span class="co"># Freeze all layers.</span></span>
<span id="cb188-4"><a href="user-adaptive-models.html#cb188-4"></a><span class="kw">freeze_weights</span>(adaptive.model, <span class="dt">from =</span> <span class="dv">1</span>)</span>
<span id="cb188-5"><a href="user-adaptive-models.html#cb188-5"></a></span>
<span id="cb188-6"><a href="user-adaptive-models.html#cb188-6"></a><span class="co"># Unfreeze layers from conv2.</span></span>
<span id="cb188-7"><a href="user-adaptive-models.html#cb188-7"></a><span class="kw">unfreeze_weights</span>(adaptive.model, <span class="dt">from =</span> <span class="st">&quot;conv2&quot;</span>)</span></code></pre></div>
<p>After defining those changes we need to compile the model so the modifications take effect.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="user-adaptive-models.html#cb189-1"></a><span class="co"># Compile model. We need to compile after freezing/unfreezing weights.</span></span>
<span id="cb189-2"><a href="user-adaptive-models.html#cb189-2"></a>adaptive.model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">compile</span>(</span>
<span id="cb189-3"><a href="user-adaptive-models.html#cb189-3"></a>  <span class="dt">loss =</span> <span class="st">&#39;sparse_categorical_crossentropy&#39;</span>,</span>
<span id="cb189-4"><a href="user-adaptive-models.html#cb189-4"></a>  <span class="dt">optimizer =</span> <span class="kw">optimizer_sgd</span>(<span class="dt">lr =</span> <span class="fl">0.01</span>),</span>
<span id="cb189-5"><a href="user-adaptive-models.html#cb189-5"></a>  <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb189-6"><a href="user-adaptive-models.html#cb189-6"></a>)</span>
<span id="cb189-7"><a href="user-adaptive-models.html#cb189-7"></a></span>
<span id="cb189-8"><a href="user-adaptive-models.html#cb189-8"></a><span class="kw">summary</span>(adaptive.model)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:adaptSummary2"></span>
<img src="images/adaptive_summary2.png" alt="Summary of user-independent model after freezing first convolutional layer." width="90%" />
<p class="caption">
Figure 9.6: Summary of user-independent model after freezing first convolutional layer.
</p>
</div>
<p>After printing the summary, now you can note that the number of <strong>trainable and non-trainable parameters</strong> has changed. Now, the non-trainable parameters are <span class="math inline">\(104\)</span> but before they were <span class="math inline">\(0\)</span>. These <span class="math inline">\(104\)</span> parameters correspond to the first convolutional layer but this time they will not be updated during the gradient descent training phase.</p>
<p>The following code will retrain the model using the adaptive data but keeping the first convolutional layer fixed.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="user-adaptive-models.html#cb190-1"></a><span class="co"># Update model with adaptive data.</span></span>
<span id="cb190-2"><a href="user-adaptive-models.html#cb190-2"></a>history &lt;-<span class="st"> </span>adaptive.model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(</span>
<span id="cb190-3"><a href="user-adaptive-models.html#cb190-3"></a>  target.adaptive.x, target.adaptive.y,</span>
<span id="cb190-4"><a href="user-adaptive-models.html#cb190-4"></a>  <span class="dt">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb190-5"><a href="user-adaptive-models.html#cb190-5"></a>  <span class="dt">batch_size =</span> <span class="dv">8</span>,</span>
<span id="cb190-6"><a href="user-adaptive-models.html#cb190-6"></a>  <span class="dt">validation_split =</span> <span class="dv">0</span>,</span>
<span id="cb190-7"><a href="user-adaptive-models.html#cb190-7"></a>  <span class="dt">verbose =</span> <span class="dv">1</span>,</span>
<span id="cb190-8"><a href="user-adaptive-models.html#cb190-8"></a>  <span class="dt">view_metrics =</span> <span class="ot">TRUE</span></span>
<span id="cb190-9"><a href="user-adaptive-models.html#cb190-9"></a>)</span></code></pre></div>

<div class="rmdcaution">
Note that this time the <code>validation_split</code> was set to <span class="math inline">\(0\)</span>. This is because the target user data set is very small so there is not enough data to use as validation set. One possible approach to overcome this is to leave a percentage of users out when building the train set for the user-independent model. Then, use those left-out users to find which are the most appropriate layers to keep frozen. Once you are happy with the results, evaluate the model with the target user.
</div>

<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="user-adaptive-models.html#cb191-1"></a><span class="co"># Compute performance (accuracy) on the target user test set.</span></span>
<span id="cb191-2"><a href="user-adaptive-models.html#cb191-2"></a>adaptive.model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">evaluate</span>(target.test.x, target.test.y)</span>
<span id="cb191-3"><a href="user-adaptive-models.html#cb191-3"></a><span class="co">#&gt;      loss  accuracy </span></span>
<span id="cb191-4"><a href="user-adaptive-models.html#cb191-4"></a><span class="co">#&gt; 0.4652017 0.8548387</span></span></code></pre></div>
<p>If we evaluate the adaptive model performance on the target’s user test set, now we see that the accuracy is <span class="math inline">\(85.4\%\)</span> which is a considerable increase! (<span class="math inline">\(\approx 24\%\)</span> increase).</p>
<p>At this point, you may be wondering that this accuracy increase was due to the fact that the model was trained for an additional <span class="math inline">\(50\)</span> epochs. To check this, we can re-train the initial user-independent model for <span class="math inline">\(50\)</span> more epochs.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="user-adaptive-models.html#cb192-1"></a>retrained_model &lt;-<span class="st"> </span><span class="kw">load_model_hdf5</span>(<span class="st">&quot;user-independent.hdf5&quot;</span>)</span>
<span id="cb192-2"><a href="user-adaptive-models.html#cb192-2"></a></span>
<span id="cb192-3"><a href="user-adaptive-models.html#cb192-3"></a><span class="co"># Fit the user-independent model for 50 more epochs.</span></span>
<span id="cb192-4"><a href="user-adaptive-models.html#cb192-4"></a>history &lt;-<span class="st"> </span>retrained_model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(</span>
<span id="cb192-5"><a href="user-adaptive-models.html#cb192-5"></a>  train.x, train.y,</span>
<span id="cb192-6"><a href="user-adaptive-models.html#cb192-6"></a>  <span class="dt">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb192-7"><a href="user-adaptive-models.html#cb192-7"></a>  <span class="dt">batch_size =</span> <span class="dv">8</span>,</span>
<span id="cb192-8"><a href="user-adaptive-models.html#cb192-8"></a>  <span class="dt">validation_split =</span> <span class="fl">0.15</span>,</span>
<span id="cb192-9"><a href="user-adaptive-models.html#cb192-9"></a>  <span class="dt">verbose =</span> <span class="dv">1</span>,</span>
<span id="cb192-10"><a href="user-adaptive-models.html#cb192-10"></a>  <span class="dt">view_metrics =</span> <span class="ot">TRUE</span></span>
<span id="cb192-11"><a href="user-adaptive-models.html#cb192-11"></a>)</span>
<span id="cb192-12"><a href="user-adaptive-models.html#cb192-12"></a></span>
<span id="cb192-13"><a href="user-adaptive-models.html#cb192-13"></a><span class="co"># Compute performance (accuracy) on the target user test set.</span></span>
<span id="cb192-14"><a href="user-adaptive-models.html#cb192-14"></a>retrained_model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">evaluate</span>(target.test.x, target.test.y)</span>
<span id="cb192-15"><a href="user-adaptive-models.html#cb192-15"></a><span class="co">#&gt;      loss  accuracy </span></span>
<span id="cb192-16"><a href="user-adaptive-models.html#cb192-16"></a><span class="co">#&gt; 2.7197671 0.6612903 </span></span></code></pre></div>
<p>After re-training the user-independent model for <span class="math inline">\(50\)</span> more epochs, its <em>accuracy</em> increased to <span class="math inline">\(66.1\%\)</span>. On the other hand, the adaptive model was trained with much less data and produced a much better result (<span class="math inline">\(85.4%\)</span>) with only <span class="math inline">\(124\)</span> instances as compared to the user-independent model <span class="math inline">\(\approx 5440\)</span> instances. That is, the <span class="math inline">\(6399\)</span> instances minus <span class="math inline">\(15\%\)</span> used as the validation set. This also highlights one of the advantages of transfer learning which is a reduction in the needed amount of training data.</p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-pratt1991">
<p>Pratt, Lorien Y, Jack Mostow, Candace A Kamm, and Ace A Kamm. 1991. “Direct Transfer of Learned Information Among Neural Networks.” In <em>Aaai</em>, 91:584–89.</p>
</div>
<div id="ref-simonyan2014">
<p>Simonyan, Karen, and Andrew Zisserman. 2014. “Very Deep Convolutional Networks for Large-Scale Image Recognition.” <em>arXiv Preprint arXiv:1409.1556</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="user-dependent-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="SummaryMultiUser.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
