<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Predicting Behavior with Classification Models | Behavior Analysis with Machine Learning Using R</title>
  <meta name="description" content="Chapter 2 Predicting Behavior with Classification Models | Behavior Analysis with Machine Learning Using R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors and stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Predicting Behavior with Classification Models | Behavior Analysis with Machine Learning Using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.png" />
  <meta property="og:description" content="Chapter 2 Predicting Behavior with Classification Models | Behavior Analysis with Machine Learning Using R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors and stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Predicting Behavior with Classification Models | Behavior Analysis with Machine Learning Using R" />
  
  <meta name="twitter:description" content="Chapter 2 Predicting Behavior with Classification Models | Behavior Analysis with Machine Learning Using R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors and stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  <meta name="twitter:image" content="/images/cover.png" />

<meta name="author" content="Enrique Garcia Ceja" />


<meta name="date" content="2021-05-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="ensemble.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/d3/d3.min.js"></script>
<link href="libs/d3panels/d3panels.min.css" rel="stylesheet" />
<script src="libs/d3panels/d3panels.min.js"></script>
<script src="libs/qtlcharts_iplotCorr/iplotCorr.js"></script>
<script src="libs/qtlcharts_iplotCorr/iplotCorr_noscat.js"></script>
<script src="libs/iplotCorr-binding/iplotCorr.js"></script>
<link href="libs/dygraphs/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs/dygraph-combined.js"></script>
<script src="libs/dygraphs/shapes.js"></script>
<script src="libs/moment/moment.js"></script>
<script src="libs/moment-timezone/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding/dygraphs.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-178679335-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178679335-1', { 'anonymize_ip': true });
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="#">Behavior Analysis with Machine Learning Using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#supplemental-material"><i class="fa fa-check"></i>Supplemental Material</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to Behavior and Machine Learning</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-is-behavior"><i class="fa fa-check"></i><b>1.1</b> What is Behavior?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-machine-learning"><i class="fa fa-check"></i><b>1.2</b> What is Machine Learning?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#taxonomy"><i class="fa fa-check"></i><b>1.3</b> Types of Machine Learning</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#terminology"><i class="fa fa-check"></i><b>1.4</b> Terminology</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#tables"><i class="fa fa-check"></i><b>1.4.1</b> Tables</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#variable-types"><i class="fa fa-check"></i><b>1.4.2</b> Variable Types</a></li>
<li class="chapter" data-level="1.4.3" data-path="intro.html"><a href="intro.html#predictive-models"><i class="fa fa-check"></i><b>1.4.3</b> Predictive Models</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#pipeline"><i class="fa fa-check"></i><b>1.5</b> Data Analysis Pipeline</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#trainingeval"><i class="fa fa-check"></i><b>1.6</b> Evaluating Predictive Models</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#simple-classification-example"><i class="fa fa-check"></i><b>1.7</b> Simple Classification Example</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="intro.html"><a href="intro.html#k-fold-cross-validation-example"><i class="fa fa-check"></i><b>1.7.1</b> K-fold Cross-Validation Example</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#simple-regression-example"><i class="fa fa-check"></i><b>1.8</b> Simple Regression Example</a></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#underfitting-and-overfitting"><i class="fa fa-check"></i><b>1.9</b> Underfitting and Overfitting</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#bias-and-variance"><i class="fa fa-check"></i><b>1.10</b> Bias and Variance</a></li>
<li class="chapter" data-level="1.11" data-path="intro.html"><a href="intro.html#SummaryIntro"><i class="fa fa-check"></i><b>1.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>2</b> Predicting Behavior with Classification Models</a>
<ul>
<li class="chapter" data-level="2.1" data-path="classification.html"><a href="classification.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>2.1</b> <em>k</em>-nearest Neighbors</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="classification.html"><a href="classification.html#indoor-location-with-wi-fi-signals"><i class="fa fa-check"></i><b>2.1.1</b> Indoor Location with Wi-Fi Signals</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="classification.html"><a href="classification.html#performance-metrics"><i class="fa fa-check"></i><b>2.2</b> Performance Metrics</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="classification.html"><a href="classification.html#confusion-matrix"><i class="fa fa-check"></i><b>2.2.1</b> Confusion Matrix</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="classification.html"><a href="classification.html#decision-trees"><i class="fa fa-check"></i><b>2.3</b> Decision Trees</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="classification.html"><a href="classification.html#activityRecognition"><i class="fa fa-check"></i><b>2.3.1</b> Activity Recognition with Smartphones</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="classification.html"><a href="classification.html#naive-bayes"><i class="fa fa-check"></i><b>2.4</b> Naive Bayes</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="classification.html"><a href="classification.html#activity-recognition-with-naive-bayes"><i class="fa fa-check"></i><b>2.4.1</b> Activity Recognition with Naive Bayes</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="classification.html"><a href="classification.html#dynamic-time-warping"><i class="fa fa-check"></i><b>2.5</b> Dynamic Time Warping</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="classification.html"><a href="classification.html#sechandgestures"><i class="fa fa-check"></i><b>2.5.1</b> Hand Gesture Recognition</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="classification.html"><a href="classification.html#dummy-models"><i class="fa fa-check"></i><b>2.6</b> Dummy Models</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="classification.html"><a href="classification.html#most-frequent-class-classifier"><i class="fa fa-check"></i><b>2.6.1</b> Most-frequent-class Classifier</a></li>
<li class="chapter" data-level="2.6.2" data-path="classification.html"><a href="classification.html#uniform-classifier"><i class="fa fa-check"></i><b>2.6.2</b> Uniform Classifier</a></li>
<li class="chapter" data-level="2.6.3" data-path="classification.html"><a href="classification.html#frequency-based-classifier"><i class="fa fa-check"></i><b>2.6.3</b> Frequency-based Classifier</a></li>
<li class="chapter" data-level="2.6.4" data-path="classification.html"><a href="classification.html#other-dummy-classifiers"><i class="fa fa-check"></i><b>2.6.4</b> Other Dummy Classifiers</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="classification.html"><a href="classification.html#summaryClassification"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ensemble.html"><a href="ensemble.html"><i class="fa fa-check"></i><b>3</b> Predicting Behavior with Ensemble Learning</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ensemble.html"><a href="ensemble.html#bagging"><i class="fa fa-check"></i><b>3.1</b> Bagging</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ensemble.html"><a href="ensemble.html#activity-recognition-with-bagging"><i class="fa fa-check"></i><b>3.1.1</b> Activity recognition with Bagging</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ensemble.html"><a href="ensemble.html#random-forest"><i class="fa fa-check"></i><b>3.2</b> Random Forest</a></li>
<li class="chapter" data-level="3.3" data-path="ensemble.html"><a href="ensemble.html#stacked-generalization"><i class="fa fa-check"></i><b>3.3</b> Stacked Generalization</a></li>
<li class="chapter" data-level="3.4" data-path="ensemble.html"><a href="ensemble.html#multiviewhometasks"><i class="fa fa-check"></i><b>3.4</b> Multi-view Stacking for Home Tasks Recognition</a></li>
<li class="chapter" data-level="3.5" data-path="ensemble.html"><a href="ensemble.html#SummaryEnsemble"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="edavis.html"><a href="edavis.html"><i class="fa fa-check"></i><b>4</b> Exploring and Visualizing Behavioral Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="edavis.html"><a href="edavis.html#talking-with-field-experts"><i class="fa fa-check"></i><b>4.1</b> Talking with Field Experts</a></li>
<li class="chapter" data-level="4.2" data-path="edavis.html"><a href="edavis.html#summary-statistics"><i class="fa fa-check"></i><b>4.2</b> Summary Statistics</a></li>
<li class="chapter" data-level="4.3" data-path="edavis.html"><a href="edavis.html#class-distributions"><i class="fa fa-check"></i><b>4.3</b> Class Distributions</a></li>
<li class="chapter" data-level="4.4" data-path="edavis.html"><a href="edavis.html#user-class-sparsity-matrix"><i class="fa fa-check"></i><b>4.4</b> User-Class Sparsity Matrix</a></li>
<li class="chapter" data-level="4.5" data-path="edavis.html"><a href="edavis.html#boxplots"><i class="fa fa-check"></i><b>4.5</b> Boxplots</a></li>
<li class="chapter" data-level="4.6" data-path="edavis.html"><a href="edavis.html#correlation-plots"><i class="fa fa-check"></i><b>4.6</b> Correlation Plots</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="edavis.html"><a href="edavis.html#interactive-correlation-plots"><i class="fa fa-check"></i><b>4.6.1</b> Interactive Correlation Plots</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="edavis.html"><a href="edavis.html#timeseries"><i class="fa fa-check"></i><b>4.7</b> Timeseries</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="edavis.html"><a href="edavis.html#interactive-timeseries"><i class="fa fa-check"></i><b>4.7.1</b> Interactive Timeseries</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="edavis.html"><a href="edavis.html#multidimensional-scaling-mds"><i class="fa fa-check"></i><b>4.8</b> Multidimensional Scaling (MDS)</a></li>
<li class="chapter" data-level="4.9" data-path="edavis.html"><a href="edavis.html#heatmaps"><i class="fa fa-check"></i><b>4.9</b> Heatmaps</a></li>
<li class="chapter" data-level="4.10" data-path="edavis.html"><a href="edavis.html#automated-eda"><i class="fa fa-check"></i><b>4.10</b> Automated EDA</a></li>
<li class="chapter" data-level="4.11" data-path="edavis.html"><a href="edavis.html#SummaryExploratory"><i class="fa fa-check"></i><b>4.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i><b>5</b> Preprocessing Behavioral Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="preprocessing.html"><a href="preprocessing.html#missing-values"><i class="fa fa-check"></i><b>5.1</b> Missing Values</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="preprocessing.html"><a href="preprocessing.html#imputation"><i class="fa fa-check"></i><b>5.1.1</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="preprocessing.html"><a href="preprocessing.html#smoothing"><i class="fa fa-check"></i><b>5.2</b> Smoothing</a></li>
<li class="chapter" data-level="5.3" data-path="preprocessing.html"><a href="preprocessing.html#normalization"><i class="fa fa-check"></i><b>5.3</b> Normalization</a></li>
<li class="chapter" data-level="5.4" data-path="preprocessing.html"><a href="preprocessing.html#imbalanced-classes"><i class="fa fa-check"></i><b>5.4</b> Imbalanced Classes</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="preprocessing.html"><a href="preprocessing.html#random-oversampling"><i class="fa fa-check"></i><b>5.4.1</b> Random Oversampling</a></li>
<li class="chapter" data-level="5.4.2" data-path="preprocessing.html"><a href="preprocessing.html#smote"><i class="fa fa-check"></i><b>5.4.2</b> SMOTE</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="preprocessing.html"><a href="preprocessing.html#infoinjection"><i class="fa fa-check"></i><b>5.5</b> Information Injection</a></li>
<li class="chapter" data-level="5.6" data-path="preprocessing.html"><a href="preprocessing.html#one-hot-encoding"><i class="fa fa-check"></i><b>5.6</b> One-hot Encoding</a></li>
<li class="chapter" data-level="5.7" data-path="preprocessing.html"><a href="preprocessing.html#SummaryPreprocessing"><i class="fa fa-check"></i><b>5.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unsupervised.html"><a href="unsupervised.html"><i class="fa fa-check"></i><b>6</b> Discovering Behaviors with Unsupervised Learning</a>
<ul>
<li class="chapter" data-level="6.1" data-path="unsupervised.html"><a href="unsupervised.html#k-means-clustering"><i class="fa fa-check"></i><b>6.1</b> K-means clustering</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="unsupervised.html"><a href="unsupervised.html#studentresponses"><i class="fa fa-check"></i><b>6.1.1</b> Grouping Student Responses</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="unsupervised.html"><a href="unsupervised.html#the-silhouette-index"><i class="fa fa-check"></i><b>6.2</b> The Silhouette Index</a></li>
<li class="chapter" data-level="6.3" data-path="unsupervised.html"><a href="unsupervised.html#associationrules"><i class="fa fa-check"></i><b>6.3</b> Mining Association Rules</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="unsupervised.html"><a href="unsupervised.html#finding-rules-for-criminal-behavior"><i class="fa fa-check"></i><b>6.3.1</b> Finding Rules for Criminal Behavior</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="unsupervised.html"><a href="unsupervised.html#SummaryUnsupervised"><i class="fa fa-check"></i><b>6.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="representations.html"><a href="representations.html"><i class="fa fa-check"></i><b>7</b> Encoding Behavioral Data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="representations.html"><a href="representations.html#feature-vectors"><i class="fa fa-check"></i><b>7.1</b> Feature Vectors</a></li>
<li class="chapter" data-level="7.2" data-path="representations.html"><a href="representations.html#sectimeseries"><i class="fa fa-check"></i><b>7.2</b> Timeseries</a></li>
<li class="chapter" data-level="7.3" data-path="representations.html"><a href="representations.html#transactions"><i class="fa fa-check"></i><b>7.3</b> Transactions</a></li>
<li class="chapter" data-level="7.4" data-path="representations.html"><a href="representations.html#images"><i class="fa fa-check"></i><b>7.4</b> Images</a></li>
<li class="chapter" data-level="7.5" data-path="representations.html"><a href="representations.html#recurrence-plots"><i class="fa fa-check"></i><b>7.5</b> Recurrence Plots</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="representations.html"><a href="representations.html#computing-recurence-plots"><i class="fa fa-check"></i><b>7.5.1</b> Computing Recurence Plots</a></li>
<li class="chapter" data-level="7.5.2" data-path="representations.html"><a href="representations.html#recurrence-plots-of-hand-gestures"><i class="fa fa-check"></i><b>7.5.2</b> Recurrence Plots of Hand Gestures</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="representations.html"><a href="representations.html#bag-of-words"><i class="fa fa-check"></i><b>7.6</b> Bag-of-Words</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="representations.html"><a href="representations.html#bow-for-complex-activities."><i class="fa fa-check"></i><b>7.6.1</b> BoW for Complex Activities.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="representations.html"><a href="representations.html#graphs"><i class="fa fa-check"></i><b>7.7</b> Graphs</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="representations.html"><a href="representations.html#complex-activities-as-graphs"><i class="fa fa-check"></i><b>7.7.1</b> Complex Activities as Graphs</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="representations.html"><a href="representations.html#SummaryRepresentations"><i class="fa fa-check"></i><b>7.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="deeplearning.html"><a href="deeplearning.html"><i class="fa fa-check"></i><b>8</b> Predicting Behavior with Deep Learning</a>
<ul>
<li class="chapter" data-level="8.1" data-path="deeplearning.html"><a href="deeplearning.html#ann"><i class="fa fa-check"></i><b>8.1</b> Introduction to Artificial Neural Networks</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="deeplearning.html"><a href="deeplearning.html#sigmoid-and-relu-units"><i class="fa fa-check"></i><b>8.1.1</b> Sigmoid and ReLU Units</a></li>
<li class="chapter" data-level="8.1.2" data-path="deeplearning.html"><a href="deeplearning.html#assembling-units-into-layers"><i class="fa fa-check"></i><b>8.1.2</b> Assembling Units into Layers</a></li>
<li class="chapter" data-level="8.1.3" data-path="deeplearning.html"><a href="deeplearning.html#deep-neural-networks"><i class="fa fa-check"></i><b>8.1.3</b> Deep Neural Networks</a></li>
<li class="chapter" data-level="8.1.4" data-path="deeplearning.html"><a href="deeplearning.html#learning-the-parameters"><i class="fa fa-check"></i><b>8.1.4</b> Learning the Parameters</a></li>
<li class="chapter" data-level="8.1.5" data-path="deeplearning.html"><a href="deeplearning.html#parameter-learning-example-in-r"><i class="fa fa-check"></i><b>8.1.5</b> Parameter Learning Example in R</a></li>
<li class="chapter" data-level="8.1.6" data-path="deeplearning.html"><a href="deeplearning.html#stochastic-gradient-descent"><i class="fa fa-check"></i><b>8.1.6</b> Stochastic Gradient Descent</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="deeplearning.html"><a href="deeplearning.html#keras-and-tensorflow-with-r"><i class="fa fa-check"></i><b>8.2</b> Keras and TensorFlow with R</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="deeplearning.html"><a href="deeplearning.html#keras-example"><i class="fa fa-check"></i><b>8.2.1</b> Keras Example</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="deeplearning.html"><a href="deeplearning.html#classification-with-neural-networks"><i class="fa fa-check"></i><b>8.3</b> Classification with Neural Networks</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="deeplearning.html"><a href="deeplearning.html#classification-of-electromyography-signals"><i class="fa fa-check"></i><b>8.3.1</b> Classification of Electromyography Signals</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="deeplearning.html"><a href="deeplearning.html#overfitting"><i class="fa fa-check"></i><b>8.4</b> Overfitting</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="deeplearning.html"><a href="deeplearning.html#early-stopping"><i class="fa fa-check"></i><b>8.4.1</b> Early Stopping</a></li>
<li class="chapter" data-level="8.4.2" data-path="deeplearning.html"><a href="deeplearning.html#dropout"><i class="fa fa-check"></i><b>8.4.2</b> Dropout</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="deeplearning.html"><a href="deeplearning.html#fine-tuning-a-neural-network"><i class="fa fa-check"></i><b>8.5</b> Fine-Tuning a Neural Network</a></li>
<li class="chapter" data-level="8.6" data-path="deeplearning.html"><a href="deeplearning.html#cnns"><i class="fa fa-check"></i><b>8.6</b> Convolutional Neural Networks</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="deeplearning.html"><a href="deeplearning.html#convolutions"><i class="fa fa-check"></i><b>8.6.1</b> Convolutions</a></li>
<li class="chapter" data-level="8.6.2" data-path="deeplearning.html"><a href="deeplearning.html#pooling-operations"><i class="fa fa-check"></i><b>8.6.2</b> Pooling Operations</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="deeplearning.html"><a href="deeplearning.html#cnns-with-keras"><i class="fa fa-check"></i><b>8.7</b> CNNs with Keras</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="deeplearning.html"><a href="deeplearning.html#example-1"><i class="fa fa-check"></i><b>8.7.1</b> Example 1</a></li>
<li class="chapter" data-level="8.7.2" data-path="deeplearning.html"><a href="deeplearning.html#example-2"><i class="fa fa-check"></i><b>8.7.2</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="deeplearning.html"><a href="deeplearning.html#cnnSmile"><i class="fa fa-check"></i><b>8.8</b> Smiles Detection with a CNN</a></li>
<li class="chapter" data-level="8.9" data-path="deeplearning.html"><a href="deeplearning.html#SummaryDeepLearning"><i class="fa fa-check"></i><b>8.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="multiuser.html"><a href="multiuser.html"><i class="fa fa-check"></i><b>9</b> Multi-User Validation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="multiuser.html"><a href="multiuser.html#mixed-models"><i class="fa fa-check"></i><b>9.1</b> Mixed Models</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="multiuser.html"><a href="multiuser.html#skeleton-action-recognition-with-mixed-models"><i class="fa fa-check"></i><b>9.1.1</b> Skeleton Action Recognition with Mixed Models</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="multiuser.html"><a href="multiuser.html#user-independent-models"><i class="fa fa-check"></i><b>9.2</b> User-Independent Models</a></li>
<li class="chapter" data-level="9.3" data-path="multiuser.html"><a href="multiuser.html#user-dependent-models"><i class="fa fa-check"></i><b>9.3</b> User-Dependent Models</a></li>
<li class="chapter" data-level="9.4" data-path="multiuser.html"><a href="multiuser.html#user-adaptive-models"><i class="fa fa-check"></i><b>9.4</b> User-Adaptive Models</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="multiuser.html"><a href="multiuser.html#transfer-learning"><i class="fa fa-check"></i><b>9.4.1</b> Transfer Learning</a></li>
<li class="chapter" data-level="9.4.2" data-path="multiuser.html"><a href="multiuser.html#a-user-adaptive-model-for-activity-recognition"><i class="fa fa-check"></i><b>9.4.2</b> A User-Adaptive Model for Activity Recognition</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="multiuser.html"><a href="multiuser.html#SummaryMultiUser"><i class="fa fa-check"></i><b>9.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html"><i class="fa fa-check"></i><b>10</b> Detecting Abnormal Behaviors</a>
<ul>
<li class="chapter" data-level="10.1" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#isolation-forests"><i class="fa fa-check"></i><b>10.1</b> Isolation Forests</a></li>
<li class="chapter" data-level="10.2" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#detecting-abnormal-fish-behaviors"><i class="fa fa-check"></i><b>10.2</b> Detecting Abnormal Fish Behaviors</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#exploring-and-visualizing-trajectories"><i class="fa fa-check"></i><b>10.2.1</b> Exploring and Visualizing Trajectories</a></li>
<li class="chapter" data-level="10.2.2" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#preprocessing-and-feature-extraction"><i class="fa fa-check"></i><b>10.2.2</b> Preprocessing and Feature Extraction</a></li>
<li class="chapter" data-level="10.2.3" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#training-the-model"><i class="fa fa-check"></i><b>10.2.3</b> Training the Model</a></li>
<li class="chapter" data-level="10.2.4" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#roc-curve-and-auc"><i class="fa fa-check"></i><b>10.2.4</b> ROC curve and AUC</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#autoencoders"><i class="fa fa-check"></i><b>10.3</b> Autoencoders</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#autoencoders-for-anomaly-detection"><i class="fa fa-check"></i><b>10.3.1</b> Autoencoders for Anomaly Detection</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="abnormalbehaviors.html"><a href="abnormalbehaviors.html#SummaryAnomalyDetection"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendixInstall.html"><a href="appendixInstall.html"><i class="fa fa-check"></i><b>A</b> Setup Your Environment</a>
<ul>
<li class="chapter" data-level="A.1" data-path="appendixInstall.html"><a href="appendixInstall.html#installing-the-datasets"><i class="fa fa-check"></i><b>A.1</b> Installing the Datasets</a></li>
<li class="chapter" data-level="A.2" data-path="appendixInstall.html"><a href="appendixInstall.html#installing-the-examples-source-code"><i class="fa fa-check"></i><b>A.2</b> Installing the Examples Source Code</a></li>
<li class="chapter" data-level="A.3" data-path="appendixInstall.html"><a href="appendixInstall.html#running-shiny-apps"><i class="fa fa-check"></i><b>A.3</b> Running Shiny Apps</a></li>
<li class="chapter" data-level="A.4" data-path="appendixInstall.html"><a href="appendixInstall.html#installing-keras-and-tensorflow"><i class="fa fa-check"></i><b>A.4</b> Installing Keras and TensorFlow</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendixDatasets.html"><a href="appendixDatasets.html"><i class="fa fa-check"></i><b>B</b> Datasets</a>
<ul>
<li class="chapter" data-level="B.1" data-path="appendixDatasets.html"><a href="appendixDatasets.html#complex-activities"><i class="fa fa-check"></i><b>B.1</b> COMPLEX ACTIVITIES</a></li>
<li class="chapter" data-level="B.2" data-path="appendixDatasets.html"><a href="appendixDatasets.html#depresjon"><i class="fa fa-check"></i><b>B.2</b> DEPRESJON</a></li>
<li class="chapter" data-level="B.3" data-path="appendixDatasets.html"><a href="appendixDatasets.html#electromyography"><i class="fa fa-check"></i><b>B.3</b> ELECTROMYOGRAPHY</a></li>
<li class="chapter" data-level="B.4" data-path="appendixDatasets.html"><a href="appendixDatasets.html#fish-trajectories"><i class="fa fa-check"></i><b>B.4</b> FISH TRAJECTORIES</a></li>
<li class="chapter" data-level="B.5" data-path="appendixDatasets.html"><a href="appendixDatasets.html#hand-gestures"><i class="fa fa-check"></i><b>B.5</b> HAND GESTURES</a></li>
<li class="chapter" data-level="B.6" data-path="appendixDatasets.html"><a href="appendixDatasets.html#home-tasks"><i class="fa fa-check"></i><b>B.6</b> HOME TASKS</a></li>
<li class="chapter" data-level="B.7" data-path="appendixDatasets.html"><a href="appendixDatasets.html#homicide-reports"><i class="fa fa-check"></i><b>B.7</b> HOMICIDE REPORTS</a></li>
<li class="chapter" data-level="B.8" data-path="appendixDatasets.html"><a href="appendixDatasets.html#indoor-location"><i class="fa fa-check"></i><b>B.8</b> INDOOR LOCATION</a></li>
<li class="chapter" data-level="B.9" data-path="appendixDatasets.html"><a href="appendixDatasets.html#sheep-goats"><i class="fa fa-check"></i><b>B.9</b> SHEEP GOATS</a></li>
<li class="chapter" data-level="B.10" data-path="appendixDatasets.html"><a href="appendixDatasets.html#skeleton-actions"><i class="fa fa-check"></i><b>B.10</b> SKELETON ACTIONS</a></li>
<li class="chapter" data-level="B.11" data-path="appendixDatasets.html"><a href="appendixDatasets.html#smartphone-activities"><i class="fa fa-check"></i><b>B.11</b> SMARTPHONE ACTIVITIES</a></li>
<li class="chapter" data-level="B.12" data-path="appendixDatasets.html"><a href="appendixDatasets.html#smiles"><i class="fa fa-check"></i><b>B.12</b> SMILES</a></li>
<li class="chapter" data-level="B.13" data-path="appendixDatasets.html"><a href="appendixDatasets.html#students-mental-health"><i class="fa fa-check"></i><b>B.13</b> STUDENTS’ MENTAL HEALTH</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="citing-this-book.html"><a href="citing-this-book.html"><i class="fa fa-check"></i>Citing this Book</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Behavior Analysis with Machine Learning Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="classification" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Predicting Behavior with Classification Models</h1>
<p>In the previous chapter, the concept of <strong>classification</strong> was introduced along with a simple example (feline-type classification). This chapter will cover more in depth concepts on classification methods and their application to behavior analysis tasks. Moreover, additional <strong>performance metrics</strong> will be introduced. This chapter begins with an introduction to <strong><span class="math inline">\(k\)</span>-nearest neighbors (<span class="math inline">\(k\)</span>-NN)</strong> which is one of the simplest classification algorithms. Then, an example of <span class="math inline">\(k\)</span>-NN applied to indoor location using Wi-Fi signals is presented. This chapter also covers <strong>Decision Trees</strong> and <strong>Naive Bayes</strong> classifiers and how they can be used for activity recognition based on smartphone accelerometer data. After that, <strong>Dynamic Time Warping (DTW)</strong> (a method for aligning time series) is introduced, together with an example of how it can be used for hand gesture recognition.</p>
<div id="k-nearest-neighbors" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> <em>k</em>-nearest Neighbors</h2>
<p><span class="math inline">\(k\)</span>-nearest neighbors (<span class="math inline">\(k\)</span>-NN) is one of the simplest classification algorithms. The predicted class for a given <em>query instance</em> is the most common class of its <em>k</em> nearest neighbors. A <em>query instance</em> is just the instance we want to make predictions on. In its most basic form, the algorithm consists of two steps:</p>
<ol style="list-style-type: decimal">
<li>Compute the distance between the <em>query instance</em> and all <em>training instances</em>.</li>
<li>Return the most common class label among the <em>k</em> nearest training instances (neighbors).</li>
</ol>
<p>This is a type of <em>lazy-learning</em> algorithm because all the computations take place at prediction time. There are no parameters to learn at training time! The training phase consists only of storing the training instances so they can be compared to the query instance at prediction time. The hyper-parameter <em>k</em> is usually specified by the user and depends on each application. We also need to specify a <em>distance function</em> that returns small distances for similar instances and big distances for very dissimilar instances. For numeric features, the <strong>Euclidean distance</strong> is one of the most commonly used distance function. The Euclidean distance between two points can be computed as follows:</p>
<p><span class="math display" id="eq:euclideanDistance">\[\begin{equation}
  d\left(p,q\right) = \sqrt{\sum_{i=1}^n{\left(p_i-q_i\right)^2}}
  \tag{2.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> are <span class="math inline">\(n\)</span>-dimensional feature vectors and <span class="math inline">\(i\)</span> is the index to the vectors’ elements. Figure <a href="classification.html#fig:simpleKnn">2.1</a> shows the idea graphically. (Figure inspired from the <span class="math inline">\(k\)</span>-NN article<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> in Wikipedia). The query instance is depicted with the ‘?’ symbol. If we choose <span class="math inline">\(k=3\)</span> (represented by the inner dashed circle) the predicted class is <em>‘square’</em> because there are two squares but only one circle. If <span class="math inline">\(k=5\)</span> (outer dotted circle), the predicted class is <em>‘circle’</em>.</p>
<div class="figure" style="text-align: center"><span id="fig:simpleKnn"></span>
<img src="images/knn.png" alt="k-NN example for k=3 (inner dashed circle) and k=5 (dotted outer circle)." width="40%" />
<p class="caption">
FIGURE 2.1: k-NN example for k=3 (inner dashed circle) and k=5 (dotted outer circle).
</p>
</div>
<p>Typical values for <span class="math inline">\(k\)</span> are small odd numbers like <span class="math inline">\(1,2,3,5\)</span>. The <span class="math inline">\(k\)</span>-NN algorithm can also be used for regression with a small modification: Instead of returning the majority class of the nearest neighbors, return the mean value of their response variable. Despite its simplicity, <span class="math inline">\(k\)</span>-NN has proved to perform really well in many tasks including time series classification <span class="citation">(<a href="#ref-xi2006" role="doc-biblioref">Xi et al. 2006</a>)</span>.</p>
<div id="indoor-location-with-wi-fi-signals" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Indoor Location with Wi-Fi Signals</h3>

<div class="rmdfolder">
<code>indoor_classification.R</code> <code>indoor_auxiliary.R</code>
</div>
<p>You might already have experienced some troubles with geolocation services when you are inside a building. Part of this is because GPS technologies do not provide good indoors accuracy due to several sources of interference. For some applications, it would be beneficial to have accurate location estimations inside buildings even at room-level. For example, in domotics and localization services in big public places like airports or shopping malls. Having good indoor location estimates can also be used in behavior analysis such as extracting trajectory patterns.</p>
<p>In this section, we will implement <span class="math inline">\(k\)</span>-NN to perform indoor location in a building based on Wi-Fi signals. For instance, we can use a smartphone to scan the nearby Wi-Fi access points and based on this information, determine our location at room-level. This can be formulated as a classification problem: Given a set of Wi-Fi signals as input, predict the location where the device is located.</p>
<p>For this classification problem, we will use the <em>INDOOR LOCATION</em> dataset (see Appendix <a href="appendixDatasets.html#appendixDatasets">B</a>) which was collected with an Android smartphone. The smartphone application scans the nearby access points and stores their information and label. The label is provided by the user and represents the room where the device is located. Several instances for every location were recorded. To generate each instance, the device scans and records the MAC address and signal strength of the nearby access points. A delay of <span class="math inline">\(500\)</span> ms is set between scans. For each location, approximately <span class="math inline">\(3\)</span> minutes of data were collected while the user walked in the specific room. Figure <a href="classification.html#fig:layoutHouse">2.2</a> depicts the layout of the building where the data was collected. The data has four different locations: <em>‘bedroomA’</em>, <em>‘beadroomB’</em>, <em>‘tvroom’</em>, and the <em>‘lobby’</em>. The lobby (not shown in the layout) is at the same level as bedroom A but on the first floor.</p>
<div class="figure" style="text-align: center"><span id="fig:layoutHouse"></span>
<img src="images/layout.png" alt="Layout of the apartments building." width="90%" />
<p class="caption">
FIGURE 2.2: Layout of the apartments building.
</p>
</div>
<p>Table <a href="classification.html#tab:headWifi">2.1</a> shows the first rows of the dataset. The first column is the class. <code>scanid</code> column is a unique identifier for the given Wi-Fi scan (instance). To preserve privacy, MAC addresses were converted into integer values. Every instance is composed of several rows. For example, the first instance with <code>scanid=1</code> has two rows (one row per mac address). Intuitively, the same location should have similar MAC addresses across scans. From the table, we can see that at <em>bedroomA</em> access points with MAC address <span class="math inline">\(1\)</span> and <span class="math inline">\(2\)</span> are usually found by the device.</p>
<table>
<caption><span id="tab:headWifi">TABLE 2.1: </span>First rows of wifi scans.</caption>
<thead>
<tr class="header">
<th align="left">locationid</th>
<th align="right">scanid</th>
<th align="right">mac</th>
<th align="right">signalstrength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">bedroomA</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-88.50</td>
</tr>
<tr class="even">
<td align="left">bedroomA</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">-91.00</td>
</tr>
<tr class="odd">
<td align="left">bedroomA</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">-88.00</td>
</tr>
<tr class="even">
<td align="left">bedroomA</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">-90.00</td>
</tr>
<tr class="odd">
<td align="left">bedroomA</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">-87.62</td>
</tr>
<tr class="even">
<td align="left">bedroomA</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">-90.00</td>
</tr>
<tr class="odd">
<td align="left">bedroomA</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">-90.25</td>
</tr>
<tr class="even">
<td align="left">bedroomA</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">-90.00</td>
</tr>
<tr class="odd">
<td align="left">bedroomA</td>
<td align="right">4</td>
<td align="right">3</td>
<td align="right">-91.00</td>
</tr>
</tbody>
</table>
<p>Since each instance is composed of several rows, we will convert our data frame into a list of lists where each inner list represents a single instance with the class (<code>locationId</code>), a unique id, and a data frame with the corresponding access points. The example code can be found in the script <code>indoor_classification.R</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="classification.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wi-Fi data</span></span>
<span id="cb20-2"><a href="classification.html#cb20-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(datapath, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb20-3"><a href="classification.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="classification.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert data frame into a list of lists.</span></span>
<span id="cb20-5"><a href="classification.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Each inner list represents one instance.</span></span>
<span id="cb20-6"><a href="classification.html#cb20-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">wifiScansToList</span>(df)</span>
<span id="cb20-7"><a href="classification.html#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="classification.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of instances in the dataset.</span></span>
<span id="cb20-9"><a href="classification.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(dataset)</span>
<span id="cb20-10"><a href="classification.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 365</span></span>
<span id="cb20-11"><a href="classification.html#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="classification.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first instance.</span></span>
<span id="cb20-13"><a href="classification.html#cb20-13" aria-hidden="true" tabindex="-1"></a>dataset[[<span class="dv">1</span>]]</span>
<span id="cb20-14"><a href="classification.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $locationId</span></span>
<span id="cb20-15"><a href="classification.html#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;bedroomA&quot;</span></span>
<span id="cb20-16"><a href="classification.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-17"><a href="classification.html#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $scanId</span></span>
<span id="cb20-18"><a href="classification.html#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb20-19"><a href="classification.html#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-20"><a href="classification.html#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $accessPoints</span></span>
<span id="cb20-21"><a href="classification.html#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   mac signalstrength</span></span>
<span id="cb20-22"><a href="classification.html#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1          -88.5</span></span>
<span id="cb20-23"><a href="classification.html#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   2          -91.0</span></span></code></pre></div>
<p>First, we read the dataset from the csv file and store it in the data frame <code>df</code>. To make things easier, the data frame is converted into a list of lists using the auxiliary function <code>wifiScansToList()</code> which is defined in the script <code>indoor_auxiliary.R</code>. Next, we print the number of instances in the dataset, that is, the number of lists in the dataset. The dataset contains <span class="math inline">\(365\)</span> instances. The <span class="math inline">\(365\)</span> was just a coincidence, the data was not collected every day during one year but in the same day. Next, we extract the first instance with <code>dataset[[1]]</code>. Here, we see that each instance has three pieces of information. The class (locationId), a unique id (scanId), and a set of access points stored in a data frame. The first instance has two access points with MAC addresses <span class="math inline">\(1\)</span> and <span class="math inline">\(2\)</span>. There is also information about the signal strength, though, this one will not be used.</p>
<p>Since we would expect that similar locations have similar MAC addresses and locations that are far away from each other have different MAC addresses, we need a distance measure that captures this notion of similarity. In this case, we cannot use the Euclidean distance on MAC addresses. Even though they were encoded as integer values, they do not represent magnitudes but unique identifiers. Each instance is composed of a set of <span class="math inline">\(n\)</span> MAC addresses stored in the <code>accessPoints</code> data frame. To compute the distance between two instances (two sets) we can use the <em>Jaccard distance</em>. This distance is based on element sets:</p>
<p><span class="math display" id="eq:jaccardDistance">\[\begin{equation}
  j\left(A,B\right)=\frac{\left|A\cup B\right|-\left|A\cap B\right|}{\left|A\cup B\right|}
  \tag{2.2}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are sets of MAC addresses. A <strong>set</strong> is an unordered collection of elements with no repetitions. As an example, let’s say we have two sets, <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span>:</p>
<p><span class="math display">\[\begin{align*}
S_1&amp;=\{a,b,c,d,e\}\\
S_2&amp;=\{e,f,g,a\}
\end{align*}\]</span></p>
<p>The set <span class="math inline">\(S_1\)</span> has <span class="math inline">\(5\)</span> elements (letters) and <span class="math inline">\(S_2\)</span> has <span class="math inline">\(4\)</span> elements. <span class="math inline">\(A \cup B\)</span> means the <strong>union</strong> of the two sets <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> and its result is the set of all elements that are either in <span class="math inline">\(A\)</span> or <span class="math inline">\(B\)</span>. For instance, the union of <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> is <span class="math inline">\(S_1 \cup S_2 = \{a,b,c,d,e,f,g\}\)</span>. The <span class="math inline">\(A \cap B\)</span> denotes the <strong>intersection</strong> between <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> which is the set of elements that are in both <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. In our example, <span class="math inline">\(S_1 \cap S_2 = \{a,e\}\)</span>. Finally the vertical bars <span class="math inline">\(||\)</span> mean the <strong>cardinality</strong> of the set, that is, its number of elements. The cardinality of <span class="math inline">\(S_1\)</span> is <span class="math inline">\(|S_1|=5\)</span> because it has <span class="math inline">\(5\)</span> elements. The cardinality of the union of the two sets <span class="math inline">\(|S_1 \cup S_2|=7\)</span> because this set has <span class="math inline">\(7\)</span> elements.</p>
<p>In R, we can implement the Jaccard distance as follows:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="classification.html#cb21-1" aria-hidden="true" tabindex="-1"></a>jaccardDistance <span class="ot">&lt;-</span> <span class="cf">function</span>(set1, set2){</span>
<span id="cb21-2"><a href="classification.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  lengthUnion <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">union</span>(set1, set2))</span>
<span id="cb21-3"><a href="classification.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  lengthIntersectoin <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">intersect</span>(set1, set2))</span>
<span id="cb21-4"><a href="classification.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> (lengthUnion <span class="sc">-</span> lengthIntersectoin)  <span class="sc">/</span> lengthUnion</span>
<span id="cb21-5"><a href="classification.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(d)</span>
<span id="cb21-6"><a href="classification.html#cb21-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The implementation is in the script <code>indoor_auxiliary.R</code>. Now, we can try our function! Let’s compute the distance between two instances of the same class (<em>‘bedroomA’</em>).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="classification.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute jaccard distance between instances with same class:</span></span>
<span id="cb22-2"><a href="classification.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (bedroomA)</span></span>
<span id="cb22-3"><a href="classification.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">jaccardDistance</span>(dataset[[<span class="dv">1</span>]]<span class="sc">$</span>accessPoints<span class="sc">$</span>mac,</span>
<span id="cb22-4"><a href="classification.html#cb22-4" aria-hidden="true" tabindex="-1"></a>                dataset[[<span class="dv">4</span>]]<span class="sc">$</span>accessPoints<span class="sc">$</span>mac)</span>
<span id="cb22-5"><a href="classification.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.3333333</span></span></code></pre></div>
<p>Now let’s try to compute the distance between instances with different classes.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="classification.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Jaccard distance of instances with different class:</span></span>
<span id="cb23-2"><a href="classification.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (bedroomA and bedroomB)</span></span>
<span id="cb23-3"><a href="classification.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">jaccardDistance</span>(dataset[[<span class="dv">1</span>]]<span class="sc">$</span>accessPoints<span class="sc">$</span>mac,</span>
<span id="cb23-4"><a href="classification.html#cb23-4" aria-hidden="true" tabindex="-1"></a>                dataset[[<span class="dv">210</span>]]<span class="sc">$</span>accessPoints<span class="sc">$</span>mac)</span>
<span id="cb23-5"><a href="classification.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.6666667</span></span></code></pre></div>
<p>The distance between instances of the same class was <span class="math inline">\(0.33\)</span> whereas the distance between instances of the different classes was <span class="math inline">\(0.66\)</span>. So, our function is working as expected.</p>
<p>In the extreme case when the sets <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are identical, the distance will be <span class="math inline">\(0\)</span>. When there are no common elements in the sets, the distance will be <span class="math inline">\(1\)</span>. Armed with this distance metric, we can now implement the <span class="math inline">\(k\)</span>-NN function in R. The <code>knn_classifier()</code> implementation is in the script <code>indoor_auxiliary.R</code>. Its first argument is the dataset (the list of instances). The second argument <em>k</em>, is the number of nearest neighbors to use, and the last two arguments are the indices of the train and test instances, respectively. This indices are pointers to the elements in the <code>dataset</code> variable.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="classification.html#cb24-1" aria-hidden="true" tabindex="-1"></a>knn_classifier <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, k, trainSetIndices, testSetIndices){</span>
<span id="cb24-2"><a href="classification.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-3"><a href="classification.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  groundTruth <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb24-4"><a href="classification.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb24-5"><a href="classification.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-6"><a href="classification.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(queryInstance <span class="cf">in</span> testSetIndices){</span>
<span id="cb24-7"><a href="classification.html#cb24-7" aria-hidden="true" tabindex="-1"></a>    distancesToQuery <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb24-8"><a href="classification.html#cb24-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-9"><a href="classification.html#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(trainInstance <span class="cf">in</span> trainSetIndices){</span>
<span id="cb24-10"><a href="classification.html#cb24-10" aria-hidden="true" tabindex="-1"></a>      jd <span class="ot">&lt;-</span> <span class="fu">jaccardDistance</span>(dataset[[queryInstance]]<span class="sc">$</span>accessPoints<span class="sc">$</span>mac,</span>
<span id="cb24-11"><a href="classification.html#cb24-11" aria-hidden="true" tabindex="-1"></a>                            dataset[[trainInstance]]<span class="sc">$</span>accessPoints<span class="sc">$</span>mac)</span>
<span id="cb24-12"><a href="classification.html#cb24-12" aria-hidden="true" tabindex="-1"></a>      distancesToQuery <span class="ot">&lt;-</span> <span class="fu">c</span>(distancesToQuery, jd)</span>
<span id="cb24-13"><a href="classification.html#cb24-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-14"><a href="classification.html#cb24-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-15"><a href="classification.html#cb24-15" aria-hidden="true" tabindex="-1"></a>    indices <span class="ot">&lt;-</span> <span class="fu">sort</span>(distancesToQuery, <span class="at">index.return =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>ix</span>
<span id="cb24-16"><a href="classification.html#cb24-16" aria-hidden="true" tabindex="-1"></a>    indices <span class="ot">&lt;-</span> indices[<span class="dv">1</span><span class="sc">:</span>k]</span>
<span id="cb24-17"><a href="classification.html#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Indices of the k nearest neighbors</span></span>
<span id="cb24-18"><a href="classification.html#cb24-18" aria-hidden="true" tabindex="-1"></a>    nnIndices <span class="ot">&lt;-</span> trainSetIndices[indices]</span>
<span id="cb24-19"><a href="classification.html#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the actual instances</span></span>
<span id="cb24-20"><a href="classification.html#cb24-20" aria-hidden="true" tabindex="-1"></a>    nnInstances <span class="ot">&lt;-</span> dataset[nnIndices]</span>
<span id="cb24-21"><a href="classification.html#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get their respective classes</span></span>
<span id="cb24-22"><a href="classification.html#cb24-22" aria-hidden="true" tabindex="-1"></a>    nnClasses <span class="ot">&lt;-</span> <span class="fu">sapply</span>(nnInstances, <span class="cf">function</span>(e){e[[<span class="dv">1</span>]]})</span>
<span id="cb24-23"><a href="classification.html#cb24-23" aria-hidden="true" tabindex="-1"></a>    prediction <span class="ot">&lt;-</span> <span class="fu">Mode</span>(nnClasses)</span>
<span id="cb24-24"><a href="classification.html#cb24-24" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">c</span>(predictions, prediction)</span>
<span id="cb24-25"><a href="classification.html#cb24-25" aria-hidden="true" tabindex="-1"></a>    groundTruth <span class="ot">&lt;-</span> <span class="fu">c</span>(groundTruth,</span>
<span id="cb24-26"><a href="classification.html#cb24-26" aria-hidden="true" tabindex="-1"></a>                     dataset[[queryInstance]]<span class="sc">$</span>locationId)</span>
<span id="cb24-27"><a href="classification.html#cb24-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-28"><a href="classification.html#cb24-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-29"><a href="classification.html#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">predictions =</span> predictions,</span>
<span id="cb24-30"><a href="classification.html#cb24-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">groundTruth =</span> groundTruth))</span>
<span id="cb24-31"><a href="classification.html#cb24-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>For each instance <code>queryInstance</code> in the test set, the <code>knn_classifier()</code> computes its jaccard distance to every other instance in the train set and stores those distances in <code>distancesToQuery</code>. Then, those distances are sorted in ascending order and the most common class among the first <span class="math inline">\(k\)</span> elements is returned as the predicted class. The function <code>Mode()</code> returns the most common element. Finally, <code>knn_classifier()</code> returns a list with the predictions for every instance in the test set and their respective ground truth class for evaluation.</p>
<p>Now, we can try our classifier. We will use <span class="math inline">\(70\%\)</span> of the dataset as train set and the remaining as the test set.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="classification.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of instances</span></span>
<span id="cb25-2"><a href="classification.html#cb25-2" aria-hidden="true" tabindex="-1"></a>numberInstances <span class="ot">&lt;-</span> <span class="fu">length</span>(dataset)</span>
<span id="cb25-3"><a href="classification.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb25-4"><a href="classification.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb25-5"><a href="classification.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split into train and test sets.</span></span>
<span id="cb25-6"><a href="classification.html#cb25-6" aria-hidden="true" tabindex="-1"></a>trainSetIndices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>numberInstances,</span>
<span id="cb25-7"><a href="classification.html#cb25-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">size =</span> <span class="fu">round</span>(numberInstances <span class="sc">*</span> <span class="fl">0.7</span>),</span>
<span id="cb25-8"><a href="classification.html#cb25-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">replace =</span> F)</span>
<span id="cb25-9"><a href="classification.html#cb25-9" aria-hidden="true" tabindex="-1"></a>testSetIndices <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>numberInstances)[<span class="sc">-</span>trainSetIndices]</span></code></pre></div>
<p>The function <code>knn_classifier()</code> predicts the class for each test set instance and returns a list with their predictions and their ground truth classes. With this information, we can compute the <em>accuracy</em> on the test set which is the percentage of correctly classified instances. In this example, we set <span class="math inline">\(k=3\)</span>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="classification.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain predictions on the test set.</span></span>
<span id="cb26-2"><a href="classification.html#cb26-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">knn_classifier</span>(dataset,</span>
<span id="cb26-3"><a href="classification.html#cb26-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">k =</span> <span class="dv">3</span>,</span>
<span id="cb26-4"><a href="classification.html#cb26-4" aria-hidden="true" tabindex="-1"></a>                         trainSetIndices,</span>
<span id="cb26-5"><a href="classification.html#cb26-5" aria-hidden="true" tabindex="-1"></a>                         testSetIndices)</span>
<span id="cb26-6"><a href="classification.html#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate and print accuracy.</span></span>
<span id="cb26-7"><a href="classification.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(result<span class="sc">$</span>predictions <span class="sc">==</span> result<span class="sc">$</span>groundTruth) <span class="sc">/</span></span>
<span id="cb26-8"><a href="classification.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(result<span class="sc">$</span>predictions)</span>
<span id="cb26-9"><a href="classification.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.9454545</span></span></code></pre></div>
<p>Not bad! Our simple <span class="math inline">\(k\)</span>-NN algorithm achieved an accuracy of <span class="math inline">\(94.5\%\)</span>. Usually, it is a good idea to visualize the predictions to have a better understanding of the classifier’s behavior. <strong>Confusion matrices</strong> allow us to exactly do that. We can use the <code>confusionMatrix()</code> function from the <code>caret</code> package to generate a confusion matrix. Its first argument is a factor with the predictions and the second one is a factor with the corresponding true values. This function returns an object with several performance metrics (see next section) and the confusion matrix. The actual confusion matrix is stored in the <code>table</code> object.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="classification.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb27-2"><a href="classification.html#cb27-2" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(result<span class="sc">$</span>predictions),</span>
<span id="cb27-3"><a href="classification.html#cb27-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(result<span class="sc">$</span>groundTruth))</span>
<span id="cb27-4"><a href="classification.html#cb27-4" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>table <span class="co"># Access the confusion matrix.</span></span>
<span id="cb27-5"><a href="classification.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Reference</span></span>
<span id="cb27-6"><a href="classification.html#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prediction bedroomA bedroomB lobby tvroom</span></span>
<span id="cb27-7"><a href="classification.html#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; bedroomA       26        0     3      1</span></span>
<span id="cb27-8"><a href="classification.html#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; bedroomB        0       17     0      1</span></span>
<span id="cb27-9"><a href="classification.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lobby           0        1    28      0</span></span>
<span id="cb27-10"><a href="classification.html#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tvroom          0        0     0     33</span></span></code></pre></div>
<p>The columns of the confusion matrix represent the true classes and the rows the predictions. For example, from the total <span class="math inline">\(31\)</span> instances of type <em>‘lobby’</em>, <span class="math inline">\(28\)</span> were correctly classified as <em>‘lobby’</em> while <span class="math inline">\(3\)</span> were misclassified as <em>‘bedroomA’</em>. Something I find useful is to plot the confusion matrix as proportions instead of counts (Figure <a href="classification.html#fig:wifiCM">2.3</a>). From this confusion matrix we can see that for the class <em>‘bedroomB’</em>, <span class="math inline">\(94\%\)</span> of the instances were correctly classified while <span class="math inline">\(6\%\)</span> were mislabeled as <em>‘lobby’</em>. On the other hand, instances of type <em>‘bedroomA’</em> were always classified correctly.</p>
<div class="figure" style="text-align: center"><span id="fig:wifiCM"></span>
<img src="images/indoorCM.png" alt="Confusion matrix for location predictions." width="70%" />
<p class="caption">
FIGURE 2.3: Confusion matrix for location predictions.
</p>
</div>
<p>A confusion matrix is a good way to analyze the classification results per class and it helps to spot weaknesses which can be used to improve the model, for example, by extracting additional features.</p>
</div>
</div>
<div id="performance-metrics" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Performance Metrics</h2>
<p>Performance metrics allow us to assess the generalization performance of a model from different angles. The most common performance metric for classification is the accuracy:</p>
<p><span class="math display" id="eq:metricAccuracy">\[\begin{equation}
  accuracy = \frac{\# \textrm{ correctly classified instances}}{\textrm{total } \# \textrm{ instances}}
  \tag{2.3}
\end{equation}\]</span></p>
<p>In order to have a better understanding of the generalization performance of a model, it is a good practice to compute several performance metrics in addition to the accuracy. Accuracy also has some limitations, especially in highly imbalanced datasets. The following metrics provide different views of a model’s performance for the binary case (when there are only two classes). These metrics can be extended to the multi-class setting using a <em>one v.s. all</em> approach. That is, compare each class to the remaining classes.</p>
<p>Before introducing the other metrics, it is convenient to define some terms:</p>
<ul>
<li>True positives (TP): Positive examples classified as positives.</li>
<li>True negatives (TN): Negative examples classified as negatives.</li>
<li>False positives (FP): Negative examples misclassified as positives.</li>
<li>False negatives (FN): Positive examples misclassified as negatives.</li>
</ul>
<p>For the binary classification case, it is you who decide which one is the positive class. For example, if your problem is about detecting falls and you have two classes: <em>‘fall’</em> and <em>‘nofall’</em>, then, considering <em>‘fall’</em> as the positive class makes sense since this is the one you are most interested in detecting. The following, is a list of commonly used metrics in classification:</p>
<p><strong>Recall:</strong> The proportion of positives that are classified as such. Alternative names for recall are: <strong>true positive rate</strong>, <strong>sensitivity</strong>, and <strong>hit rate</strong>. In fact, the diagonal of the confusion matrix with proportions of the indoor location example shows the recall for each class (Figure <a href="classification.html#fig:wifiCM">2.3</a>).</p>
<p><span class="math display" id="eq:metricRecall">\[\begin{equation}
  recall = \frac{\textrm{TP}}{\textrm{P}}
  \tag{2.4}
\end{equation}\]</span></p>
<p><strong>Specificity:</strong> The proportion of negatives classified as such. It is also called the <strong>true negative rate</strong>.</p>
<p><span class="math display" id="eq:metricSpecificity">\[\begin{equation}
  specificity = \frac{\textrm{TN}}{\textrm{N}}
  \tag{2.5}
\end{equation}\]</span></p>
<p><strong>Precision:</strong> The fraction of true positives among those classified as positives. Also known as the <strong>positive predictive value</strong>.</p>
<p><span class="math display" id="eq:metricPrecision">\[\begin{equation}
  precision = \frac{\textrm{TP}}{\textrm{TP + FP}}
  \tag{2.6}
\end{equation}\]</span></p>
<p><strong>F1-score:</strong> This is the harmonic mean of precision and recall.</p>
<p><span class="math display" id="eq:metricFscore">\[\begin{equation}
  \textit{F1-score} = 2 \cdot \frac{\textrm{precision} \cdot \textrm{recall}}{\textrm{precision + recall}}
  \tag{2.7}
\end{equation}\]</span></p>
<p>The <code>confusionMatrix()</code> function from the <code>caret</code> package computes several of those metrics. From our previous confusion matrix object, we can inspect those metrics by class.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="classification.html#cb28-1" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>byClass[,<span class="fu">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>, <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)]</span>
<span id="cb28-2"><a href="classification.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    Recall Specificity Precision        F1</span></span>
<span id="cb28-3"><a href="classification.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: bedroomA 1.0000000   0.9523810 0.8666667 0.9285714</span></span>
<span id="cb28-4"><a href="classification.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: bedroomB 0.9444444   0.9891304 0.9444444 0.9444444</span></span>
<span id="cb28-5"><a href="classification.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: lobby    0.9032258   0.9873418 0.9655172 0.9333333</span></span>
<span id="cb28-6"><a href="classification.html#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: tvroom   0.9428571   1.0000000 1.0000000 0.9705882</span></span></code></pre></div>
<p>The mean of the metrics across all classes can be computed by taking the mean for each column of the returned object:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="classification.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(cm<span class="sc">$</span>byClass[,<span class="fu">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>, <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)])</span>
<span id="cb29-2"><a href="classification.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Recall Specificity   Precision          F1 </span></span>
<span id="cb29-3"><a href="classification.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.9476318   0.9822133   0.9441571   0.9442344</span></span></code></pre></div>
<div id="confusion-matrix" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Confusion Matrix</h3>
<p>As briefly introduced in the previous section, a <em>confusion matrix</em> provides a nice way to understand the model’s predictions and spot where it made mistakes. Figure <a href="classification.html#fig:binaryCM">2.4</a> shows a confusion matrix for the binary case. The columns represent the true classes and the rows the predicted classes. The <strong>P</strong> stands for the positive cases and the <strong>N</strong> for the negative ones. Each entry in the matrix corresponds to the TP, TN, FP, and FN. The TP and TN are the correct classifications whereas the FN and FP are the misclassifications.</p>
<div class="figure" style="text-align: center"><span id="fig:binaryCM"></span>
<img src="images/binaryCM.png" alt="Confusion matrix for the binary case. P: positives, N: negatives." width="30%" />
<p class="caption">
FIGURE 2.4: Confusion matrix for the binary case. P: positives, N: negatives.
</p>
</div>
<p>Figure <a href="classification.html#fig:binaryCM2">2.5</a> shows a concrete example of a confusion matrix derived from a list of <span class="math inline">\(15\)</span> instances with their predictions and their corresponding true values (ground truth). For example, the first element in the list is a <strong>P</strong> and it was correctly classified as a <strong>P</strong>. The eight element is a <strong>P</strong> but it was misclassified as <strong>N</strong>. The associated confusion matrix for these ground truth and predicted classes is shown at the bottom.</p>
<p>There are <span class="math inline">\(7\)</span> true positives and <span class="math inline">\(3\)</span> true negatives. In total, <span class="math inline">\(10\)</span> instances were correctly classified (TP and TN) and <span class="math inline">\(5\)</span> were misclassified (FP and FN). From this matrix we can calculate what is the total number of true positives by taking the sum of the first column, <span class="math inline">\(10\)</span> in this case. The total number of true negatives is obtained by summing the second column, <span class="math inline">\(5\)</span> in this case. Having this information we can compute any of the previous performance metrics: accuracy, recall, specificity, precision, F1-score, etc.</p>
<div class="figure" style="text-align: center"><span id="fig:binaryCM2"></span>
<img src="images/binaryCM2.png" alt="A concrete example of a  confusion matrix for the binary case. P: positives, N: negatives." width="90%" />
<p class="caption">
FIGURE 2.5: A concrete example of a confusion matrix for the binary case. P: positives, N: negatives.
</p>
</div>

<div class="rmdcaution">
Be aware that there is no standard that defines whether the true classes or the predicted classes go in the rows or columns, thus, you need to check for this everytime you encounter a new confusion matrix.
</div>

<div class="rmdshiny">
<code>shiny_metrics.R</code> This shiny app demonstrates how different performance metrics behave when the confusion matrix values change.
</div>
</div>
</div>
<div id="decision-trees" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Decision Trees</h2>
<p>Decision trees are powerful predictive models (especially when combining several of them, see chapter <a href="ensemble.html#ensemble">3</a>) used for classification and regression tasks. Here, the focus will be on classification. Each node in a tree represents partial or final decisions based on a single feature. If a node is a leaf, then it represents a final decision. A leaf is simply a terminal node, i.e, it has no children nodes. Given a feature vector representing an instance, the predicted class is obtained by testing the feature values and following the tree path until a leaf is reached. Figure <a href="classification.html#fig:treeExample">2.6</a> exemplifies a query instance with an unknown class (left) and a decision tree (right). To predict the class of an unknown instance, its features are evaluated starting at the root. In this case <em>number_wheels</em> is <span class="math inline">\(4\)</span> in the query instance so we take the left path from the root. Now, we need to evaluate <em>weight</em>. This time the test is false since the weight is <span class="math inline">\(2300\)</span> and we take the right path. Since this is a leaf node the final predicted class is <em>‘truck’</em>. Usually, small trees are preferable (small depth) because they are easier to visualize and interpret and are less prone to overfitting. The example tree has a depth of 2. Had the number of wheels been <span class="math inline">\(2\)</span> instead of <span class="math inline">\(4\)</span>, then testing the <em>weight</em> feature would not have been necessary.</p>
<div class="figure" style="text-align: center"><span id="fig:treeExample"></span>
<img src="images/treeExample.png" alt="Example decision tree. The query instance is classified as truck by this tree." width="90%" />
<p class="caption">
FIGURE 2.6: Example decision tree. The query instance is classified as truck by this tree.
</p>
</div>
<p>As shown in the example, decision trees are easy to interpret and the final result can be explained by just following the path. Now let’s see how these decision trees are learned from data. Consider the following artificial <em>cinema</em> dataset (Figure <a href="classification.html#fig:cinemaTable">2.7</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:cinemaTable"></span>
<img src="images/cinemaTable.png" alt="Cinema dataset." width="60%" />
<p class="caption">
FIGURE 2.7: Cinema dataset.
</p>
</div>
<p>The first <span class="math inline">\(4\)</span> variables are features and the last column is the class. The class is the decision whether or not we should go to the movies based on the other variables. In this case, all variables are binary except <em>Price</em> which has three possible values: <em>low</em>, <em>medium</em>, and <em>high</em>.</p>
<ul>
<li><em>Tired:</em> Indicates whether the person is tired or not.</li>
<li><em>Rain:</em> Whether it is raining or not.</li>
<li><em>Comedy:</em> Indicates whether the genre of the movie is <em>comedy</em> or not.</li>
<li><em>Price:</em> Ticket price.</li>
<li><em>Go:</em> The decision of whether to go to the movies or not.</li>
</ul>
<p>The main question when building a tree is which feature should be at the root (top). Once you answer this question, you may need to grow the tree by adding another feature (node) as one of the root’s children. To decide which new feature to add you need to answer the same first question: “What feature should be at the root of this subtree?” This is a recursive definition! The tree keeps growing until you reach a leaf node, there are no more features to select from, or you have reached a predefined maximum depth.</p>
<p>For the <em>cinema</em> dataset we need to find which is the best variable to be placed at the root. Let’s suppose we need to choose between <em>Price</em> and <em>Comedy</em>. Figure <a href="classification.html#fig:treeAlgo1">2.8</a> shows these two possibilities.</p>
<div class="figure" style="text-align: center"><span id="fig:treeAlgo1"></span>
<img src="images/treeAlgo1.png" alt="Two example trees with one variable split by Price (left) and Comedy (right)." width="100%" />
<p class="caption">
FIGURE 2.8: Two example trees with one variable split by Price (left) and Comedy (right).
</p>
</div>
<p>If we select <em>Price</em>, there are three possible subnodes, one for each value: <em>low</em>, <em>medium</em>, and <em>high</em>. If <em>Price</em> is <em>low</em> then four instances fall into this subtree (the first four from the table). For all of them, the value of <em>Go</em> is <span class="math inline">\(1\)</span>. If <em>Price</em> is <em>high</em>, two instances fall into this category and their <em>Go</em> value is <span class="math inline">\(0\)</span>, thus if the price is high then you should not go to the movies according to this data. There are six instances for which the <em>Price</em> value is <em>medium</em>. From those, two of them have <em>Go=1</em> and the remaining four have <em>Go=0</em>. For cases when the price is <em>low</em> or <em>high</em> we can arrive at a solution. If the price is <em>low</em> then go to the cinema, if the price is <em>high</em> then do not go. However, if the price is <em>medium</em> it is still not clear what to do since this subnode is not <em>pure</em>. That is, the labels of the instances are mixed: two with an output of <span class="math inline">\(1\)</span> and four with an output of <span class="math inline">\(0\)</span>. In this case we can try to use another feature to decide and grow the tree but first, let’s look at what happens if we decide to use <em>Comedy</em> as the first feature at the root. In this case, we end up with two subsets with six instances each. And for each subnode, what decision should we take is still not clear because the output is ‘mixed’ (Go: 3, NotGo: 3). At this point we would need to continue growing the tree below each subnode.</p>
<p>Intuitively, it seems like <em>Price</em> is a better feature since its subnodes are more <em>pure</em>. Then we can use another feature to split the instances whose <em>Price</em> is <em>medium</em>. For example, using the <em>Comedy</em> variable. Figure <a href="classification.html#fig:treeAlgo2">2.9</a> shows how this would look like. Since one of the subnodes of <em>Comedy</em> is still not pure we can further split it using the <em>Rain</em> variable, for example. At this point, we can not split any further. Note that the <em>Tired</em> variable was never used.</p>
<div class="figure" style="text-align: center"><span id="fig:treeAlgo2"></span>
<img src="images/treeAlgo2.png" alt="Tree splitting example. Left: tree splits. Right: Highlighted instances when splitting Comedy." width="100%" />
<p class="caption">
FIGURE 2.9: Tree splitting example. Left: tree splits. Right: Highlighted instances when splitting Comedy.
</p>
</div>
<p>So far, we have chosen the root variable based on which one looks more pure but to automate the process, we need a way to measure this <em>purity</em> in a quantitative manner. One way to do that is by using the <em>entropy</em>. <em>Entropy</em> is a measure of uncertainty from information theory. It is <span class="math inline">\(0\)</span> when there is no uncertainty and <span class="math inline">\(1\)</span> when there is complete uncertainty. The entropy of a discrete variable <span class="math inline">\(X\)</span> with values <span class="math inline">\(x_1\dots x_n\)</span> and probability mass function <span class="math inline">\(P(X)\)</span> is:</p>
<p><span class="math display" id="eq:entropy">\[\begin{equation}
  H(X) = -\sum_{i=1}^n{P(x_i)log P(x_i)}
  \tag{2.8}
\end{equation}\]</span></p>
<p>Take for example a fair coin with probability of heads and tails = <span class="math inline">\(0.5\)</span> each. The entropy for that coin is:</p>
<p><span class="math display">\[\begin{equation*}
  H(X) = - (0.5)log(0.5) + (0.5)log(0.5) = 1
\end{equation*}\]</span></p>
<p>Since we do not know what will be the result when we drop the coin, the entropy is maximum. Now consider the extreme case when the coin is biased such that the probability of heads is <span class="math inline">\(1\)</span> and the probability of tails is <span class="math inline">\(0\)</span>. The entropy in this case is zero:</p>
<p><span class="math display">\[\begin{equation*}
  H(X) = - (1)log(1) + (0)log(0) = 0
\end{equation*}\]</span></p>
<p>If we know that the result is always going to be heads, then there is no uncertainty when the coin is dropped. The entropy of <span class="math inline">\(p\)</span> positive examples and <span class="math inline">\(n\)</span> negative examples is:</p>
<p><span class="math display" id="eq:binaryentropy">\[\begin{equation}
  H(p, n) = - (\frac{p}{p+n})log(\frac{p}{p+n}) + (\frac{n}{p+n})log(\frac{n}{p+n})
  \tag{2.9}
\end{equation}\]</span></p>
<p>Thus, we can use this to compute the entropy for the three possible values of <em>Price</em> with respect to the class. The positives are the instances where <em>Go=1</em> and the negatives are the instances where <em>Go=0</em>:</p>
<p><span class="math display">\[\begin{equation*}
  H_{price=low}(4, 0) = - (\frac{4}{4+0})log(\frac{4}{4+0}) + (\frac{0}{4+0})log(\frac{0}{4+0}) = 0
\end{equation*}\]</span></p>
<p><span class="math display">\[\begin{equation*}
  H_{price=medium}(2, 4) = - (\frac{2}{2+4})log(\frac{2}{2+4}) + (\frac{4}{2+4})log(\frac{4}{2+4}) = 0.918
\end{equation*}\]</span></p>
<p><span class="math display">\[\begin{equation*}
  H_{price=high}(0, 2) = - (\frac{0}{0+2})log(\frac{0}{0+2}) + (\frac{2}{0+2})log(\frac{2}{0+2}) = 0
\end{equation*}\]</span></p>
<p>The average of those three can be calculated by taking into account the number of corresponding instances for each value and the total number of instances (<span class="math inline">\(12\)</span>):</p>
<p><span class="math display">\[\begin{equation*}
  meanH(price) = (4/12)(0) + (6/12)(0.918) + (2/12)(0) = 0.459
\end{equation*}\]</span></p>
<p>Before deciding to split on <em>Price</em> the entropy of the entire dataset is <span class="math inline">\(1\)</span> since there are six positive and negative examples:</p>
<p><span class="math display">\[\begin{equation*}
  H(6,6) = 1
\end{equation*}\]</span></p>
<p>Now we can compute the <em>information gain</em> for <em>Price</em>. Intuitively, the information gain tells you how powerful this variable is at dividing the instances based on their class, that is, how much you are learning:</p>
<p><span class="math display">\[\begin{equation*}
  infoGain(Price) = 1 - meanH(Price) = 1 - 0.459 = 0.541
\end{equation*}\]</span></p>
<p>Since you want to learn fast, you want your root node to be the one with the highest information gain. For the rest of the variables the information gain is:</p>
<p><span class="math inline">\(infoGain(Tired) = 0\)</span></p>
<p><span class="math inline">\(infoGain(Rain) = 0.020\)</span></p>
<p><span class="math inline">\(infoGain(Comedy) = 0\)</span></p>
<p>The highest information gain is produced by <em>Price</em>, thus, it is selected as the root node. Then, the process continues recursively for each branch but excluding <em>Price</em>. Since branches with values <em>low</em> and <em>high</em> are already done, we only need to further split <em>medium</em>. Sometimes it is not possible to have completely pure nodes like <em>low</em> and <em>high</em>. This can happen for example, when there are no more attributes left or when two or more instances have the same feature values but different labels. In those situations the final prediction is the most common label (majority vote).</p>
<p>There exist many implementations of decision trees. Some implementations compute variable importance using the entropy (as shown here) but others use the Gini index, for example. Each implementation also treats numeric variables in different ways. Pruning the tree using different techniques is also common in order to reduce its size.</p>
<p>Some of the most common implementations are C4.5 trees <span class="citation">(<a href="#ref-quinlan2014" role="doc-biblioref">Quinlan 2014</a>)</span> and CART <span class="citation">(<a href="#ref-steinberg2009" role="doc-biblioref">Steinberg and Colla 2009</a>)</span>. The later is implemented in the <code>rpart</code> R package <span class="citation">(<a href="#ref-rpart" role="doc-biblioref">Therneau and Atkinson 2019</a>)</span> which will be used in the following section to build a model that predicts physical activities from smartphones sensor data.</p>
<div id="activityRecognition" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Activity Recognition with Smartphones</h3>

<div class="rmdfolder">
<code>smartphone_activities.R</code>
</div>
<p>As mentioned in the introduction, an example of behavior is an observable physical activity. We can infer what <strong>physical activity</strong> someone is doing by looking at her/his body movements. Observing physical activities can provide useful behavioral and contextual information about someone. This can also be used as a proxy to, for example, infer someone’s health condition by detecting deviations in activity patterns.</p>
<p>Nowadays, most smartphones come with a tri-axial accelerometer sensor. This sensor measures gravitational forces from the <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span>, and <span class="math inline">\(z\)</span> axes. This information can be used to capture movement patterns from the user and automate the process of monitoring the type of physical activity being performed.</p>
<p>In this section, we will use decision trees to automatically classify physical activities from acceleration data. We will use the <em>SMARTPHONE ACTIVITIES</em> dataset that contains acceleration recordings that were collected with a smartphone. This dataset is called WISDM<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> and was made available by <span class="citation"><a href="#ref-kwapisz2010" role="doc-biblioref">Kwapisz, Weiss, and Moore</a> (<a href="#ref-kwapisz2010" role="doc-biblioref">2010</a>)</span>. The dataset has <span class="math inline">\(6\)</span> different activities: <em>‘walking’</em>, <em>‘jogging’</em>, <em>‘walking upstairs’</em>, <em>‘walking downstairs’</em>, <em>‘sitting’</em> and <em>‘standing’</em>. The data was collected by <span class="math inline">\(36\)</span> volunteers with an Android phone located in their pant’s pocket and with a sampling rate of <span class="math inline">\(20\)</span> Hz (<span class="math inline">\(1\)</span> sample every <span class="math inline">\(50\)</span> milliseconds).</p>
<p>The dataset contains two types of files. One with the raw accelerometer data and the other one after feature extraction. Figure <a href="classification.html#fig:wisdmFirstLines">2.10</a> shows the first <span class="math inline">\(10\)</span> lines of the raw accelerometer values of the first file. The first column is the id of the user that collected the data and the second column is the class. The third column is the timestamp and the remaining columns are the <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span>, and <span class="math inline">\(z\)</span> accelerometer values, respectively.</p>
<div class="figure" style="text-align: center"><span id="fig:wisdmFirstLines"></span>
<img src="images/wisdmFirstLines.png" alt="First 10 lines of raw accelerometer data." width="60%" />
<p class="caption">
FIGURE 2.10: First 10 lines of raw accelerometer data.
</p>
</div>
<p>Usually, classification models are not trained with the raw data but with <em>feature vectors</em> extracted from the raw data. Feature vectors have the advantage of being more compact, thus, making the learning phase more efficient. For activity recognition, the feature extraction process consists of defining a moving window of size <span class="math inline">\(w\)</span> that starts at position <span class="math inline">\(i\)</span>. At the beginning, <span class="math inline">\(i\)</span> is the index pointing to the first accelerometer readings. Then, <span class="math inline">\(n\)</span> statistical features are computed on the elements covered by the window such as mean, standard deviation, <span class="math inline">\(0\)</span>-crossings, etc. This will produce a <span class="math inline">\(n\)</span>-dimensional feature vector and the process is repeated by moving the window <span class="math inline">\(s\)</span> steps forward. Typical values of <span class="math inline">\(s\)</span> are such that the overlap between the previous window position and the next one is about <span class="math inline">\(30\%\)</span> to <span class="math inline">\(50\%\)</span>. An overlap of <span class="math inline">\(0\)</span> is also typical, that is, <span class="math inline">\(s = w\)</span>. Figure <a href="classification.html#fig:featureExtraction">2.11</a> depicts the process.</p>
<div class="figure" style="text-align: center"><span id="fig:featureExtraction"></span>
<img src="images/featureExtraction.png" alt="Moving window for feature extraction." width="70%" />
<p class="caption">
FIGURE 2.11: Moving window for feature extraction.
</p>
</div>
<p>Once we have the set of feature vectors and their associated class labels, we can use them to train a classifier and make predictions on new data (Figure <a href="classification.html#fig:extractedFeatureVectors">2.12</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:extractedFeatureVectors"></span>
<img src="images/activitiesPrediction.png" alt="The extracted feature vectors are used to train a classifier." width="90%" />
<p class="caption">
FIGURE 2.12: The extracted feature vectors are used to train a classifier.
</p>
</div>
<p>For this example, we will use the file with features already extracted. The authors used windows of <span class="math inline">\(10\)</span> seconds which is equivalent to <span class="math inline">\(200\)</span> observations given the <span class="math inline">\(20\)</span> Hz sampling rate and they used <span class="math inline">\(0\%\)</span> overlap. From each window, they extracted <span class="math inline">\(43\)</span> features such as the mean, standard deviation, absolute deviations, etc.</p>
<p>Let’s read and print the first rows of the dataset. The script for this section is <code>smartphone_activities.R</code>. The data frame has several columns, but we only print the first five features and the class which is stored in the last column.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="classification.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data.</span></span>
<span id="cb30-2"><a href="classification.html#cb30-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(datapath,<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb30-3"><a href="classification.html#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="classification.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Some code to clean the dataset.</span></span>
<span id="cb30-5"><a href="classification.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (cleaning code not shown here).</span></span>
<span id="cb30-6"><a href="classification.html#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="classification.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print first rows of the dataset.</span></span>
<span id="cb30-8"><a href="classification.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">40</span>)])</span>
<span id="cb30-9"><a href="classification.html#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="classification.html#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     X0   X1   X2   X3   X4    class</span></span>
<span id="cb30-11"><a href="classification.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.04 0.09 0.14 0.12 0.11  Jogging</span></span>
<span id="cb30-12"><a href="classification.html#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0.12 0.12 0.06 0.07 0.11  Jogging</span></span>
<span id="cb30-13"><a href="classification.html#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0.14 0.09 0.11 0.09 0.09  Jogging</span></span>
<span id="cb30-14"><a href="classification.html#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0.06 0.10 0.09 0.09 0.11  Walking</span></span>
<span id="cb30-15"><a href="classification.html#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 0.12 0.11 0.10 0.08 0.10  Walking</span></span>
<span id="cb30-16"><a href="classification.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 0.09 0.09 0.10 0.12 0.08  Walking</span></span>
<span id="cb30-17"><a href="classification.html#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 0.12 0.12 0.12 0.13 0.15 Upstairs</span></span>
<span id="cb30-18"><a href="classification.html#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 0.10 0.10 0.10 0.10 0.11 Upstairs</span></span>
<span id="cb30-19"><a href="classification.html#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9 0.08 0.07 0.08 0.08 0.05 Upstairs</span></span></code></pre></div>
<p>Our aim is to predict the class based on all the numeric features. We will use the <code>rpart</code> package <span class="citation">(<a href="#ref-rpart" role="doc-biblioref">Therneau and Atkinson 2019</a>)</span> which implements classification and regression trees. We will assess the performance of the decision tree with <span class="math inline">\(10\)</span>-fold cross-validation. We can use the <code>sample()</code> function to generate the folds. This function will sample <span class="math inline">\(n\)</span> integers from <span class="math inline">\(1\)</span> to <span class="math inline">\(k\)</span> where <span class="math inline">\(n\)</span> is the number of rows in the data frame.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="classification.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Package with implementations of decision trees.</span></span>
<span id="cb31-2"><a href="classification.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb31-3"><a href="classification.html#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="classification.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility.</span></span>
<span id="cb31-5"><a href="classification.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb31-6"><a href="classification.html#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="classification.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of folds.</span></span>
<span id="cb31-8"><a href="classification.html#cb31-8" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb31-9"><a href="classification.html#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="classification.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate folds.</span></span>
<span id="cb31-11"><a href="classification.html#cb31-11" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(k, <span class="at">size =</span> <span class="fu">nrow</span>(df), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-12"><a href="classification.html#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="classification.html#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print first 10 values.</span></span>
<span id="cb31-14"><a href="classification.html#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(folds)</span>
<span id="cb31-15"><a href="classification.html#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10  6  5  9  5  6</span></span></code></pre></div>
<p>The <code>folds</code> variable stores the fold each instance belongs to. For example, the first instance belongs to fold <span class="math inline">\(10\)</span>, the second instance belongs to fold <span class="math inline">\(6\)</span>, and so on. We can now generate our test and train sets. We will iterate <span class="math inline">\(k=10\)</span> times. For each iteration <span class="math inline">\(i\)</span>, the test set is built using the instances that belong to fold <span class="math inline">\(i\)</span> and the train set will be composed of the remaining instances (those that do not belong to fold <span class="math inline">\(i\)</span>). Next, the <code>rpart()</code> function is used to train the decision tree with the train set. By default, <code>rpart()</code> performs <span class="math inline">\(10\)</span>-fold cross-validation internally. To avoid this, we set the parameter <code>xval = 0</code>. Then, we can use the trained model to obtain the predictions on the test set with the generic <code>predict()</code> function. The ground truth classes and the predictions are stored so the performance metrics can be computed.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="classification.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable to store ground truth classes.</span></span>
<span id="cb32-2"><a href="classification.html#cb32-2" aria-hidden="true" tabindex="-1"></a>groundTruth <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb32-3"><a href="classification.html#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="classification.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable to store the classifier&#39;s predictions.</span></span>
<span id="cb32-5"><a href="classification.html#cb32-5" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb32-6"><a href="classification.html#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="classification.html#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb32-8"><a href="classification.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-9"><a href="classification.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  trainSet <span class="ot">&lt;-</span> df[<span class="fu">which</span>(folds <span class="sc">!=</span> i), ]</span>
<span id="cb32-10"><a href="classification.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  testSet <span class="ot">&lt;-</span> df[<span class="fu">which</span>(folds <span class="sc">==</span> i), ]</span>
<span id="cb32-11"><a href="classification.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-12"><a href="classification.html#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train the decision tree</span></span>
<span id="cb32-13"><a href="classification.html#cb32-13" aria-hidden="true" tabindex="-1"></a>  treeClassifier <span class="ot">&lt;-</span> <span class="fu">rpart</span>(class <span class="sc">~</span> .,</span>
<span id="cb32-14"><a href="classification.html#cb32-14" aria-hidden="true" tabindex="-1"></a>                          trainSet, <span class="at">xval=</span><span class="dv">0</span>)</span>
<span id="cb32-15"><a href="classification.html#cb32-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-16"><a href="classification.html#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get predictions on the test set.</span></span>
<span id="cb32-17"><a href="classification.html#cb32-17" aria-hidden="true" tabindex="-1"></a>  foldPredictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(treeClassifier,</span>
<span id="cb32-18"><a href="classification.html#cb32-18" aria-hidden="true" tabindex="-1"></a>                             testSet, <span class="at">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb32-19"><a href="classification.html#cb32-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-20"><a href="classification.html#cb32-20" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">c</span>(predictions,</span>
<span id="cb32-21"><a href="classification.html#cb32-21" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.character</span>(foldPredictions))</span>
<span id="cb32-22"><a href="classification.html#cb32-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-23"><a href="classification.html#cb32-23" aria-hidden="true" tabindex="-1"></a>  groundTruth <span class="ot">&lt;-</span> <span class="fu">c</span>(groundTruth,</span>
<span id="cb32-24"><a href="classification.html#cb32-24" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.character</span>(testSet<span class="sc">$</span>class))</span>
<span id="cb32-25"><a href="classification.html#cb32-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The first argument of the <code>rpart()</code> function is <code>class ~ .</code> which is a formula that instructs the method to use the <em>class</em> column as the class. The <code>~ .</code> means “use all the remaining columns as features.” Now, we can use the <code>confusionMatrix()</code> function to compute the performance metrics and the confusion matrix.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="classification.html#cb33-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(predictions),</span>
<span id="cb33-2"><a href="classification.html#cb33-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">as.factor</span>(groundTruth))</span>
<span id="cb33-3"><a href="classification.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="classification.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print accuracy</span></span>
<span id="cb33-5"><a href="classification.html#cb33-5" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb33-6"><a href="classification.html#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Accuracy </span></span>
<span id="cb33-7"><a href="classification.html#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.7895903 </span></span>
<span id="cb33-8"><a href="classification.html#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="classification.html#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print performance metrics per class.</span></span>
<span id="cb33-10"><a href="classification.html#cb33-10" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>byClass[,<span class="fu">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>, <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)]</span>
<span id="cb33-11"><a href="classification.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      Recall Specificity Precision        F1</span></span>
<span id="cb33-12"><a href="classification.html#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: Downstairs 0.2821970   0.9617587 0.4434524 0.3449074</span></span>
<span id="cb33-13"><a href="classification.html#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: Jogging    0.9612308   0.9601898 0.9118506 0.9358898</span></span>
<span id="cb33-14"><a href="classification.html#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: Sitting    0.8366013   0.9984351 0.9696970 0.8982456</span></span>
<span id="cb33-15"><a href="classification.html#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: Standing   0.8983740   0.9932328 0.8632812 0.8804781</span></span>
<span id="cb33-16"><a href="classification.html#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: Upstairs   0.2246835   0.9669870 0.4733333 0.3047210</span></span>
<span id="cb33-17"><a href="classification.html#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: Walking    0.9360884   0.8198981 0.7642213 0.8414687</span></span>
<span id="cb33-18"><a href="classification.html#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="classification.html#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Print overall metrics across classes.</span></span>
<span id="cb33-20"><a href="classification.html#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(cm<span class="sc">$</span>byClass[,<span class="fu">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>,</span>
<span id="cb33-21"><a href="classification.html#cb33-21" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)])</span>
<span id="cb33-22"><a href="classification.html#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Recall Specificity   Precision          F1 </span></span>
<span id="cb33-23"><a href="classification.html#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.6898625   0.9500836   0.7376393   0.7009518 </span></span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:activitiesTreeCM"></span>
<img src="images/activitiesTreeCM.png" alt="Confusion matrix for activities' predictions." width="60%" />
<p class="caption">
FIGURE 2.13: Confusion matrix for activities’ predictions.
</p>
</div>
<p>The overall accuracy was <span class="math inline">\(78\%\)</span> and by looking at the individual performance metrics, some classes had low scores like <em>‘walking downstairs’</em> and <em>‘walking upstairs’</em>. From the confusion matrix, it can be seen that those two activities were often confused with each other but also with the <em>‘walking’</em> activity. The package <code>rpart.plot</code> <span class="citation">(<a href="#ref-rpartplot" role="doc-biblioref">Milborrow 2019</a>)</span> can be used to plot the resulting tree.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="classification.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb34-2"><a href="classification.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the tree from the last fold.</span></span>
<span id="cb34-3"><a href="classification.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(treeClassifier, <span class="at">fallen.leaves =</span> F,</span>
<span id="cb34-4"><a href="classification.html#cb34-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">shadow.col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">legend.y =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:activitiesTree"></span>
<img src="images/activitiesTree.png" alt="Resulting decision tree." width="100%" />
<p class="caption">
FIGURE 2.14: Resulting decision tree.
</p>
</div>
<p>The <code>fallen.leaves = F</code> argument prevents the leaves to be plotted at the bottom. This is useful if the tree has many nodes. Each node shows the predicted class, the predicted probability of each class and the percentage of observations in the node. The plot also shows the feature used for each split. We can see that the <em>YABSOLDEV</em> variable is at the root thus, it had the highest information gain with the initial set of instances. At the root of the tree, before looking at any of the features, the predicted class is <em>‘Walking’</em>. This is because its prior probability is the highest one (<span class="math inline">\(\approx 0.39\)</span>), that is, it’s the most common activity present in the dataset. So, if we didn’t have any other information, our best bet would be to predict the most frequent activity.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="classification.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior probabilities.</span></span>
<span id="cb35-2"><a href="classification.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(trainSet<span class="sc">$</span>class) <span class="sc">/</span> <span class="fu">nrow</span>(trainSet)</span>
<span id="cb35-3"><a href="classification.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Downstairs    Jogging    Sitting   Standing   Upstairs    Walking </span></span>
<span id="cb35-4"><a href="classification.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.09882885 0.29607561 0.05506472 0.04705157 0.11793713 0.38504212</span></span></code></pre></div>
<p>These results look promising, but they can still be improved. In the next chapter, I will show you how to improve these results with <em>Ensemble Learning</em> which is a method that is used to aggregate many models.</p>
</div>
</div>
<div id="naive-bayes" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Naive Bayes</h2>
<p>Naive Bayes is yet another type of classifier. This one is based on Bayes’ rule. The name <em>Naive</em> is because this method assumes that the features are independent. In the previous section we learned that decision trees are built recursively. Trees are built by first selecting a feature to be at the root and then, the root is split into subnodes and so on. How those subnodes are chosen depends on their parent node. With Naive Bayes, features don’t need information about other features, thus, the parameters for each feature can be learned in parallel.</p>
<p>To demonstrate how Naive Bayes works I will use the <em>SMARTPHONE ACTIVITIES</em> dataset as in the previous section. For any given <em>query instance</em>, the aim is to <strong>predict its most likely class</strong> based on the accelerometer features. For a new <em>query instance</em>, we want to estimate its class based on the features that we have observed. Let’s say we want to know what is the probability that the query instance belongs to the class <em>‘Walking’</em>. This can be formulated as follows:</p>
<p><span class="math display">\[\begin{equation*}
  P(C=\textit{Walking} | f_1,\dots ,f_n).
\end{equation*}\]</span></p>
<p>This reads as the conditional probability that the class is <em>‘Walking’</em> <strong>given</strong> the observed evidence. For each instance, the evidence that we can observe are its features <span class="math inline">\(f_1, \dots ,f_n\)</span>. In this dataset, each instance has <span class="math inline">\(39\)</span> features. If we want to estimate the most likely class, all we need to do is to compute the conditional probability for each class and return the highest one:</p>
<p><span class="math display" id="eq:bayesclassifier">\[\begin{equation}
  y = \operatorname*{arg max}_{k \in \{1, \dots ,K\}} P(C_k | f_1,\dots ,f_n)
  \tag{2.10}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(K\)</span> is the total number of possible classes. The <span class="math inline">\(\text{arg max}\)</span> notation means: Evaluate the right hand expression for every class <span class="math inline">\(k\)</span> and return the <span class="math inline">\(k\)</span> that resulted with the maximum probability. If instead of <em>arg max</em> we had <em>max</em> (without the <em>arg</em>) that would mean to return the actual maximum probability instead of the class <span class="math inline">\(k\)</span>.</p>
<p>Now let’s see how we can compute <span class="math inline">\(P(C_k | f_1,\dots ,f_n)\)</span>. To compute a conditional probability we can use Bayes’ rule:</p>
<p><span class="math display" id="eq:bayesrule">\[\begin{equation}
  P(H|E) = \frac{P(H)P(E|H)}{P(E)}
  \tag{2.11}
\end{equation}\]</span></p>
<p>Let’s dissect that formula:</p>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(P(H|E)\)</span> is called the <strong>posterior</strong> and it is the probability of the hypothesis <span class="math inline">\(H\)</span> given the observed evidence <span class="math inline">\(E\)</span>. In our example, the hypothesis can be that <span class="math inline">\(C=Walking\)</span> and the evidence consists of the measured features. This is the probability that ultimately we want to estimate for each class and pick the class with the highest probability.</p></li>
<li><p><span class="math inline">\(P(H)\)</span> is called the <strong>prior</strong>. This is the probability of a hypothesis happening without having any evidence. In our example, this translates into the probability that an instance belongs to a particular class without looking at its features. In practice, this is estimated from the class counts in the training set. Suppose the training set consists of <span class="math inline">\(100\)</span> instances and from those, <span class="math inline">\(80\)</span> are of type <em>‘Walking’</em> and <span class="math inline">\(20\)</span> are of type <em>‘Jogging’</em>. Then, the prior probability for <em>‘Walking’</em> is <span class="math inline">\(P(C=Walking)=80/100=0.8\)</span> and the prior for <em>‘Jogging’</em> is <span class="math inline">\(P(C=Jogging)=20/100=0.2\)</span>.</p></li>
<li><p><span class="math inline">\(P(E)\)</span> is the probability of the evidence. Since this one doesn’t depend on the class we don’t need to compute it. This can be thought of as a normalization factor. When choosing the final class we only need to select the one with the highest score, so there is no need to normalize them into proper probabilities between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>.</p></li>
<li><p><span class="math inline">\(P(E|H)\)</span> is called the <strong>likelihood</strong>. For numerical variables we can estimate this using a <em>Gaussian probability density function</em>. This sounds intimidating! but all we need to do is to compute the <em>mean</em> and <em>standard deviation</em> for each feature-class pair and plug them in the probability density function (pdf). The formula for a Gaussian (also called normal) pdf is:</p></li>
</ol>
<p><span class="math display" id="eq:gaussianpdf">\[\begin{equation}
  f(x) = \frac{1}{{\sigma \sqrt {2\pi } }}e^{ - \left( {x - \mu } \right)^2 / 2 \sigma ^2 }
  \tag{2.12}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean and <span class="math inline">\(\sigma\)</span> is the standard deviation.</p>
<p>Suppose that for some feature <span class="math inline">\(f1\)</span> when the class is <em>‘Walking’</em>, its mean is <span class="math inline">\(5\)</span> and its standard deviation is <span class="math inline">\(3\)</span>. That is, we filter the train set and only select those instances with class <em>‘Walking’</em> and compute the mean and standard deviation for feature <span class="math inline">\(f1\)</span>. Figure <a href="classification.html#fig:pdf1">2.15</a> shows how its pdf looks like.</p>
<div class="figure" style="text-align: center"><span id="fig:pdf1"></span>
<img src="images/pdf1.png" alt="Gaussian probability density function with mean 5 and standard deviation 3." width="90%" />
<p class="caption">
FIGURE 2.15: Gaussian probability density function with mean 5 and standard deviation 3.
</p>
</div>
<p>If we have a query instance with a feature <span class="math inline">\(f_1 = 1.7\)</span>, we can compute its likelihood given the <em>‘Walking’</em> class <span class="math inline">\(P(f_1=1.7|C=Walking)\)</span> with equation <a href="classification.html#eq:gaussianpdf">(2.12)</a> by plugging <span class="math inline">\(x=1.7\)</span>, <span class="math inline">\(\mu=5\)</span> and <span class="math inline">\(\sigma=3\)</span>. In R, the function <code>dnorm()</code> implements the normal pdf.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="classification.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dnorm</span>(<span class="at">x=</span><span class="fl">1.7</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb36-2"><a href="classification.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.07261739</span></span></code></pre></div>
<p>In Figure <a href="classification.html#fig:pdf2">2.16</a> the solid circle shows the likelihood when <span class="math inline">\(x=1.7\)</span>.</p>
<div class="figure" style="text-align: center"><span id="fig:pdf2"></span>
<img src="images/pdf2.png" alt="Likelihood (0.072) when x=1.7." width="90%" />
<p class="caption">
FIGURE 2.16: Likelihood (0.072) when x=1.7.
</p>
</div>
<p>If we have more than one feature we need to compute the likelihood for each and take their <strong>product</strong>: <span class="math inline">\(P(f_1|C=Walking)*P(f_2|C=Walking)*\dots*P(f_n|C=Walking)\)</span>. Each feature and class pair has its own <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> parameters. Thus, Naive Bayes requires to learn <span class="math inline">\(K*F*2\)</span> parameters for the <span class="math inline">\(P(E|H)\)</span> part plus <span class="math inline">\(K\)</span> parameters for the priors <span class="math inline">\(P(H)\)</span>. <span class="math inline">\(K\)</span> is the number of classes, <span class="math inline">\(F\)</span> is the number of features and the <span class="math inline">\(2\)</span> stands for the mean and standard deviation.</p>
<p>We have seen how we can compute <span class="math inline">\(P(C_k|f_1, \dots ,f_n)\)</span> using Baye’s rule by calculating the prior <span class="math inline">\(P(H)\)</span> and <span class="math inline">\(P(E|H)\)</span> which is the product of the likelihoods for each feature. If we substitute Bayes’s rule (omitting the denominator) in equation <a href="classification.html#eq:bayesclassifier">(2.10)</a> we get our Naive Bayes classifier:</p>
<p><span class="math display" id="eq:bayesclassifier2">\[\begin{equation}
  y = \operatorname*{arg max}_{k \in \{1, \dots ,K\}} P(C_k) \prod_{i=1}^{F} P(f_i | C_k)
  \tag{2.13}
\end{equation}\]</span></p>
<p>In the following section we will implement our own Naive Bayes algorithm in R and test it on the <em>SMARTPHONE ACTIVITIES</em> dataset. Then, we will compare our implementation with that of the well known <code>e1071</code> package <span class="citation">(<a href="#ref-e1071" role="doc-biblioref">Meyer et al. 2019</a>)</span>.</p>

<div class="rmdgoodpractice">
Naive Bayes works well with missing values since the features are independent. At prediction time, if an instance has one or more missing values then, those features are just ignored and the posterior probability is computed based only on the available variabels. Another advantage of the feature independence assumption is that feature selection algorithms run very fast with Naive Bayes. When building a predictive model, not all features may provide useful information and some features may even degrade the performance. Feature selection algorithms aim to find the best set of features and some of them need to try a huge number of feature combinations. With Naive Bayes, the parameters only need to be learned once and then different combinations of features can be evaluated by ommiting the ones that are not used. With decision trees, for example, we would need to build entire new trees every time we want to try different input features.
</div>

<div class="rmdinfo">
Here, we have shown how we can use a Gaussian pdf to compute the likelihood <span class="math inline">\(P(E|H)\)</span> when the features are numeric. This assumes that the features have a normal distribution. However, this is not always the case. In practice, Naive Bayes can work really well even if that assumption is not met. Furthermore, nothing prevents us from using another distribution to estimate the likelihood or even defining a specific distribution for each feature. For categorical variables, <span class="math inline">\(P(E|H)\)</span> is estimated using the frequencies of the feature values.
</div>
<div id="activity-recognition-with-naive-bayes" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Activity Recognition with Naive Bayes</h3>

<div class="rmdfolder">
<code>naive_bayes.R</code>
</div>
<p>It’s time to implement Naive Bayes. To keep it simple, first we will go through a step by step example using a single feature. Then, we will implement a function to train a Naive Bayes classifier for the case of multiple features.</p>
<p>Let’s assume we have already split the data into train and test sets. The complete code is in the script <code>naive_bayes.R</code>. We will only use the feature <em>RESULTANT</em> which corresponds to the acceleration magnitude of the three axes of the accelerometer sensor. The following code snippet prints the first rows of the train set. The <em>RESULTANT</em> feature is in column <span class="math inline">\(39\)</span> and the class is the last column (<span class="math inline">\(40\)</span>).</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="classification.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trainset[,<span class="fu">c</span>(<span class="dv">39</span><span class="sc">:</span><span class="dv">40</span>)])</span>
<span id="cb37-2"><a href="classification.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      RESULTANT    class</span></span>
<span id="cb37-3"><a href="classification.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1004     11.14  Walking</span></span>
<span id="cb37-4"><a href="classification.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 623       1.24 Upstairs</span></span>
<span id="cb37-5"><a href="classification.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2693      9.90 Standing</span></span>
<span id="cb37-6"><a href="classification.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 934      10.44 Upstairs</span></span>
<span id="cb37-7"><a href="classification.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4496     10.43  Walking</span></span>
<span id="cb37-8"><a href="classification.html#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2948     15.28  Jogging</span></span></code></pre></div>
<p>First, we compute the prior probabilities for each class in the train set and store them in the variable <code>priors</code>. This corresponds to the <span class="math inline">\(P(C_k)\)</span> part in equation <a href="classification.html#eq:bayesclassifier2">(2.13)</a>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="classification.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute prior probabilities.</span></span>
<span id="cb38-2"><a href="classification.html#cb38-2" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">table</span>(trainset<span class="sc">$</span>class) <span class="sc">/</span> <span class="fu">nrow</span>(trainset)</span>
<span id="cb38-3"><a href="classification.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="classification.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the table of priors.</span></span>
<span id="cb38-5"><a href="classification.html#cb38-5" aria-hidden="true" tabindex="-1"></a>priors</span>
<span id="cb38-6"><a href="classification.html#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="classification.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Downstairs    Jogging    Sitting   Standing   Upstairs </span></span>
<span id="cb38-8"><a href="classification.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.09622990 0.30266280 0.05721065 0.04640127 0.11521223 </span></span>
<span id="cb38-9"><a href="classification.html#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Walking </span></span>
<span id="cb38-10"><a href="classification.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.38228315 </span></span></code></pre></div>
<p>We can access each prior by name like this:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="classification.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the prior for &quot;Jogging&quot;.</span></span>
<span id="cb39-2"><a href="classification.html#cb39-2" aria-hidden="true" tabindex="-1"></a>priors[<span class="st">&quot;Jogging&quot;</span>]</span>
<span id="cb39-3"><a href="classification.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Jogging </span></span>
<span id="cb39-4"><a href="classification.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.3026628 </span></span></code></pre></div>
<p>This means that <span class="math inline">\(30\%\)</span> of the instances in the train set are of type <em>‘Jogging’</em>. Now we need to compute the <span class="math inline">\(P(f_i|C_k)\)</span> part from equation <a href="classification.html#eq:bayesclassifier2">(2.13)</a>. In R, we can define a method to compute the probability density function from equation <a href="classification.html#eq:gaussianpdf">(2.12)</a> as:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="classification.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability density function of normal distribution.</span></span>
<span id="cb40-2"><a href="classification.html#cb40-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, m, s){</span>
<span id="cb40-3"><a href="classification.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">/</span> (<span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi)<span class="sc">*</span>s)) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>((x<span class="sc">-</span>m)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> s<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb40-4"><a href="classification.html#cb40-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>It’s first argument <code>x</code> is the input value. The second argument <code>m</code> is the mean, and the last argument <code>s</code> is the standard deviation. For illustration purposes we are defining this function manually but remember that this pdf is already implemented with the base <code>dnorm()</code> function.</p>
<p>According to equation <a href="classification.html#eq:bayesclassifier2">(2.13)</a> we need to compute <span class="math inline">\(P(f_i|C_k)\)</span> for each feature <span class="math inline">\(i\)</span> and class <span class="math inline">\(k\)</span>. Let’s assume there are only two classes, <em>‘Walking’</em> and <em>‘Jogging’</em>. Thus, we need to compute the mean and standard deviation for each, and for the feature <em>RESULTANT</em> (column <span class="math inline">\(39\)</span>).</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="classification.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the mean and sd of</span></span>
<span id="cb41-2"><a href="classification.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the feature RESULTANT (column 39)</span></span>
<span id="cb41-3"><a href="classification.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># when the class = &quot;Standing&quot;.</span></span>
<span id="cb41-4"><a href="classification.html#cb41-4" aria-hidden="true" tabindex="-1"></a>mean.standing <span class="ot">&lt;-</span> <span class="fu">mean</span>(trainset[<span class="fu">which</span>(trainset<span class="sc">$</span>class <span class="sc">==</span> <span class="st">&quot;Standing&quot;</span>), <span class="dv">39</span>])</span>
<span id="cb41-5"><a href="classification.html#cb41-5" aria-hidden="true" tabindex="-1"></a>sd.standing <span class="ot">&lt;-</span> <span class="fu">sd</span>(trainset[<span class="fu">which</span>(trainset<span class="sc">$</span>class <span class="sc">==</span> <span class="st">&quot;Standing&quot;</span>), <span class="dv">39</span>])</span>
<span id="cb41-6"><a href="classification.html#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="classification.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute mean and sd when</span></span>
<span id="cb41-8"><a href="classification.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># the class = &quot;Jogging&quot;.</span></span>
<span id="cb41-9"><a href="classification.html#cb41-9" aria-hidden="true" tabindex="-1"></a>mean.jogging <span class="ot">&lt;-</span> <span class="fu">mean</span>(trainset[<span class="fu">which</span>(trainset<span class="sc">$</span>class <span class="sc">==</span> <span class="st">&quot;Jogging&quot;</span>), <span class="dv">39</span>])</span>
<span id="cb41-10"><a href="classification.html#cb41-10" aria-hidden="true" tabindex="-1"></a>sd.jogging <span class="ot">&lt;-</span> <span class="fu">sd</span>(trainset[<span class="fu">which</span>(trainset<span class="sc">$</span>class <span class="sc">==</span> <span class="st">&quot;Jogging&quot;</span>), <span class="dv">39</span>])</span></code></pre></div>
<p>Print the means:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="classification.html#cb42-1" aria-hidden="true" tabindex="-1"></a>mean.standing</span>
<span id="cb42-2"><a href="classification.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 9.405795</span></span>
<span id="cb42-3"><a href="classification.html#cb42-3" aria-hidden="true" tabindex="-1"></a>mean.jogging</span>
<span id="cb42-4"><a href="classification.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 13.70145</span></span></code></pre></div>
<p>Note that the mean value for <em>‘Jogging’</em> is higher for this feature. This was expected since this feature captures the overall movement across all axes. Now we have everything we need to start making predictions on new instances. We have the priors and we have the means and standard deviations for each feature-class pair.</p>
<p>Let’s select the first instance from the test set and try to predict its class.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="classification.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select a query instance from the test set.</span></span>
<span id="cb43-2"><a href="classification.html#cb43-2" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> testset[<span class="dv">1</span>,] <span class="co"># Select the first one.</span></span></code></pre></div>
<p>Now we compute the posterior probability for each class using the learned means and standard deviations:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="classification.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute P(Standing)P(RESULTANT|Standing)</span></span>
<span id="cb44-2"><a href="classification.html#cb44-2" aria-hidden="true" tabindex="-1"></a>priors[<span class="st">&quot;Standing&quot;</span>] <span class="sc">*</span> <span class="fu">f</span>(query<span class="sc">$</span>RESULTANT, mean.standing, sd.standing)</span>
<span id="cb44-3"><a href="classification.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.003169748</span></span>
<span id="cb44-4"><a href="classification.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="classification.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute P(Jogging)P(RESULTANT|Jogging)</span></span>
<span id="cb44-6"><a href="classification.html#cb44-6" aria-hidden="true" tabindex="-1"></a>priors[<span class="st">&quot;Jogging&quot;</span>] <span class="sc">*</span> <span class="fu">f</span>(query<span class="sc">$</span>RESULTANT, mean.jogging, sd.jogging)</span>
<span id="cb44-7"><a href="classification.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.03884481</span></span></code></pre></div>
<p>The posterior for <em>‘Jogging’</em> was higher (<span class="math inline">\(0.038\)</span>) so we classify the query instance as <em>‘Jogging’</em>. If we check the true class we see that it was correctly classified!</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="classification.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the true class of the query instance.</span></span>
<span id="cb45-2"><a href="classification.html#cb45-2" aria-hidden="true" tabindex="-1"></a>query<span class="sc">$</span>class</span>
<span id="cb45-3"><a href="classification.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Jogging&quot;</span></span></code></pre></div>
<p>In this example we assumed that there was only one feature and we computed each step manually. However, this can easily be extended to deal with more features. So let’s just do that. We can write two functions, one for training the classifier and the other for making predictions.</p>
<p>The following function will be used to train the classifier. It takes as input a data frame with <span class="math inline">\(n\)</span> features. This function assumes that the class is the last column. The function returns a list with the learned priors, means, and standard deviations.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="classification.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to learn the parameters of </span></span>
<span id="cb46-2"><a href="classification.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># a Naive Bayes classifier.</span></span>
<span id="cb46-3"><a href="classification.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assumes that the last column of data is the class.</span></span>
<span id="cb46-4"><a href="classification.html#cb46-4" aria-hidden="true" tabindex="-1"></a>naive.bayes.train <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb46-5"><a href="classification.html#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="classification.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unique classes.</span></span>
<span id="cb46-7"><a href="classification.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  classes <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>class)</span>
<span id="cb46-8"><a href="classification.html#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="classification.html#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Number of features.</span></span>
<span id="cb46-10"><a href="classification.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  nfeatures <span class="ot">&lt;-</span> <span class="fu">ncol</span>(data) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb46-11"><a href="classification.html#cb46-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-12"><a href="classification.html#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># List to store the learned means and sds.</span></span>
<span id="cb46-13"><a href="classification.html#cb46-13" aria-hidden="true" tabindex="-1"></a>  list.means.sds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb46-14"><a href="classification.html#cb46-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-15"><a href="classification.html#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(c <span class="cf">in</span> classes){</span>
<span id="cb46-16"><a href="classification.html#cb46-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-17"><a href="classification.html#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Matrix to store the mean and sd for each feature.</span></span>
<span id="cb46-18"><a href="classification.html#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First column stores the mean and second column</span></span>
<span id="cb46-19"><a href="classification.html#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stores the sd.</span></span>
<span id="cb46-20"><a href="classification.html#cb46-20" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nfeatures, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb46-21"><a href="classification.html#cb46-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-22"><a href="classification.html#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Populate matrix.</span></span>
<span id="cb46-23"><a href="classification.html#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nfeatures){</span>
<span id="cb46-24"><a href="classification.html#cb46-24" aria-hidden="true" tabindex="-1"></a>      feature.values <span class="ot">&lt;-</span> data[<span class="fu">which</span>(data<span class="sc">$</span>class <span class="sc">==</span> c),i]</span>
<span id="cb46-25"><a href="classification.html#cb46-25" aria-hidden="true" tabindex="-1"></a>      M[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(feature.values)</span>
<span id="cb46-26"><a href="classification.html#cb46-26" aria-hidden="true" tabindex="-1"></a>      M[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sd</span>(feature.values)</span>
<span id="cb46-27"><a href="classification.html#cb46-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-28"><a href="classification.html#cb46-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-29"><a href="classification.html#cb46-29" aria-hidden="true" tabindex="-1"></a>    list.means.sds[c] <span class="ot">&lt;-</span> <span class="fu">list</span>(M)</span>
<span id="cb46-30"><a href="classification.html#cb46-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-31"><a href="classification.html#cb46-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-32"><a href="classification.html#cb46-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute prior probabilities.</span></span>
<span id="cb46-33"><a href="classification.html#cb46-33" aria-hidden="true" tabindex="-1"></a>  priors <span class="ot">&lt;-</span> <span class="fu">table</span>(data<span class="sc">$</span>class) <span class="sc">/</span> <span class="fu">nrow</span>(data)</span>
<span id="cb46-34"><a href="classification.html#cb46-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-35"><a href="classification.html#cb46-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">list.means.sds=</span>list.means.sds,</span>
<span id="cb46-36"><a href="classification.html#cb46-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">priors=</span>priors))</span>
<span id="cb46-37"><a href="classification.html#cb46-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The function iterates through each class and for each, it creates a matrix <code>M</code> with <span class="math inline">\(F\)</span> rows and <span class="math inline">\(2\)</span> columns where <span class="math inline">\(F\)</span> is the number of features. The first column stores the means and the second the standard deviations. Those matrices are saved in a list indexed by the class name so at prediction time we can retrieve each matrix individually. At the end, the prior probabilities are computed. Finally, a list is returned. The first element of the list is the list of matrices and the second element are the priors.</p>
<p>The next function will make predictions based on the learned parameters. Its first argument is the learned parameters and the second a data frame with the instances we want to make predictions for.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="classification.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to make predictions using</span></span>
<span id="cb47-2"><a href="classification.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the learned parameters.</span></span>
<span id="cb47-3"><a href="classification.html#cb47-3" aria-hidden="true" tabindex="-1"></a>naive.bayes.predict <span class="ot">&lt;-</span> <span class="cf">function</span>(params, data){</span>
<span id="cb47-4"><a href="classification.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-5"><a href="classification.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable to store the prediction for each instance.</span></span>
<span id="cb47-6"><a href="classification.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb47-7"><a href="classification.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-8"><a href="classification.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb47-9"><a href="classification.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-10"><a href="classification.html#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get class names.</span></span>
<span id="cb47-11"><a href="classification.html#cb47-11" aria-hidden="true" tabindex="-1"></a>  classes <span class="ot">&lt;-</span> <span class="fu">names</span>(params<span class="sc">$</span>priors)</span>
<span id="cb47-12"><a href="classification.html#cb47-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-13"><a href="classification.html#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get number of features.</span></span>
<span id="cb47-14"><a href="classification.html#cb47-14" aria-hidden="true" tabindex="-1"></a>  nfeatures <span class="ot">&lt;-</span> <span class="fu">nrow</span>(params<span class="sc">$</span>list.means.sds[[<span class="dv">1</span>]])</span>
<span id="cb47-15"><a href="classification.html#cb47-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-16"><a href="classification.html#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate instances.</span></span>
<span id="cb47-17"><a href="classification.html#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb47-18"><a href="classification.html#cb47-18" aria-hidden="true" tabindex="-1"></a>    query <span class="ot">&lt;-</span> data[i,]</span>
<span id="cb47-19"><a href="classification.html#cb47-19" aria-hidden="true" tabindex="-1"></a>    max.probability <span class="ot">&lt;-</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb47-20"><a href="classification.html#cb47-20" aria-hidden="true" tabindex="-1"></a>    predicted.class <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb47-21"><a href="classification.html#cb47-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-22"><a href="classification.html#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the class with highest probability.</span></span>
<span id="cb47-23"><a href="classification.html#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(c <span class="cf">in</span> classes){</span>
<span id="cb47-24"><a href="classification.html#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="classification.html#cb47-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get the prior probability for class c.</span></span>
<span id="cb47-26"><a href="classification.html#cb47-26" aria-hidden="true" tabindex="-1"></a>      acum.prob <span class="ot">&lt;-</span> params<span class="sc">$</span>priors[c]</span>
<span id="cb47-27"><a href="classification.html#cb47-27" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb47-28"><a href="classification.html#cb47-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Iterate features.</span></span>
<span id="cb47-29"><a href="classification.html#cb47-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nfeatures){</span>
<span id="cb47-30"><a href="classification.html#cb47-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-31"><a href="classification.html#cb47-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute P(feature|class)</span></span>
<span id="cb47-32"><a href="classification.html#cb47-32" aria-hidden="true" tabindex="-1"></a>        tmp <span class="ot">&lt;-</span> <span class="fu">f</span>(query[,j],</span>
<span id="cb47-33"><a href="classification.html#cb47-33" aria-hidden="true" tabindex="-1"></a>          params<span class="sc">$</span>list.means.sds[[c]][j,<span class="dv">1</span>],</span>
<span id="cb47-34"><a href="classification.html#cb47-34" aria-hidden="true" tabindex="-1"></a>          params<span class="sc">$</span>list.means.sds[[c]][j,<span class="dv">2</span>])</span>
<span id="cb47-35"><a href="classification.html#cb47-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-36"><a href="classification.html#cb47-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accumulate result.</span></span>
<span id="cb47-37"><a href="classification.html#cb47-37" aria-hidden="true" tabindex="-1"></a>        acum.prob <span class="ot">&lt;-</span> acum.prob <span class="sc">*</span> tmp</span>
<span id="cb47-38"><a href="classification.html#cb47-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb47-39"><a href="classification.html#cb47-39" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb47-40"><a href="classification.html#cb47-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(acum.prob <span class="sc">&gt;</span> max.probability){</span>
<span id="cb47-41"><a href="classification.html#cb47-41" aria-hidden="true" tabindex="-1"></a>        max.probability <span class="ot">&lt;-</span> acum.prob</span>
<span id="cb47-42"><a href="classification.html#cb47-42" aria-hidden="true" tabindex="-1"></a>        predicted.class <span class="ot">&lt;-</span> c</span>
<span id="cb47-43"><a href="classification.html#cb47-43" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb47-44"><a href="classification.html#cb47-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-45"><a href="classification.html#cb47-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-46"><a href="classification.html#cb47-46" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">c</span>(predictions, predicted.class)</span>
<span id="cb47-47"><a href="classification.html#cb47-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-48"><a href="classification.html#cb47-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-49"><a href="classification.html#cb47-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(predictions)</span>
<span id="cb47-50"><a href="classification.html#cb47-50" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This function iterates through each instance and computes the posterior for each class and stores the one that achieved the highest value as the prediction. Finally, it returns the list with all predictions.</p>
<p>Now we are ready to train our Naive Bayes classifier. All we need to do is call the function <code>naive.bayes.train()</code> and pass the train set.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="classification.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Learn Naive Bayes parameters.</span></span>
<span id="cb48-2"><a href="classification.html#cb48-2" aria-hidden="true" tabindex="-1"></a>nb.model <span class="ot">&lt;-</span> <span class="fu">naive.bayes.train</span>(trainset)</span></code></pre></div>
<p>The learned parameters are stored in <code>nb.model</code> and we can make predictions with the <code>naive.bayes.predict()</code> function by passing the <code>nb.model</code> and a test set.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="classification.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions.</span></span>
<span id="cb49-2"><a href="classification.html#cb49-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">naive.bayes.predict</span>(nb.model, testset)</span></code></pre></div>
<p>Then, we can assess the performance of the model by computing the confusion matrix.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="classification.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix and other performance metrics.</span></span>
<span id="cb50-2"><a href="classification.html#cb50-2" aria-hidden="true" tabindex="-1"></a>groundTruth <span class="ot">&lt;-</span> testset<span class="sc">$</span>class</span>
<span id="cb50-3"><a href="classification.html#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="classification.html#cb50-4" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(predictions),</span>
<span id="cb50-5"><a href="classification.html#cb50-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">as.factor</span>(groundTruth))</span>
<span id="cb50-6"><a href="classification.html#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="classification.html#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print accuracy</span></span>
<span id="cb50-8"><a href="classification.html#cb50-8" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb50-9"><a href="classification.html#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Accuracy </span></span>
<span id="cb50-10"><a href="classification.html#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.7501538</span></span>
<span id="cb50-11"><a href="classification.html#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="classification.html#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print overall metrics across classes.</span></span>
<span id="cb50-13"><a href="classification.html#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(cm<span class="sc">$</span>byClass[,<span class="fu">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>,</span>
<span id="cb50-14"><a href="classification.html#cb50-14" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)])</span>
<span id="cb50-15"><a href="classification.html#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Recall Specificity   Precision          F1 </span></span>
<span id="cb50-16"><a href="classification.html#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   0.6621381   0.9423729   0.6468372   0.6433231</span></span></code></pre></div>
<p>The accuracy was <span class="math inline">\(75\%\)</span>. In the previous section we obtained an accuracy of <span class="math inline">\(78\%\)</span> with decision trees. However, this does not necessarily mean that decision trees are better. Moreover, in the previous section we used cross-validation and here we used hold-out validation.</p>

<div class="rmdcaution">
Computing the posterior may cause a loss of numeric precision, specially when there are many features. This is because we are multiplying the likelihoods for each feature (see equation <a href="classification.html#eq:bayesclassifier2">(2.13)</a>) and those likelihoods are small numbers. One way to fix that is to use logarithms. In <code>naive.bayes.predict()</code> we can change <code>acum.prob &lt;- params$priors[c]</code> with <code>acum.prob &lt;- log(params$priors[c])</code> and <code>acum.prob &lt;- acum.prob * tmp</code> with <code>acum.prob &lt;- acum.prob + log(tmp)</code>. If you try those changes you should get the same result as before.
</div>
<p>There is already a popular R package (<code>e1071</code>) for training Naive Bayes classifiers. The following code trains a classifier using this package.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="classification.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Use Naive Bayes implementation from package e1071 ####</span></span>
<span id="cb51-2"><a href="classification.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb51-3"><a href="classification.html#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="classification.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to convert the class into a factor.</span></span>
<span id="cb51-5"><a href="classification.html#cb51-5" aria-hidden="true" tabindex="-1"></a>trainset<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainset<span class="sc">$</span>class)</span>
<span id="cb51-6"><a href="classification.html#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="classification.html#cb51-7" aria-hidden="true" tabindex="-1"></a>nb.model2 <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(class <span class="sc">~</span>., trainset)</span>
<span id="cb51-8"><a href="classification.html#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="classification.html#cb51-9" aria-hidden="true" tabindex="-1"></a>predictions2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb.model2, testset)</span>
<span id="cb51-10"><a href="classification.html#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="classification.html#cb51-11" aria-hidden="true" tabindex="-1"></a>cm2 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(predictions2),</span>
<span id="cb51-12"><a href="classification.html#cb51-12" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">as.factor</span>(groundTruth))</span>
<span id="cb51-13"><a href="classification.html#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="classification.html#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print accuracy</span></span>
<span id="cb51-15"><a href="classification.html#cb51-15" aria-hidden="true" tabindex="-1"></a>cm2<span class="sc">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb51-16"><a href="classification.html#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Accuracy </span></span>
<span id="cb51-17"><a href="classification.html#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.7501538</span></span></code></pre></div>
<p>As you can see, the result was the same as the one obtained with our implementation! We implemented our own for illustrative purposes but it is advisable to use already tested and proven packages. Furthermore, this one also supports categorical variables.</p>
</div>
</div>
<div id="dynamic-time-warping" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Dynamic Time Warping</h2>

<div class="rmdfolder">
<code>dtw_example.R</code>
</div>
<p>In the previous activity recognition example, we used the extracted features represented as feature vectors to train the classifiers instead of using the raw data. In some situations this can lead to temporal-relationships information loss. In the previous example, we could classify the activities with reasonable accuracy since the extracted features were able to retain enough information from the raw data. However, in some cases, having temporal information is crucial. For example, in hand signature recognition, a query signature is checked for a match with one of the signatures in a database. The signatures need to have an almost exact match to authenticate a user. If we represent each signature as a feature vector, it can turn out that two signatures have very similar feature vectors even though they look completely different. For example, Figure <a href="classification.html#fig:correlations">2.17</a> shows four datasets. They look very different but they all have the same correlation of <span class="math inline">\(0.816\)</span><a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>.</p>
<div class="figure" style="text-align: center"><span id="fig:correlations"></span>
<img src="images/correlations.png" alt="Four datasets with the same correlation of 0.816. Source: wikipedia (CC BY-SA 3.0)." width="90%" />
<p class="caption">
FIGURE 2.17: Four datasets with the same correlation of 0.816. Source: wikipedia (CC BY-SA 3.0).
</p>
</div>
<p>To avoid this potential issue, we can also include time-dependent information into our models by keeping the order of the data points. Another issue is that two time series that belong to the same class will still have some differences. Every time the same person signs a document the signature will vary a bit. In the same way, when we pronounce a word, sometimes we emphasize some letters or speak at different speeds. Figure <a href="classification.html#fig:verygood">2.18</a> shows two versions of the sentence “very good.” In the second one (bottom) the speaker emphasizes the “e” and as a result, the two sentences are not aligned in time anymore even though they have the same meaning.</p>
<div class="figure" style="text-align: center"><span id="fig:verygood"></span>
<img src="images/verygood.png" alt="Time shift example between two sentences." width="30%" />
<p class="caption">
FIGURE 2.18: Time shift example between two sentences.
</p>
</div>
<p>To compare two sequences we could use the well known Euclidean distance. However since the two sequences may not be aligned in time, the result could be misleading. Furthermore, the two sequences differ in length. To account for this “time-shift” effect in timeseries data, <em>Dynamic Time Warping</em> (DTW) <span class="citation">(<a href="#ref-sakoe1990dynamic" role="doc-biblioref">Sakoe et al. 1990</a>)</span> can be used instead. DTW is a method that:</p>
<ul>
<li>Finds an optimal match between two time-dependent sequences.</li>
<li>Computes their dissimilarity.</li>
<li>Finds the optimal deformation (mapping) of one of the sequences onto the other.</li>
</ul>
<p>Another advantage of DTW is that the timeseries do not need to be of the same length. Suppose we have two timeseries, a <em>query</em>, and a <em>reference</em> we want to compare with:</p>
<p><span class="math display">\[\begin{align*}
query&amp;=(2,2,2,4,4,3)\\
ref&amp;=(2,2,3,3,2)
\end{align*}\]</span></p>
<p>The first thing to note is that the sequences differ in length. Figure <a href="classification.html#fig:queryref">2.19</a> shows their plot. The <em>query</em> is the solid line and seems to be shifted to the right one position with respect to the <em>reference</em>. The plot also shows the resulting alignment after applying the DTW algorithm (dashed lines between the sequences). The resulting distance (after aligning) between the sequences is <span class="math inline">\(3\)</span>. In the following, we will see how the problem can be formalized and how it can be computed. Don’t worry if you find the math notation a bit difficult to grasp at this pint. A step by step example will follow which should help to explain how the method works.</p>
<div class="figure" style="text-align: center"><span id="fig:queryref"></span>
<img src="images/query_ref.png" alt="DTW alignment between the query and reference sequences (solid line is the query)." width="100%" />
<p class="caption">
FIGURE 2.19: DTW alignment between the query and reference sequences (solid line is the query).
</p>
</div>
<p>The problem of aligning two sequences can be formalized as follows <span class="citation">(<a href="#ref-Rabiner1993" role="doc-biblioref">Rabiner and Juang 1993</a>)</span>. Let <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> be two sequences:</p>
<p><span class="math display">\[\begin{align*}
X&amp;=(x_1,x_2,\dots,x_{T_x}) \\
Y&amp;=(y_1,y_2,\dots,y_{T_y})
\end{align*}\]</span></p>
<p>where <span class="math inline">\(x_i\)</span> and <span class="math inline">\(y_i\)</span> are vectors. In the previous example, the vectors only have one element since the sequences are <span class="math inline">\(1\)</span>-dimensional, but DTW also works with multidimensional sequences. <span class="math inline">\(T_x\)</span> and <span class="math inline">\(T_y\)</span> are the sequences’ lengths. Let</p>
<p><span class="math display">\[\begin{align*}
d(i_x,i_y)
\end{align*}\]</span></p>
<p>be the <em>dissimilarity</em> (distance) between vectors <span class="math inline">\(x_i\)</span> and <span class="math inline">\(y_i\)</span> (e.g., Euclidean distance). Then, <span class="math inline">\(\phi_x\)</span> and <span class="math inline">\(\phi_y\)</span> are the warping functions that relate <span class="math inline">\(i_x\)</span> and <span class="math inline">\(i_y\)</span> to a common axis <span class="math inline">\(k\)</span>:</p>
<p><span class="math display">\[\begin{align*}
i_x&amp;=\phi_x (k), k=1,2,\dots,T \\
i_y&amp;=\phi_y (k), k=1,2,\dots,T.
\end{align*}\]</span></p>
<p>The total dissimilarity between the two sequences is:</p>
<p><span class="math display" id="eq:dtwDissimilarity">\[\begin{equation}
  d_\phi (X,Y) = \sum_{k=1}^T{d\left(\phi_x (k), \phi_y (k)\right)}
  \tag{2.14}
\end{equation}\]</span></p>
<p>The aim is to find the warping function <span class="math inline">\(\phi\)</span> that minimizes the total dissimilarity:</p>
<p><span class="math display" id="eq:dtwmin">\[\begin{equation}
  \operatorname*{min}_{\phi} d_\phi (X,Y)
  \tag{2.15}
\end{equation}\]</span></p>
<p>The solution can be efficiently computed using dynamic programming. Usually, when solving this minimization problem, some constraints are applied:</p>
<ul>
<li><strong>Endpoint constraints.</strong> This constraint makes sure that the first and last elements of each sequence are connected (mapped to each other).</li>
</ul>
<p><span class="math display">\[\begin{align*}
\phi_x (1)&amp;=1, \phi_y (1)=1 \\
\phi_x (T)&amp;=T_x, \phi_y (T)=T_y
\end{align*}\]</span></p>
<ul>
<li><strong>Monotonicity.</strong> This constraint allows ‘time to flow’ only from left to right. That is, we cannot go back in time.</li>
</ul>
<p><span class="math display">\[\begin{align*}
\phi_x (k+1) \geq \phi_x(k) \\
\phi_y (k+1) \geq \phi_y(k)
\end{align*}\]</span></p>
<ul>
<li><strong>Local constraints.</strong> For example, allow jumps of at most <span class="math inline">\(1\)</span> step.</li>
</ul>
<p><span class="math display">\[\begin{align*}
\phi_x (k+1) - \phi_x(k) \leq 1 \\
\phi_y (k+1) - \phi_y(k) \leq 1
\end{align*}\]</span></p>
<p>Also, it is possible to apply global constraints, other local constraints, and apply different weights to slopes but the three described above are the most common ones. For a comprehensive list of constraints, please see <span class="citation">(<a href="#ref-Rabiner1993" role="doc-biblioref">Rabiner and Juang 1993</a>)</span>. Now let’s get back to our example and go through the steps to compute the dissimilarity and warping functions between our query (<span class="math inline">\(Q\)</span>) and reference (<span class="math inline">\(R\)</span>) sequences:</p>
<p><span class="math display">\[\begin{align*}
Q&amp;=(2,2,2,4,4,3) \\
R&amp;=(2,2,3,3,2)
\end{align*}\]</span></p>
<p>The first step is to compute a <em>local cost matrix</em>. This is just a matrix that contains the distance between every pair of points between the two sequences. For this example, we will use the <em>Manhattan distance</em>. Since our sequences are <span class="math inline">\(1\)</span>-dimensional this distance can be computed as the absolute difference <span class="math inline">\(|x_i - y_i|\)</span>. Figure <a href="classification.html#fig:localCost">2.20</a> shows the resulting local cost matrix.</p>
<div class="figure" style="text-align: center"><span id="fig:localCost"></span>
<img src="images/localCostMatrix.png" alt="Local cost matrix between Q and R." width="50%" />
<p class="caption">
FIGURE 2.20: Local cost matrix between Q and R.
</p>
</div>
<p>For example, position <span class="math inline">\((1,1)=0\)</span> (<em>row</em>,<em>column</em>) because the first element of <span class="math inline">\(Q\)</span> is <span class="math inline">\(2\)</span> and the first element of <span class="math inline">\(R\)</span> is also <span class="math inline">\(2\)</span>, thus, <span class="math inline">\(|2-2|=0\)</span>. The rest of the matrix is filled in the same way. In dynamic programming, partial results are computed and stored in a table. Figure <a href="classification.html#fig:dynamicTable">2.21</a> shows the final dynamic programming table computed from the local cost matrix. Initially, this table is empty. We start to fill it from bottom left at position <span class="math inline">\((1,1)\)</span>. From the local cost matrix, the cost at position <span class="math inline">\((1,1)\)</span> is <span class="math inline">\(0\)</span> so the cost at that position in the dynamic programming table is <span class="math inline">\(0\)</span>. Then we can start filling in the contiguous cells. The only direction from which we can arrive at position <span class="math inline">\((1,2)\)</span> is from the west (W). The cost at position <span class="math inline">\((1,2)\)</span> from the local cost matrix is <span class="math inline">\(0\)</span> and the cost of the <em>minimum</em> of the cell from the west <span class="math inline">\((1,1)\)</span> is also <span class="math inline">\(0\)</span>. So <span class="math inline">\(W:0+0=0\)</span>. For each cell we add the current cost plus the minimum cost when coming from the contiguous cell. The minimum costs are marked with red. For some cells it is possible to arrive from three different directions: S, W, and SW, thus we need to compute the cost when coming from each of those. The final minimum cost at position <span class="math inline">\((5,6)\)</span> is <span class="math inline">\(3\)</span>. Thus, that is the global DTW distance. In the example, it is possible to get the minimum at <span class="math inline">\((5,6)\)</span> when arriving from the south or southwest.</p>
<div class="figure" style="text-align: center"><span id="fig:dynamicTable"></span>
<img src="images/dynamicprogramming.png" alt="Dynamic programming table." width="90%" />
<p class="caption">
FIGURE 2.21: Dynamic programming table.
</p>
</div>
<p>Once the table is filled in, we can backtrack starting at <span class="math inline">\((5,6)\)</span> to find the warping functions. Figure <a href="classification.html#fig:warpingResult">2.22</a> shows the final warping functions. Because of the endpoint constraints, we know that <span class="math inline">\(\phi_Q(1)=1, \phi_R(1)=1\)</span> and <span class="math inline">\(\phi_Q(6)=6, \phi_R(6)=5\)</span>. Then, from <span class="math inline">\((5,6)\)</span> the minimum contiguous value is <span class="math inline">\(2\)</span> coming from SW, thus <span class="math inline">\(\phi_Q(5)=5, \phi_R(5)=4\)</span> and so on. Note that we could also had chosen to arrive from the south with the same minimum value of <span class="math inline">\(2\)</span> but still this would have resulted in the same overall distance. The dashed line in figure <a href="classification.html#fig:dynamicTable">2.21</a> shows the full backtracking.</p>
<div class="figure" style="text-align: center"><span id="fig:warpingResult"></span>
<img src="images/warpingResult.png" alt="Resulting warping functions." width="70%" />
<p class="caption">
FIGURE 2.22: Resulting warping functions.
</p>
</div>
<p>The runtime complexity of DTW is <span class="math inline">\(O(T_x T_y)\)</span>. This is the required time to compute the local cost matrix and the dynamic programming table.</p>
<p>In R, the <code>dtw</code> package <span class="citation">(<a href="#ref-giorgino2009" role="doc-biblioref">Giorgino 2009</a>)</span> has the function <code>dtw()</code> to compute the DTW distance between two sequences. Let’s use this package to solve the previous example.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="classification.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dtw&quot;</span>)</span>
<span id="cb52-2"><a href="classification.html#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="classification.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Sequences from the example</span></span>
<span id="cb52-4"><a href="classification.html#cb52-4" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">3</span>)</span>
<span id="cb52-5"><a href="classification.html#cb52-5" aria-hidden="true" tabindex="-1"></a>ref <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb52-6"><a href="classification.html#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="classification.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find dtw distance.</span></span>
<span id="cb52-8"><a href="classification.html#cb52-8" aria-hidden="true" tabindex="-1"></a>alignment <span class="ot">&lt;-</span> <span class="fu">dtw</span>(query, ref,</span>
<span id="cb52-9"><a href="classification.html#cb52-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">step =</span> symmetric1, <span class="at">keep.internals =</span> T)</span></code></pre></div>
<p>The <code>keep.internals = T</code> keeps the input data so it can be accessed later, e.g., for plotting. The cost matrix and final distance can be accessed from the resulting object. The <code>step</code> argument specifies a step pattern. A step pattern describes some of the algorithm constraints such as endpoint and local constraints. In this case, we use <code>symmetric1</code> which applies the constraints explained before. We can access the cost matrix, the final distance, and the warping functions <span class="math inline">\(\phi_x\)</span> and <span class="math inline">\(\phi_y\)</span> as follows:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="classification.html#cb53-1" aria-hidden="true" tabindex="-1"></a>alignment<span class="sc">$</span>localCostMatrix</span>
<span id="cb53-2"><a href="classification.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb53-3"><a href="classification.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    0    0    1    1    0</span></span>
<span id="cb53-4"><a href="classification.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0    0    1    1    0</span></span>
<span id="cb53-5"><a href="classification.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    0    0    1    1    0</span></span>
<span id="cb53-6"><a href="classification.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    2    2    1    1    2</span></span>
<span id="cb53-7"><a href="classification.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]    2    2    1    1    2</span></span>
<span id="cb53-8"><a href="classification.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,]    1    1    0    0    1</span></span>
<span id="cb53-9"><a href="classification.html#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="classification.html#cb53-10" aria-hidden="true" tabindex="-1"></a>alignment<span class="sc">$</span>distance</span>
<span id="cb53-11"><a href="classification.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb53-12"><a href="classification.html#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="classification.html#cb53-13" aria-hidden="true" tabindex="-1"></a>alignment<span class="sc">$</span>index1</span>
<span id="cb53-14"><a href="classification.html#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 2 3 4 5 6</span></span>
<span id="cb53-15"><a href="classification.html#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="classification.html#cb53-16" aria-hidden="true" tabindex="-1"></a>alignment<span class="sc">$</span>index2</span>
<span id="cb53-17"><a href="classification.html#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 1 2 3 4 5</span></span></code></pre></div>
<p>The local cost matrix is the same one as in Figure <a href="classification.html#fig:localCost">2.20</a> but in rotated form. The resulting object also has the dynamic programming table which can be plotted along with the resulting backtracking.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="classification.html#cb54-1" aria-hidden="true" tabindex="-1"></a>ccm <span class="ot">&lt;-</span> alignment<span class="sc">$</span>costMatrix</span>
<span id="cb54-2"><a href="classification.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ccm), <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(ccm),</span>
<span id="cb54-3"><a href="classification.html#cb54-3" aria-hidden="true" tabindex="-1"></a>      ccm, <span class="at">xlab =</span> <span class="st">&quot;Q&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;R&quot;</span>)</span>
<span id="cb54-4"><a href="classification.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">row</span>(ccm), <span class="fu">col</span>(ccm), <span class="at">label =</span> ccm)</span>
<span id="cb54-5"><a href="classification.html#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(alignment<span class="sc">$</span>index1, alignment<span class="sc">$</span>index2)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:backtracking"></span>
<img src="images/backtracking.png" alt="Dynamic programming table and backtracking." width="90%" />
<p class="caption">
FIGURE 2.23: Dynamic programming table and backtracking.
</p>
</div>
<p>And finally, the aligned sequences can be plotted. The previous Figure <a href="classification.html#fig:queryref">2.19</a> shows the result of the following command.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="classification.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(alignment, <span class="at">type=</span><span class="st">&quot;two&quot;</span>, <span class="at">off=</span><span class="fl">1.5</span>,</span>
<span id="cb55-2"><a href="classification.html#cb55-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">match.lty=</span><span class="dv">2</span>,</span>
<span id="cb55-3"><a href="classification.html#cb55-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">match.indices=</span><span class="dv">10</span>,</span>
<span id="cb55-4"><a href="classification.html#cb55-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;DTW resulting alignment&quot;</span>,</span>
<span id="cb55-5"><a href="classification.html#cb55-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;time&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;magnitude&quot;</span>)</span></code></pre></div>
<div id="sechandgestures" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Hand Gesture Recognition</h3>

<div class="rmdfolder">
<code>hand_gestures.R</code>, <code>hand_gestures_auxiliary.R</code>
</div>
<p>Gestures are a form of communication. They are often accompanied with speech but can also be used to communicate something independently of speech (like in sign language). Gestures allow us to externalize and emphasize emotions and thoughts. They are based on body movements from arms, hands, fingers, face, head, etc. Gestures can be used as a non-verbal way to identify and study behaviors for different purposes such as for emotion <span class="citation">(<a href="#ref-de2006towards" role="doc-biblioref">De Gelder 2006</a>)</span> or for the identification of developmental disorders like autism <span class="citation">(<a href="#ref-anzulewicz2016toward" role="doc-biblioref">Anzulewicz, Sobota, and Delafield-Butt 2016</a>)</span>.</p>
<p>Gestures can also be used to develop user-computer interaction applications. The following video shows an example application of gesture recognition for domotics.</p>
<iframe src="https://www.youtube.com/embed/47-35YmimN4" width="672" height="400px">
</iframe>
<p>The application determines the indoor location using <span class="math inline">\(k\)</span>-NN as it was shown in this chapter. The gestures are classified using DTW (I’ll show how to do it in a moment). Based on the location and type of gesture, an specific home appliance is activated. I programmed that app some time ago using the same algorithms presented here.</p>
<p>To demonstrate how DTW can be used for hand gesture recognition, we will examine the <em>HAND GESTURES</em> dataset that was collected with a smartphone using its accelerometer sensor. The data was collected by <span class="math inline">\(10\)</span> individuals who performed <span class="math inline">\(5\)</span> repetitions of <span class="math inline">\(10\)</span> different gestures (<em>‘triangle’</em>, <em>‘square’</em>, <em>‘circle’</em>, <em>‘a’</em>, <em>‘b’</em>, <em>‘c’</em>, <em>‘1’</em>, <em>‘2’</em>, <em>‘3’</em>, <em>‘4’</em>). The sensor is a tri-axial accelerometer that returns values for the <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span>, and <span class="math inline">\(z\)</span> axes. The participants were not instructed to hold the smartphone in any particular way. The sampling rate was set at <span class="math inline">\(50\)</span> Hz. To record a gesture, the user presses the phone’s screen with her/his thumb, performs the gesture in the air, and stops pressing the screen after the gesture is complete. Figure <a href="classification.html#fig:gesturesFigure">2.24</a> shows the start and end positions of the <span class="math inline">\(10\)</span> gestures.</p>
<div class="figure" style="text-align: center"><span id="fig:gesturesFigure"></span>
<img src="images/gestures.png" alt="Paths for the 10 considered gestures." width="40%" />
<p class="caption">
FIGURE 2.24: Paths for the 10 considered gestures.
</p>
</div>
<p>In order to make the recognition orientation-independent, we can compute the <em>magnitude</em> of the <span class="math inline">\(3\)</span> accelerometer axes. This will provide us with the overall movement patterns regardless of orientation.</p>
<p><span class="math display" id="eq:magnitude">\[\begin{equation}
Magnitude(t) = \sqrt {{a_x}{{(t)}^2} + {a_y}{{(t)}^2} + {a_z}{{(t)}^2}}
\tag{2.16}
\end{equation}\]</span></p>
<p>where <span class="math inline">\({a_x}{{(t)}}\)</span>, <span class="math inline">\({a_y}{{(t)}}\)</span> and <span class="math inline">\({a_z}{{(t)}}\)</span> are the accelerations at time <span class="math inline">\(t\)</span>.</p>
<p>Figure <a href="classification.html#fig:handGestureMagnitude">2.25</a> shows the raw accelerometer values (dashed lines) for a <em>triangle</em> gesture. The solid line shows the resulting magnitude. This will also simplify things since we will now work with <span class="math inline">\(1\)</span>-dimensional sequences (the magnitudes) instead of the other <span class="math inline">\(3\)</span> axes.</p>
<div class="figure" style="text-align: center"><span id="fig:handGestureMagnitude"></span>
<img src="images/triangle_xyzmagnitude.png" alt="Triangle gesture." width="90%" />
<p class="caption">
FIGURE 2.25: Triangle gesture.
</p>
</div>
<p>The gestures are stored in text files that contain the <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span>, and <span class="math inline">\(z\)</span> recordings. The script <code>hand_gestures_auxiliary.R</code> has some auxiliary functions to preprocess the data. Since the sequences of each gesture are of varying length, storing them as a data frame could be problematic because data frames have fixed sizes. Instead, the <code>gen.instances()</code> function processes the files and returns all hand gestures as a list. This function also computes the magnitude (equation <a href="classification.html#eq:magnitude">(2.16)</a>). The following code (from <code>hand_gestures.R</code>) calls the <code>gen.instances()</code> function and stores the results in the <code>instances</code> variable which is a list. Then, we select the first and second instances to be the query and the reference.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="classification.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format instances from files.</span></span>
<span id="cb56-2"><a href="classification.html#cb56-2" aria-hidden="true" tabindex="-1"></a>instances <span class="ot">&lt;-</span> <span class="fu">gen.instances</span>(<span class="st">&quot;../data/hand_gestures/&quot;</span>)</span>
<span id="cb56-3"><a href="classification.html#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="classification.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use first instance as the query.</span></span>
<span id="cb56-5"><a href="classification.html#cb56-5" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> instances[[<span class="dv">1</span>]]</span>
<span id="cb56-6"><a href="classification.html#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="classification.html#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use second instance as the reference.</span></span>
<span id="cb56-8"><a href="classification.html#cb56-8" aria-hidden="true" tabindex="-1"></a>ref <span class="ot">&lt;-</span> instances[[<span class="dv">2</span>]]</span></code></pre></div>
<p>Each element in <code>instances</code> is also a list that stores the <em>type</em> and <em>values</em> (magnitude) of each gesture.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="classification.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print their respective classes</span></span>
<span id="cb57-2"><a href="classification.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(query<span class="sc">$</span>type)</span>
<span id="cb57-3"><a href="classification.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1&quot;</span></span>
<span id="cb57-4"><a href="classification.html#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="classification.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ref<span class="sc">$</span>type)</span>
<span id="cb57-6"><a href="classification.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1&quot;</span></span></code></pre></div>
<p>Here, the first two instances are of type <em>‘1’</em>. We can also print the magnitude values.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="classification.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print values.</span></span>
<span id="cb58-2"><a href="classification.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(query<span class="sc">$</span>values)</span>
<span id="cb58-3"><a href="classification.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  9.167477  9.291464  9.729926  9.901090  ....</span></span></code></pre></div>
<p>In this case, both classes are “1.” We can use the <code>dtw()</code> function to compute the similarity between the <em>query</em> and the <em>reference</em> instance and plot the resulting alignment.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="classification.html#cb59-1" aria-hidden="true" tabindex="-1"></a>alignment <span class="ot">&lt;-</span> <span class="fu">dtw</span>(query<span class="sc">$</span>values, ref<span class="sc">$</span>values, <span class="at">keep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-2"><a href="classification.html#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="classification.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Print similarity (distance)</span></span>
<span id="cb59-4"><a href="classification.html#cb59-4" aria-hidden="true" tabindex="-1"></a>alignment<span class="sc">$</span>distance</span>
<span id="cb59-5"><a href="classification.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 68.56493</span></span>
<span id="cb59-6"><a href="classification.html#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="classification.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot result.</span></span>
<span id="cb59-8"><a href="classification.html#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(alignment, <span class="at">type=</span><span class="st">&quot;two&quot;</span>, <span class="at">off=</span><span class="dv">1</span>, <span class="at">match.lty=</span><span class="dv">2</span>, <span class="at">match.indices=</span><span class="dv">40</span>,</span>
<span id="cb59-9"><a href="classification.html#cb59-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;DTW resulting alignment&quot;</span>,</span>
<span id="cb59-10"><a href="classification.html#cb59-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;time&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;magnitude&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:alignmentExample"></span>
<img src="images/alignmentExample.png" alt="Resulting alignment." width="90%" />
<p class="caption">
FIGURE 2.26: Resulting alignment.
</p>
</div>
<p>To perform the actual classification, we will use our well-known <span class="math inline">\(k\)</span>-NN classifier with <span class="math inline">\(k=1\)</span>. To classify a <em>query instance</em>, we need to compute its DTW distance to every other instance in the training set and predict the label from the closest one. We will test the performance using <span class="math inline">\(10\)</span>-fold cross-validation. Since computing all DTW distances takes some time, we can precompute all pairs of distances and store them in a matrix. The auxiliary function <code>matrix.distances()</code> does the job. Since this can take some minutes, the results are saved so there is no need to wait next time the code is run.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="classification.html#cb60-1" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">matrix.distances</span>(instances)</span>
<span id="cb60-2"><a href="classification.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="classification.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save results.</span></span>
<span id="cb60-4"><a href="classification.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(D, <span class="at">file=</span><span class="st">&quot;D.RData&quot;</span>)</span></code></pre></div>
<p>The <code>matrix.distances()</code> returns a list. The first element is an array with the gestures’ classes and the second element is the actual distance matrix. The elements in the diagonal are set to <code>Inf</code> to signal that we don’t want to take into account the dissimilarity between a gesture and itself.</p>
<p>For convenience, this matrix is already stored in the file <code>D.RData</code> located this chapter’s code directory. The following code performs the <span class="math inline">\(10\)</span>-fold cross-validation and computes the performance results.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="classification.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the DTW distances matrix.</span></span>
<span id="cb61-2"><a href="classification.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;D.RData&quot;</span>)</span>
<span id="cb61-3"><a href="classification.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb61-4"><a href="classification.html#cb61-4" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="co"># Number of folds.</span></span>
<span id="cb61-5"><a href="classification.html#cb61-5" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(k, <span class="at">size =</span> <span class="fu">length</span>(D[[<span class="dv">1</span>]]), <span class="at">replace =</span> T)</span>
<span id="cb61-6"><a href="classification.html#cb61-6" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb61-7"><a href="classification.html#cb61-7" aria-hidden="true" tabindex="-1"></a>groundTruth <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb61-8"><a href="classification.html#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="classification.html#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement k-NN with k=1.</span></span>
<span id="cb61-10"><a href="classification.html#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb61-11"><a href="classification.html#cb61-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-12"><a href="classification.html#cb61-12" aria-hidden="true" tabindex="-1"></a>  trainSet <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">!=</span> i)</span>
<span id="cb61-13"><a href="classification.html#cb61-13" aria-hidden="true" tabindex="-1"></a>  testSet <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">==</span> i)</span>
<span id="cb61-14"><a href="classification.html#cb61-14" aria-hidden="true" tabindex="-1"></a>  train.labels <span class="ot">&lt;-</span> D[[<span class="dv">1</span>]][trainSet]</span>
<span id="cb61-15"><a href="classification.html#cb61-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-16"><a href="classification.html#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(query <span class="cf">in</span> testSet){</span>
<span id="cb61-17"><a href="classification.html#cb61-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-18"><a href="classification.html#cb61-18" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> D[[<span class="dv">1</span>]][query]</span>
<span id="cb61-19"><a href="classification.html#cb61-19" aria-hidden="true" tabindex="-1"></a>    distances <span class="ot">&lt;-</span> D[[<span class="dv">2</span>]][query, ][trainSet]</span>
<span id="cb61-20"><a href="classification.html#cb61-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-21"><a href="classification.html#cb61-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the closest one.</span></span>
<span id="cb61-22"><a href="classification.html#cb61-22" aria-hidden="true" tabindex="-1"></a>    nn <span class="ot">&lt;-</span> <span class="fu">sort</span>(distances, <span class="at">index.return =</span> T)<span class="sc">$</span>ix[<span class="dv">1</span>]</span>
<span id="cb61-23"><a href="classification.html#cb61-23" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> train.labels[nn]</span>
<span id="cb61-24"><a href="classification.html#cb61-24" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">c</span>(predictions, pred)</span>
<span id="cb61-25"><a href="classification.html#cb61-25" aria-hidden="true" tabindex="-1"></a>    groundTruth <span class="ot">&lt;-</span> <span class="fu">c</span>(groundTruth, type)</span>
<span id="cb61-26"><a href="classification.html#cb61-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-27"><a href="classification.html#cb61-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-28"><a href="classification.html#cb61-28" aria-hidden="true" tabindex="-1"></a>} <span class="co"># end of for</span></span></code></pre></div>
<p>The line <code>distances &lt;- D[[2]][query, ][trainSet]</code> retrieves the pre-computed distances between the test <em>query</em> and all gestures in the train set. Then, those distances are sorted in ascending order and the class of the closest one is used as the prediction. Finally, the performance is calculated.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="classification.html#cb62-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(predictions),</span>
<span id="cb62-2"><a href="classification.html#cb62-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(groundTruth))</span>
<span id="cb62-3"><a href="classification.html#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="classification.html#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute performance metrics per class.</span></span>
<span id="cb62-5"><a href="classification.html#cb62-5" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>byClass[,<span class="fu">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>, <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)]</span>
<span id="cb62-6"><a href="classification.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   Recall Specificity Precision        F1</span></span>
<span id="cb62-7"><a href="classification.html#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: 1            0.84   0.9911111 0.9130435 0.8750000</span></span>
<span id="cb62-8"><a href="classification.html#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: 2            0.84   0.9866667 0.8750000 0.8571429</span></span>
<span id="cb62-9"><a href="classification.html#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: 3            0.96   0.9911111 0.9230769 0.9411765</span></span>
<span id="cb62-10"><a href="classification.html#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: 4            0.98   0.9933333 0.9423077 0.9607843</span></span>
<span id="cb62-11"><a href="classification.html#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: a            0.78   0.9733333 0.7647059 0.7722772</span></span>
<span id="cb62-12"><a href="classification.html#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: b            0.76   0.9955556 0.9500000 0.8444444</span></span>
<span id="cb62-13"><a href="classification.html#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: c            0.90   1.0000000 1.0000000 0.9473684</span></span>
<span id="cb62-14"><a href="classification.html#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: circleLeft   0.78   0.9622222 0.6964286 0.7358491</span></span>
<span id="cb62-15"><a href="classification.html#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: square       1.00   0.9977778 0.9803922 0.9900990</span></span>
<span id="cb62-16"><a href="classification.html#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Class: triangle     0.92   0.9711111 0.7796610 0.8440367</span></span>
<span id="cb62-17"><a href="classification.html#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="classification.html#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall performance metrics</span></span>
<span id="cb62-19"><a href="classification.html#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(cm<span class="sc">$</span>byClass[,<span class="fu">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>,</span>
<span id="cb62-20"><a href="classification.html#cb62-20" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)])</span>
<span id="cb62-21"><a href="classification.html#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Recall Specificity   Precision          F1 </span></span>
<span id="cb62-22"><a href="classification.html#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.8760000   0.9862222   0.8824616   0.8768178 </span></span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gesturesCM"></span>
<img src="images/gesturesCM.png" alt="Confusion matrix for hand gestures' predictions." width="90%" />
<p class="caption">
FIGURE 2.27: Confusion matrix for hand gestures’ predictions.
</p>
</div>
<p>The overall recall was <span class="math inline">\(0.87\)</span> which is not bad. From the confusion matrix, we can see that the class <em>‘a’</em> was often confused with <em>‘circleLeft’</em> and vice versa. This makes sense since both have similar motions (see Figure <a href="classification.html#fig:gesturesFigure">2.24</a>). Also, <em>‘b’</em> was often confused with <em>‘circleLeft’</em>. The <em>‘square’</em> class was always correctly classified. This example demonstrated how DTW can be used with <span class="math inline">\(k\)</span>-NN to recognize hand gestures.</p>
</div>
</div>
<div id="dummy-models" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Dummy Models</h2>

<div class="rmdfolder">
<code>dummy_classifiers.R</code>
</div>
<p>When faced with a new problem, you may be tempted to start trying to solve it by using a complex model. Then, you proceed to train your complex model and evaluate it. The results look reasonably good so you think you are done. However, this good performance could only be an <em>illusion</em>. Sometimes there are underlying problems with the data that can give the false impression that a model is performing well. Examples of such problems are imbalanced datasets, no correlation between the features and the classes, features not containing enough information, etc. <strong>Dummy models</strong> can be used to spot some of those problems. Dummy models use little or no information at all when making predictions (we’ll see how in a moment).</p>
<p>Furthermore, for some problems (specially in regression) it is not clear what is considered to be a good performance. There are problems in which doing slightly better than random is considered a great achievement (e.g., in forecasting) but for other problems that would be unacceptable. Thus, we need some type of baseline to assess whether or not a particular model is bringing some benefit. Dummy models are not only used to spot problems but can be used as baselines as well.</p>

<div class="rmdinfo">
Dummy models are also called <em>baseline models</em> or <em>dumb models</em>. One student I was supervising used to call them <em>stupid models</em>. When I am angry, I also call them like that, but today I’m in a good mood so I’ll refer to them as <em>dummy</em>.
</div>
<p>Now, I will present three types of dummy classifiers and how they can be implemented in R.</p>
<div id="most-frequent-class-classifier" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Most-frequent-class Classifier</h3>
<p>As the name implies, the most-frequent-class classifier always predicts the most frequent label found in the train set. This means that the model does not even need to look at the features! Once it is presented with a new instance, it just outputs the most common class as the prediction.</p>
<p>To show how it can be implemented, I will use the <em>SMARTPHONES ACTIVITIES</em> dataset. For demonstration purposes, I will only keep two classes: <em>‘Walking’</em> and <em>‘Upstairs’</em>. Furthermore, I will only pick a small percent of the instances with class <em>‘Upstairs’</em> to simulate an imbalanced dataset. Imbalanced means that there are classes for which only a few instances exist. More about imbalanced data and how to handle it will be covered in chapter <a href="preprocessing.html#preprocessing">5</a>. After those modifications, we can check the class counts:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="classification.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print class counts.</span></span>
<span id="cb63-2"><a href="classification.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dataset<span class="sc">$</span>class)</span>
<span id="cb63-3"><a href="classification.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Upstairs  Walking </span></span>
<span id="cb63-4"><a href="classification.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      200     2081</span></span>
<span id="cb63-5"><a href="classification.html#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="classification.html#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co"># In percentages.</span></span>
<span id="cb63-7"><a href="classification.html#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dataset<span class="sc">$</span>class) <span class="sc">/</span> <span class="fu">nrow</span>(dataset)</span>
<span id="cb63-8"><a href="classification.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Upstairs    Walking </span></span>
<span id="cb63-9"><a href="classification.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.08768084 0.91231916</span></span></code></pre></div>
<p>We can see that more than <span class="math inline">\(90\%\)</span> of the instances belong to class <em>‘Walking’</em>. It’s time to define the dummy classifier!</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="classification.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dummy classifier&#39;s train function.</span></span>
<span id="cb64-2"><a href="classification.html#cb64-2" aria-hidden="true" tabindex="-1"></a>most.frequent.class.train <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb64-3"><a href="classification.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-4"><a href="classification.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get a table with the class counts.</span></span>
<span id="cb64-5"><a href="classification.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  counts <span class="ot">&lt;-</span> <span class="fu">table</span>(data<span class="sc">$</span>class)</span>
<span id="cb64-6"><a href="classification.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-7"><a href="classification.html#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the label with the most counts.</span></span>
<span id="cb64-8"><a href="classification.html#cb64-8" aria-hidden="true" tabindex="-1"></a>  most.frequent <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which.max</span>(counts))</span>
<span id="cb64-9"><a href="classification.html#cb64-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-10"><a href="classification.html#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(most.frequent)</span>
<span id="cb64-11"><a href="classification.html#cb64-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>most.frequent.class.train()</code> function will learn the parameters from a train set. The only thing this model needs to learn is what is the most frequent class. First, the <code>table()</code> function is used to get the class counts and then the name of the class with the max counts is returned. Now we define the predict function which takes as its first argument the learned parameters and as second argument the test set on which we want to make predictions. The parameter only consists of the name of a class.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="classification.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dummy classifier&#39;s predict function.</span></span>
<span id="cb65-2"><a href="classification.html#cb65-2" aria-hidden="true" tabindex="-1"></a>most.frequent.class.predict <span class="ot">&lt;-</span> <span class="cf">function</span>(params, data){</span>
<span id="cb65-3"><a href="classification.html#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="classification.html#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the same label for as many rows as there are in data.</span></span>
<span id="cb65-5"><a href="classification.html#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rep</span>(params, <span class="fu">nrow</span>(data)))</span>
<span id="cb65-6"><a href="classification.html#cb65-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-7"><a href="classification.html#cb65-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The only thing the predict function does is to return the <code>params</code> argument that contains the class name repeated <span class="math inline">\(n\)</span> times. Where <span class="math inline">\(n\)</span> is the number of rows in the test data frame.</p>
<p>Let’s try our functions. The dataset has already been split into <span class="math inline">\(50\%\)</span> for training and <span class="math inline">\(50\%\)</span> for testing. First we train the dummy model using the train set. Then, the learned parameter is printed.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="classification.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Learn the parameters.</span></span>
<span id="cb66-2"><a href="classification.html#cb66-2" aria-hidden="true" tabindex="-1"></a>dummy.model1 <span class="ot">&lt;-</span> <span class="fu">most.frequent.class.train</span>(trainset)</span>
<span id="cb66-3"><a href="classification.html#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="classification.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the learned parameter.</span></span>
<span id="cb66-5"><a href="classification.html#cb66-5" aria-hidden="true" tabindex="-1"></a>dummy.model1</span>
<span id="cb66-6"><a href="classification.html#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Walking&quot;</span></span></code></pre></div>
<p>Now we can make predictions on the test set and compute the accuracy.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="classification.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions.</span></span>
<span id="cb67-2"><a href="classification.html#cb67-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">most.frequent.class.predict</span>(dummy.model1, testset)</span>
<span id="cb67-3"><a href="classification.html#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="classification.html#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix and other performance metrics.</span></span>
<span id="cb67-5"><a href="classification.html#cb67-5" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(predictions, levels),</span>
<span id="cb67-6"><a href="classification.html#cb67-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">factor</span>(testset<span class="sc">$</span>class, levels))</span>
<span id="cb67-7"><a href="classification.html#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="classification.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print accuracy</span></span>
<span id="cb67-9"><a href="classification.html#cb67-9" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb67-10"><a href="classification.html#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Accuracy </span></span>
<span id="cb67-11"><a href="classification.html#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.9087719</span></span></code></pre></div>
<p>The accuracy was <span class="math inline">\(90.8\%\)</span>. It seems that the dummy classifier was not that dummy after all! Let’s print the confusion matrix to inspect the predictions.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="classification.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print confusion matrix.</span></span>
<span id="cb68-2"><a href="classification.html#cb68-2" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>table</span>
<span id="cb68-3"><a href="classification.html#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="classification.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Reference</span></span>
<span id="cb68-5"><a href="classification.html#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prediction Walking Upstairs</span></span>
<span id="cb68-6"><a href="classification.html#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Walking     1036      104</span></span>
<span id="cb68-7"><a href="classification.html#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Upstairs       0        0</span></span></code></pre></div>
<p>From the confusion matrix we can see that all <em>‘Walking’</em> activities were correctly classified but none of the <em>‘Upstairs’</em> classes were identified. This is because the dummy model only predicts <em>‘Walking’</em>. Here we can see that even though it seemed like the dummy model was doing pretty good, it was not that good after all.</p>
<p>We can now try with a decision tree from the <code>rpart</code> package.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="classification.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Let&#39;s try with a decision tree</span></span>
<span id="cb69-2"><a href="classification.html#cb69-2" aria-hidden="true" tabindex="-1"></a>treeClassifier <span class="ot">&lt;-</span> <span class="fu">rpart</span>(class <span class="sc">~</span> ., trainset)</span>
<span id="cb69-3"><a href="classification.html#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="classification.html#cb69-4" aria-hidden="true" tabindex="-1"></a>tree.predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(treeClassifier, testset, <span class="at">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb69-5"><a href="classification.html#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="classification.html#cb69-6" aria-hidden="true" tabindex="-1"></a>cm.tree <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(tree.predictions, levels),</span>
<span id="cb69-7"><a href="classification.html#cb69-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(testset<span class="sc">$</span>class, levels))</span>
<span id="cb69-8"><a href="classification.html#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="classification.html#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print accuracy</span></span>
<span id="cb69-10"><a href="classification.html#cb69-10" aria-hidden="true" tabindex="-1"></a>cm.tree<span class="sc">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb69-11"><a href="classification.html#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Accuracy </span></span>
<span id="cb69-12"><a href="classification.html#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.9263158</span></span></code></pre></div>
<p>Decision trees are more powerful than dummy classifiers but the accuracy was very similar!</p>

<div class="rmdgoodpractice">
It is a good practice to compare powerful models against dummy models. If their performances are similar, this may be an indication that there is something that needs to be checked. In this example, the problem was that the dataset was imbalanced. It is also adivisable to report not only the accuracy but other metrics. We could also have noted the imbalance problem by looking at the recall of the individual classes, for example.
</div>
</div>
<div id="uniform-classifier" class="section level3" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Uniform Classifier</h3>
<p>This is another type of dummy classifier. This one predicts classes at random with equal probability and can be implemented as follows.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="classification.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dummy classifier&#39;s train function.</span></span>
<span id="cb70-2"><a href="classification.html#cb70-2" aria-hidden="true" tabindex="-1"></a>uniform.train <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb70-3"><a href="classification.html#cb70-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-4"><a href="classification.html#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the unique classes.</span></span>
<span id="cb70-5"><a href="classification.html#cb70-5" aria-hidden="true" tabindex="-1"></a>  unique.classes <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>class)</span>
<span id="cb70-6"><a href="classification.html#cb70-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-7"><a href="classification.html#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(unique.classes)</span>
<span id="cb70-8"><a href="classification.html#cb70-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-9"><a href="classification.html#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="classification.html#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dummy classifier&#39;s predict function.</span></span>
<span id="cb70-11"><a href="classification.html#cb70-11" aria-hidden="true" tabindex="-1"></a>uniform.predict <span class="ot">&lt;-</span> <span class="cf">function</span>(params, data){</span>
<span id="cb70-12"><a href="classification.html#cb70-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-13"><a href="classification.html#cb70-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample classes uniformly.</span></span>
<span id="cb70-14"><a href="classification.html#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sample</span>(unique.classes, <span class="at">size =</span> <span class="fu">nrow</span>(data), <span class="at">replace =</span> T))</span>
<span id="cb70-15"><a href="classification.html#cb70-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-16"><a href="classification.html#cb70-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>At prediction time, it just picks a random label for each instance in the test set. This model achieved an accuracy of only <span class="math inline">\(49.0\%\)</span> using the same dataset, but it correctly identified more classes of type <em>‘Upstairs’</em>.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="classification.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Reference</span></span>
<span id="cb71-2"><a href="classification.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prediction Walking Upstairs</span></span>
<span id="cb71-3"><a href="classification.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Walking      506       54</span></span>
<span id="cb71-4"><a href="classification.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Upstairs     530       50</span></span></code></pre></div>
<p>If a dataset is balanced and the accuracy of the uniform classifier is similar to the more complex model, the problem may be that the features are not providing enough information. That is, the complex classifier was not able to extract any useful patterns from the features.</p>
</div>
<div id="frequency-based-classifier" class="section level3" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Frequency-based Classifier</h3>
<p>This one is similar to the uniform classifier but the probability of choosing a class is proportional to its frequency in the train set. Its implementation is similar to the uniform classifier but makes use of the <code>prob</code> parameter in the <code>sample()</code> function to specify weights for each class. The higher the weight for a class, the more probable it will be chosen at prediction time. The implementation of this one is in the script <code>dummy_classifiers.R</code>.</p>
<p>The frequency-based classifier achieved an accuracy of <span class="math inline">\(85.5\%\)</span>. Much lower than the most-frequent-class model (<span class="math inline">\(90.8\%\)</span>) but it was able to detect some of the <em>‘Upstairs’</em> classes.</p>
</div>
<div id="other-dummy-classifiers" class="section level3" number="2.6.4">
<h3><span class="header-section-number">2.6.4</span> Other Dummy Classifiers</h3>
<p>Another dummy model that can be used for classification is to apply simple thresholds.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="classification.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(feature1 <span class="sc">&lt;</span> threshold)</span>
<span id="cb72-2"><a href="classification.html#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="st">&quot;A&quot;</span>)</span>
<span id="cb72-3"><a href="classification.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb72-4"><a href="classification.html#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="st">&quot;B&quot;</span>)</span></code></pre></div>
<p>In fact, the previous rule can be thought of as a very simple decision tree with only one root node. Surprisingly, sometimes simple rules can be difficult to beat by more complex models. In this section I’ve been focusing on classification problems, but dummy models can also be constructed for <strong>regression</strong>. The simplest one would be to predict the mean value of <span class="math inline">\(y\)</span> regardless of the feature values. Another dummy model could predict a random value between the min and max of <span class="math inline">\(y\)</span>. If there is a categorical feature, one could predict the mean value based on the category. In fact, that is what we did in chapter <a href="intro.html#intro">1</a> in the simple regression example.</p>
<p>In summary, one can construct any type of dummy model depending on the application. The takeaway is that dummy models allow us to assess how more complex models perform with respect to some baselines and help us to detect possible problems in the data and features. What I typically do when solving a problem is to start with simple models and/or rules and then, try more complex models. Of course, manual thresholds and simple rules can work remarkably well in some situations but they are not scalable. Depending on the use case, one can just implement the simple solution or go for something more complex if the system is expected to grow or be used in more general ways.</p>
</div>
</div>
<div id="summaryClassification" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Summary</h2>
<p>This chapter focused on <strong>classification</strong> models. Classifiers predict a category based on the input features. Here, it was demonstrated how classifiers can be used to detect indoor locations, classify activities, and had gestures.</p>
<ul>
<li><strong><span class="math inline">\(k\)</span>-nearest neighbors (<span class="math inline">\(k\)</span>-NN)</strong> predicts the class of a test point as the majority class of the <span class="math inline">\(k\)</span> nearest neighbors.</li>
<li>Some classification performance metrics are <strong>recall</strong>, <strong>specificity</strong>, <strong>precision</strong>, <strong>accuracy</strong>, <strong>F1-score</strong>, etc.</li>
<li><strong>Decision trees</strong> are easy-to-interpret classifiers trained recursively based on feature importance (for example, purity).</li>
<li><strong>Naive Bayes</strong> is a type of classifier where features are assumed to be independent.</li>
<li><strong>Dynamic Time Warping (DTW)</strong> computes the similarity between two timeseries after ‘aligning’ them in time. This can be used for classification for example, in combination with <span class="math inline">\(k\)</span>-NN.</li>
<li><strong>Dummy models</strong> can help to spot possible errors in the data and can also be used as baselines.</li>
</ul>
<p><img src="images/comic_dtw.png" width="100%" style="display: block; margin: auto;" />
</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-anzulewicz2016toward" class="csl-entry">
Anzulewicz, Anna, Krzysztof Sobota, and Jonathan T Delafield-Butt. 2016. <span>“Toward the Autism Motor Signature: Gesture Patterns During Smart Tablet Gameplay Identify Children with Autism.”</span> <em>Scientific Reports</em> 6 (1): 1–13.
</div>
<div id="ref-de2006towards" class="csl-entry">
De Gelder, Beatrice. 2006. <span>“Towards the Neurobiology of Emotional Body Language.”</span> <em>Nature Reviews Neuroscience</em> 7 (3): 242–49.
</div>
<div id="ref-giorgino2009" class="csl-entry">
Giorgino, Toni. 2009. <span>“Computing and Visualizing Dynamic Time Warping Alignments in r: The <span class="nocase">dtw</span> Package.”</span> <em>Journal of Statistical Software</em> 31 (7): 1–24.
</div>
<div id="ref-kwapisz2010" class="csl-entry">
Kwapisz, Jennifer R., Gary M. Weiss, and Samuel A. Moore. 2010. <span>“Activity Recognition Using Cell Phone Accelerometers.”</span> In <em>Proceedings of the Fourth International Workshop on Knowledge Discovery from Sensor Data (at <span>KDD</span>-10), Washington <span>DC</span>.</em>
</div>
<div id="ref-e1071" class="csl-entry">
Meyer, David, Evgenia Dimitriadou, Kurt Hornik, Andreas Weingessel, and Friedrich Leisch. 2019. <em>E1071: Misc Functions of the Department of Statistics, Probability Theory Group (Formerly: E1071), TU Wien</em>. <a href="https://CRAN.R-project.org/package=e1071">https://CRAN.R-project.org/package=e1071</a>.
</div>
<div id="ref-rpartplot" class="csl-entry">
Milborrow, Stephen. 2019. <em>Rpart.plot: Plot ’Rpart’ Models: An Enhanced Version of ’<span class="nocase">plot.rpart</span>’</em>. <a href="https://CRAN.R-project.org/package=rpart.plot">https://CRAN.R-project.org/package=rpart.plot</a>.
</div>
<div id="ref-quinlan2014" class="csl-entry">
Quinlan, J Ross. 2014. <em>C4.5: Programs for Machine Learning</em>. Elsevier.
</div>
<div id="ref-Rabiner1993" class="csl-entry">
Rabiner, Lawrence, and Biing-Hwang Juang. 1993. <em>Fundamentals of Speech Recognition</em>. Prentice hall.
</div>
<div id="ref-sakoe1990dynamic" class="csl-entry">
Sakoe, Hiroaki, Seibi Chiba, A Waibel, and KF Lee. 1990. <span>“Dynamic Programming Algorithm Optimization for Spoken Word Recognition.”</span> <em>Readings in Speech Recognition</em> 159: 224.
</div>
<div id="ref-steinberg2009" class="csl-entry">
Steinberg, Dan, and Phillip Colla. 2009. <span>“CART: Classification and Regression Trees.”</span> <em>The Top Ten Algorithms in Data Mining</em> 9: 179.
</div>
<div id="ref-rpart" class="csl-entry">
Therneau, Terry, and Beth Atkinson. 2019. <em>Rpart: Recursive Partitioning and Regression Trees</em>. <a href="https://CRAN.R-project.org/package=rpart">https://CRAN.R-project.org/package=rpart</a>.
</div>
<div id="ref-xi2006" class="csl-entry">
Xi, Xiaopeng, Eamonn Keogh, Christian Shelton, Li Wei, and Chotirat Ann Ratanamahatana. 2006. <span>“Fast Time Series Classification Using Numerosity Reduction.”</span> In <em>Proceedings of the 23rd International Conference on Machine Learning</em>, 1033–40.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p><a href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm" class="uri">https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm</a><a href="classification.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p><a href="http://www.cis.fordham.edu/wisdm/dataset.php" class="uri">http://www.cis.fordham.edu/wisdm/dataset.php</a><a href="classification.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p><a href="https://commons.wikimedia.org/wiki/File:Anscombe%27s_quartet_3.svg" class="uri">https://commons.wikimedia.org/wiki/File:Anscombe%27s_quartet_3.svg</a><a href="classification.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ensemble.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
