<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Multi-User Validation | Behavior Analysis with Machine Learning and R</title>
  <meta name="description" content="Chapter 9 Multi-User Validation | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors and stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Multi-User Validation | Behavior Analysis with Machine Learning and R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="Chapter 9 Multi-User Validation | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors and stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Multi-User Validation | Behavior Analysis with Machine Learning and R" />
  
  <meta name="twitter:description" content="Chapter 9 Multi-User Validation | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors and stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Enrique Garcia Ceja" />


<meta name="date" content="2020-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="deeplearning.html"/>
<link rel="next" href="appendixInstall.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/d3-4.9.0/d3.min.js"></script>
<script src="libs/d3-tip-0.7.1/index-min.js"></script>
<link href="libs/d3panels-1.4.9/d3panels.min.css" rel="stylesheet" />
<script src="libs/d3panels-1.4.9/d3panels.min.js"></script>
<script src="libs/qtlcharts_iplotCorr-0.11.6/iplotCorr.js"></script>
<script src="libs/qtlcharts_iplotCorr-0.11.6/iplotCorr_noscat.js"></script>
<script src="libs/iplotCorr-binding-0.11.6/iplotCorr.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-178679335-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178679335-1', { 'anonymize_ip': true });
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="#">Behavior Analysis with Machine Learning and R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#supplemental-material"><i class="fa fa-check"></i>Supplemental Material</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-is-machine-learning"><i class="fa fa-check"></i><b>1.1</b> What is Machine Learning?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#taxonomy"><i class="fa fa-check"></i><b>1.2</b> Types of Machine Learning</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#tables"><i class="fa fa-check"></i><b>1.3.1</b> Tables</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#variable-types"><i class="fa fa-check"></i><b>1.3.2</b> Variable Types</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#predictive-models"><i class="fa fa-check"></i><b>1.3.3</b> Predictive Models</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#pipeline"><i class="fa fa-check"></i><b>1.4</b> Data Analysis Pipeline</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#trainingeval"><i class="fa fa-check"></i><b>1.5</b> Evaluating Predictive Models</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#simple-classification-example"><i class="fa fa-check"></i><b>1.6</b> Simple Classification Example</a><ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#k-fold-cross-validation-example"><i class="fa fa-check"></i><b>1.6.1</b> K-fold Cross-Validation Example</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#simple-regression-example"><i class="fa fa-check"></i><b>1.7</b> Simple Regression Example</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#underfitting-and-overfitting"><i class="fa fa-check"></i><b>1.8</b> Underfitting and Overfitting</a></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#bias-and-variance"><i class="fa fa-check"></i><b>1.9</b> Bias and Variance</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#SummaryIntro"><i class="fa fa-check"></i><b>1.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>2</b> Predicting Behavior with Classification Models</a><ul>
<li class="chapter" data-level="2.1" data-path="classification.html"><a href="classification.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>2.1</b> <em>k</em>-nearest Neighbors</a><ul>
<li class="chapter" data-level="2.1.1" data-path="classification.html"><a href="classification.html#indoor-location-with-wi-fi-signals"><i class="fa fa-check"></i><b>2.1.1</b> Indoor Location with Wi-Fi Signals</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="classification.html"><a href="classification.html#performance-metrics"><i class="fa fa-check"></i><b>2.2</b> Performance Metrics</a></li>
<li class="chapter" data-level="2.3" data-path="classification.html"><a href="classification.html#decision-trees"><i class="fa fa-check"></i><b>2.3</b> Decision Trees</a><ul>
<li class="chapter" data-level="2.3.1" data-path="classification.html"><a href="classification.html#activityRecognition"><i class="fa fa-check"></i><b>2.3.1</b> Activity Recognition with Smartphones</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="classification.html"><a href="classification.html#naive-bayes"><i class="fa fa-check"></i><b>2.4</b> Naive Bayes</a><ul>
<li class="chapter" data-level="2.4.1" data-path="classification.html"><a href="classification.html#activity-recognition-with-naive-bayes"><i class="fa fa-check"></i><b>2.4.1</b> Activity Recognition with Naive Bayes</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="classification.html"><a href="classification.html#dynamic-time-warping"><i class="fa fa-check"></i><b>2.5</b> Dynamic Time Warping</a><ul>
<li class="chapter" data-level="2.5.1" data-path="classification.html"><a href="classification.html#sechandgestures"><i class="fa fa-check"></i><b>2.5.1</b> Hand Gesture Recognition</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="classification.html"><a href="classification.html#dummy-models"><i class="fa fa-check"></i><b>2.6</b> Dummy Models</a><ul>
<li class="chapter" data-level="2.6.1" data-path="classification.html"><a href="classification.html#most-frequent-class-classifier"><i class="fa fa-check"></i><b>2.6.1</b> Most-frequent-class Classifier</a></li>
<li class="chapter" data-level="2.6.2" data-path="classification.html"><a href="classification.html#uniform-classifier"><i class="fa fa-check"></i><b>2.6.2</b> Uniform Classifier</a></li>
<li class="chapter" data-level="2.6.3" data-path="classification.html"><a href="classification.html#frequency-based-classifier"><i class="fa fa-check"></i><b>2.6.3</b> Frequency-based Classifier</a></li>
<li class="chapter" data-level="2.6.4" data-path="classification.html"><a href="classification.html#other-dummy-classifiers"><i class="fa fa-check"></i><b>2.6.4</b> Other Dummy Classifiers</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="classification.html"><a href="classification.html#summaryClassification"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ensemble.html"><a href="ensemble.html"><i class="fa fa-check"></i><b>3</b> Predicting Behavior with Ensemble Learning</a><ul>
<li class="chapter" data-level="3.1" data-path="ensemble.html"><a href="ensemble.html#bagging"><i class="fa fa-check"></i><b>3.1</b> Bagging</a><ul>
<li class="chapter" data-level="3.1.1" data-path="ensemble.html"><a href="ensemble.html#activity-recognition-with-bagging"><i class="fa fa-check"></i><b>3.1.1</b> Activity recognition with Bagging</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ensemble.html"><a href="ensemble.html#random-forest"><i class="fa fa-check"></i><b>3.2</b> Random Forest</a></li>
<li class="chapter" data-level="3.3" data-path="ensemble.html"><a href="ensemble.html#stacked-generalization"><i class="fa fa-check"></i><b>3.3</b> Stacked Generalization</a></li>
<li class="chapter" data-level="3.4" data-path="ensemble.html"><a href="ensemble.html#multiviewhometasks"><i class="fa fa-check"></i><b>3.4</b> Multi-view Stacking for Home Tasks Recognition</a></li>
<li class="chapter" data-level="3.5" data-path="ensemble.html"><a href="ensemble.html#SummaryEnsemble"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="edavis.html"><a href="edavis.html"><i class="fa fa-check"></i><b>4</b> Exploring and Visualizing Behavioral Data</a><ul>
<li class="chapter" data-level="4.1" data-path="edavis.html"><a href="edavis.html#talking-with-field-experts"><i class="fa fa-check"></i><b>4.1</b> Talking with Field Experts</a></li>
<li class="chapter" data-level="4.2" data-path="edavis.html"><a href="edavis.html#summary-statistics"><i class="fa fa-check"></i><b>4.2</b> Summary Statistics</a></li>
<li class="chapter" data-level="4.3" data-path="edavis.html"><a href="edavis.html#class-distributions"><i class="fa fa-check"></i><b>4.3</b> Class Distributions</a></li>
<li class="chapter" data-level="4.4" data-path="edavis.html"><a href="edavis.html#user-class-sparsity-matrix"><i class="fa fa-check"></i><b>4.4</b> User-Class Sparsity Matrix</a></li>
<li class="chapter" data-level="4.5" data-path="edavis.html"><a href="edavis.html#boxplots"><i class="fa fa-check"></i><b>4.5</b> Boxplots</a></li>
<li class="chapter" data-level="4.6" data-path="edavis.html"><a href="edavis.html#correlation-plots"><i class="fa fa-check"></i><b>4.6</b> Correlation Plots</a><ul>
<li class="chapter" data-level="4.6.1" data-path="edavis.html"><a href="edavis.html#interactive-correlation-plots"><i class="fa fa-check"></i><b>4.6.1</b> Interactive Correlation Plots</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="edavis.html"><a href="edavis.html#timeseries"><i class="fa fa-check"></i><b>4.7</b> Timeseries</a><ul>
<li class="chapter" data-level="4.7.1" data-path="edavis.html"><a href="edavis.html#interactive-timeseries"><i class="fa fa-check"></i><b>4.7.1</b> Interactive Timeseries</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="edavis.html"><a href="edavis.html#multidimensional-scaling-mds"><i class="fa fa-check"></i><b>4.8</b> Multidimensional Scaling (MDS)</a></li>
<li class="chapter" data-level="4.9" data-path="edavis.html"><a href="edavis.html#heatmaps"><i class="fa fa-check"></i><b>4.9</b> Heatmaps</a></li>
<li class="chapter" data-level="4.10" data-path="edavis.html"><a href="edavis.html#automated-eda"><i class="fa fa-check"></i><b>4.10</b> Automated EDA</a></li>
<li class="chapter" data-level="4.11" data-path="edavis.html"><a href="edavis.html#SummaryExploratory"><i class="fa fa-check"></i><b>4.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i><b>5</b> Preprocessing Behavioral Data</a><ul>
<li class="chapter" data-level="5.1" data-path="preprocessing.html"><a href="preprocessing.html#missing-values"><i class="fa fa-check"></i><b>5.1</b> Missing Values</a><ul>
<li class="chapter" data-level="5.1.1" data-path="preprocessing.html"><a href="preprocessing.html#imputation"><i class="fa fa-check"></i><b>5.1.1</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="preprocessing.html"><a href="preprocessing.html#smoothing"><i class="fa fa-check"></i><b>5.2</b> Smoothing</a></li>
<li class="chapter" data-level="5.3" data-path="preprocessing.html"><a href="preprocessing.html#normalization"><i class="fa fa-check"></i><b>5.3</b> Normalization</a></li>
<li class="chapter" data-level="5.4" data-path="preprocessing.html"><a href="preprocessing.html#imbalanced-classes"><i class="fa fa-check"></i><b>5.4</b> Imbalanced Classes</a><ul>
<li class="chapter" data-level="5.4.1" data-path="preprocessing.html"><a href="preprocessing.html#random-oversampling"><i class="fa fa-check"></i><b>5.4.1</b> Random Oversampling</a></li>
<li class="chapter" data-level="5.4.2" data-path="preprocessing.html"><a href="preprocessing.html#smote"><i class="fa fa-check"></i><b>5.4.2</b> SMOTE</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="preprocessing.html"><a href="preprocessing.html#infoinjection"><i class="fa fa-check"></i><b>5.5</b> Information Injection</a></li>
<li class="chapter" data-level="5.6" data-path="preprocessing.html"><a href="preprocessing.html#one-hot-encoding"><i class="fa fa-check"></i><b>5.6</b> One-hot Encoding</a></li>
<li class="chapter" data-level="5.7" data-path="preprocessing.html"><a href="preprocessing.html#SummaryPreprocessing"><i class="fa fa-check"></i><b>5.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unsupervised.html"><a href="unsupervised.html"><i class="fa fa-check"></i><b>6</b> Discovering Behaviors with Unsupervised Learning</a><ul>
<li class="chapter" data-level="6.1" data-path="unsupervised.html"><a href="unsupervised.html#k-means-clustering"><i class="fa fa-check"></i><b>6.1</b> K-means clustering</a><ul>
<li class="chapter" data-level="6.1.1" data-path="unsupervised.html"><a href="unsupervised.html#studentresponses"><i class="fa fa-check"></i><b>6.1.1</b> Grouping Student Responses</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="unsupervised.html"><a href="unsupervised.html#the-silhouette-index"><i class="fa fa-check"></i><b>6.2</b> The Silhouette Index</a></li>
<li class="chapter" data-level="6.3" data-path="unsupervised.html"><a href="unsupervised.html#associationrules"><i class="fa fa-check"></i><b>6.3</b> Mining Association Rules</a><ul>
<li class="chapter" data-level="6.3.1" data-path="unsupervised.html"><a href="unsupervised.html#finding-rules-for-criminal-behavior"><i class="fa fa-check"></i><b>6.3.1</b> Finding Rules for Criminal Behavior</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="unsupervised.html"><a href="unsupervised.html#SummaryUnsupervised"><i class="fa fa-check"></i><b>6.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="representations.html"><a href="representations.html"><i class="fa fa-check"></i><b>7</b> Encoding Behavioral Data</a><ul>
<li class="chapter" data-level="7.1" data-path="representations.html"><a href="representations.html#feature-vectors"><i class="fa fa-check"></i><b>7.1</b> Feature Vectors</a></li>
<li class="chapter" data-level="7.2" data-path="representations.html"><a href="representations.html#sectimeseries"><i class="fa fa-check"></i><b>7.2</b> Timeseries</a></li>
<li class="chapter" data-level="7.3" data-path="representations.html"><a href="representations.html#transactions"><i class="fa fa-check"></i><b>7.3</b> Transactions</a></li>
<li class="chapter" data-level="7.4" data-path="representations.html"><a href="representations.html#images"><i class="fa fa-check"></i><b>7.4</b> Images</a></li>
<li class="chapter" data-level="7.5" data-path="representations.html"><a href="representations.html#recurrence-plots"><i class="fa fa-check"></i><b>7.5</b> Recurrence Plots</a><ul>
<li class="chapter" data-level="7.5.1" data-path="representations.html"><a href="representations.html#computing-recurence-plots"><i class="fa fa-check"></i><b>7.5.1</b> Computing Recurence Plots</a></li>
<li class="chapter" data-level="7.5.2" data-path="representations.html"><a href="representations.html#recurrence-plots-of-hand-gestures"><i class="fa fa-check"></i><b>7.5.2</b> Recurrence Plots of Hand Gestures</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="representations.html"><a href="representations.html#bag-of-words"><i class="fa fa-check"></i><b>7.6</b> Bag-of-Words</a><ul>
<li class="chapter" data-level="7.6.1" data-path="representations.html"><a href="representations.html#bow-for-complex-activities."><i class="fa fa-check"></i><b>7.6.1</b> BoW for Complex Activities.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="representations.html"><a href="representations.html#graphs"><i class="fa fa-check"></i><b>7.7</b> Graphs</a><ul>
<li class="chapter" data-level="7.7.1" data-path="representations.html"><a href="representations.html#complex-activities-as-graphs"><i class="fa fa-check"></i><b>7.7.1</b> Complex Activities as Graphs</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="representations.html"><a href="representations.html#SummaryRepresentations"><i class="fa fa-check"></i><b>7.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="deeplearning.html"><a href="deeplearning.html"><i class="fa fa-check"></i><b>8</b> Predicting Behavior with Deep Learning</a><ul>
<li class="chapter" data-level="8.1" data-path="deeplearning.html"><a href="deeplearning.html#ann"><i class="fa fa-check"></i><b>8.1</b> Introduction to Artificial Neural Networks</a><ul>
<li class="chapter" data-level="8.1.1" data-path="deeplearning.html"><a href="deeplearning.html#sigmoid-and-relu-units"><i class="fa fa-check"></i><b>8.1.1</b> Sigmoid and ReLU Units</a></li>
<li class="chapter" data-level="8.1.2" data-path="deeplearning.html"><a href="deeplearning.html#assembling-units-into-layers"><i class="fa fa-check"></i><b>8.1.2</b> Assembling Units into Layers</a></li>
<li class="chapter" data-level="8.1.3" data-path="deeplearning.html"><a href="deeplearning.html#deep-neural-networks"><i class="fa fa-check"></i><b>8.1.3</b> Deep Neural Networks</a></li>
<li class="chapter" data-level="8.1.4" data-path="deeplearning.html"><a href="deeplearning.html#learning-the-parameters"><i class="fa fa-check"></i><b>8.1.4</b> Learning the Parameters</a></li>
<li class="chapter" data-level="8.1.5" data-path="deeplearning.html"><a href="deeplearning.html#parameter-learning-example-in-r"><i class="fa fa-check"></i><b>8.1.5</b> Parameter Learning Example in R</a></li>
<li class="chapter" data-level="8.1.6" data-path="deeplearning.html"><a href="deeplearning.html#stochastic-gradient-descent"><i class="fa fa-check"></i><b>8.1.6</b> Stochastic Gradient Descent</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="deeplearning.html"><a href="deeplearning.html#keras-and-tensorflow-with-r"><i class="fa fa-check"></i><b>8.2</b> Keras and TensorFlow with R</a><ul>
<li class="chapter" data-level="8.2.1" data-path="deeplearning.html"><a href="deeplearning.html#keras-example"><i class="fa fa-check"></i><b>8.2.1</b> Keras Example</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="deeplearning.html"><a href="deeplearning.html#classification-with-neural-networks"><i class="fa fa-check"></i><b>8.3</b> Classification with Neural Networks</a><ul>
<li class="chapter" data-level="8.3.1" data-path="deeplearning.html"><a href="deeplearning.html#classification-of-electromyography-signals"><i class="fa fa-check"></i><b>8.3.1</b> Classification of Electromyography Signals</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="deeplearning.html"><a href="deeplearning.html#overfitting"><i class="fa fa-check"></i><b>8.4</b> Overfitting</a><ul>
<li class="chapter" data-level="8.4.1" data-path="deeplearning.html"><a href="deeplearning.html#early-stopping"><i class="fa fa-check"></i><b>8.4.1</b> Early Stopping</a></li>
<li class="chapter" data-level="8.4.2" data-path="deeplearning.html"><a href="deeplearning.html#dropout"><i class="fa fa-check"></i><b>8.4.2</b> Dropout</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="deeplearning.html"><a href="deeplearning.html#fine-tuning-a-neural-network"><i class="fa fa-check"></i><b>8.5</b> Fine-Tuning a Neural Network</a></li>
<li class="chapter" data-level="8.6" data-path="deeplearning.html"><a href="deeplearning.html#cnns"><i class="fa fa-check"></i><b>8.6</b> Convolutional Neural Networks</a><ul>
<li class="chapter" data-level="8.6.1" data-path="deeplearning.html"><a href="deeplearning.html#convolutions"><i class="fa fa-check"></i><b>8.6.1</b> Convolutions</a></li>
<li class="chapter" data-level="8.6.2" data-path="deeplearning.html"><a href="deeplearning.html#pooling-operations"><i class="fa fa-check"></i><b>8.6.2</b> Pooling Operations</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="deeplearning.html"><a href="deeplearning.html#cnns-with-keras"><i class="fa fa-check"></i><b>8.7</b> CNNs with Keras</a><ul>
<li class="chapter" data-level="8.7.1" data-path="deeplearning.html"><a href="deeplearning.html#example-1"><i class="fa fa-check"></i><b>8.7.1</b> Example 1</a></li>
<li class="chapter" data-level="8.7.2" data-path="deeplearning.html"><a href="deeplearning.html#example-2"><i class="fa fa-check"></i><b>8.7.2</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="deeplearning.html"><a href="deeplearning.html#cnnSmile"><i class="fa fa-check"></i><b>8.8</b> Smiles Detection with a CNN</a></li>
<li class="chapter" data-level="8.9" data-path="deeplearning.html"><a href="deeplearning.html#SummaryDeepLearning"><i class="fa fa-check"></i><b>8.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="multiuser.html"><a href="multiuser.html"><i class="fa fa-check"></i><b>9</b> Multi-User Validation</a><ul>
<li class="chapter" data-level="9.1" data-path="multiuser.html"><a href="multiuser.html#mixed-models"><i class="fa fa-check"></i><b>9.1</b> Mixed Models</a><ul>
<li class="chapter" data-level="9.1.1" data-path="multiuser.html"><a href="multiuser.html#skeleton-action-recognition-with-mixed-models"><i class="fa fa-check"></i><b>9.1.1</b> Skeleton Action Recognition with Mixed Models</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="multiuser.html"><a href="multiuser.html#user-independent-models"><i class="fa fa-check"></i><b>9.2</b> User-Independent Models</a></li>
<li class="chapter" data-level="9.3" data-path="multiuser.html"><a href="multiuser.html#user-dependent-models"><i class="fa fa-check"></i><b>9.3</b> User-Dependent Models</a></li>
<li class="chapter" data-level="9.4" data-path="multiuser.html"><a href="multiuser.html#user-adaptive-models"><i class="fa fa-check"></i><b>9.4</b> User-Adaptive Models</a><ul>
<li class="chapter" data-level="9.4.1" data-path="multiuser.html"><a href="multiuser.html#transfer-learning"><i class="fa fa-check"></i><b>9.4.1</b> Transfer Learning</a></li>
<li class="chapter" data-level="9.4.2" data-path="multiuser.html"><a href="multiuser.html#a-user-adaptive-model-for-activity-recognition"><i class="fa fa-check"></i><b>9.4.2</b> A User-Adaptive Model for Activity Recognition</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="multiuser.html"><a href="multiuser.html#SummaryMultiUser"><i class="fa fa-check"></i><b>9.5</b> Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendixInstall.html"><a href="appendixInstall.html"><i class="fa fa-check"></i><b>A</b> Setup Your Environment</a><ul>
<li class="chapter" data-level="A.1" data-path="appendixInstall.html"><a href="appendixInstall.html#installing-the-datasets"><i class="fa fa-check"></i><b>A.1</b> Installing the Datasets</a></li>
<li class="chapter" data-level="A.2" data-path="appendixInstall.html"><a href="appendixInstall.html#installing-the-examples-source-code"><i class="fa fa-check"></i><b>A.2</b> Installing the Examples Source Code</a></li>
<li class="chapter" data-level="A.3" data-path="appendixInstall.html"><a href="appendixInstall.html#running-shiny-apps"><i class="fa fa-check"></i><b>A.3</b> Running Shiny Apps</a></li>
<li class="chapter" data-level="A.4" data-path="appendixInstall.html"><a href="appendixInstall.html#installing-keras-and-tensorflow"><i class="fa fa-check"></i><b>A.4</b> Installing Keras and TensorFlow</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendixDatasets.html"><a href="appendixDatasets.html"><i class="fa fa-check"></i><b>B</b> Datasets</a><ul>
<li class="chapter" data-level="B.1" data-path="appendixDatasets.html"><a href="appendixDatasets.html#complex-activities"><i class="fa fa-check"></i><b>B.1</b> COMPLEX ACTIVITIES</a></li>
<li class="chapter" data-level="B.2" data-path="appendixDatasets.html"><a href="appendixDatasets.html#depresjon"><i class="fa fa-check"></i><b>B.2</b> DEPRESJON</a></li>
<li class="chapter" data-level="B.3" data-path="appendixDatasets.html"><a href="appendixDatasets.html#electromyography"><i class="fa fa-check"></i><b>B.3</b> ELECTROMYOGRAPHY</a></li>
<li class="chapter" data-level="B.4" data-path="appendixDatasets.html"><a href="appendixDatasets.html#hand-gestures"><i class="fa fa-check"></i><b>B.4</b> HAND GESTURES</a></li>
<li class="chapter" data-level="B.5" data-path="appendixDatasets.html"><a href="appendixDatasets.html#home-tasks"><i class="fa fa-check"></i><b>B.5</b> HOME TASKS</a></li>
<li class="chapter" data-level="B.6" data-path="appendixDatasets.html"><a href="appendixDatasets.html#homicide-reports"><i class="fa fa-check"></i><b>B.6</b> HOMICIDE REPORTS</a></li>
<li class="chapter" data-level="B.7" data-path="appendixDatasets.html"><a href="appendixDatasets.html#indoor-location"><i class="fa fa-check"></i><b>B.7</b> INDOOR LOCATION</a></li>
<li class="chapter" data-level="B.8" data-path="appendixDatasets.html"><a href="appendixDatasets.html#sheep-goats"><i class="fa fa-check"></i><b>B.8</b> SHEEP GOATS</a></li>
<li class="chapter" data-level="B.9" data-path="appendixDatasets.html"><a href="appendixDatasets.html#skeleton-actions"><i class="fa fa-check"></i><b>B.9</b> SKELETON ACTIONS</a></li>
<li class="chapter" data-level="B.10" data-path="appendixDatasets.html"><a href="appendixDatasets.html#smartphone-activities"><i class="fa fa-check"></i><b>B.10</b> SMARTPHONE ACTIVITIES</a></li>
<li class="chapter" data-level="B.11" data-path="appendixDatasets.html"><a href="appendixDatasets.html#smiles"><i class="fa fa-check"></i><b>B.11</b> SMILES</a></li>
<li class="chapter" data-level="B.12" data-path="appendixDatasets.html"><a href="appendixDatasets.html#students-mental-health"><i class="fa fa-check"></i><b>B.12</b> STUDENTS’ MENTAL HEALTH</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="citing-this-book.html"><a href="citing-this-book.html"><i class="fa fa-check"></i>Citing this Book</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Behavior Analysis with Machine Learning and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multiuser" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Multi-User Validation</h1>
<p>Every person is different. We all have different physical and mental characteristics. Every person reacts in different ways to the same stimulus and conducts physical and motor activities in particular ways. As we have seen, predictive models rely on the training data; and for user-oriented applications, this data encodes their behaviors. When building predictive models, we want them to be general and to perform accurately on new unseen instances. Sometimes this generalization capability comes at a price, especially in <strong>multi-user settings</strong>. A multi-user setting is one in which the results depend heavily on the <strong>target user</strong>, that is, the user on which the predictions are made. Take, for example, a hand gesture recognition system. At inference time, a specific person (the target user) performs a gesture and the system should recognize it. The input data comes directly from the user. On the other hand, a <strong>non-multi-user</strong> system does not depend on a particular person. A classifier that labels fruits on images or a regression model that predicts house prices does not depend directly on a particular person.</p>
<p>Some time ago I had to build an activity recognition system based on inertial data from a wrist band. So I collected the data, trained the models, and evaluated them. The performance results were good. However, it turned out that when the system was tested on a new sample group it failed. The reason? The training data was collected from people within a particular age group (young) but the target market of the product was for much older people. Older people tend to walk more slowly, thus, the system was predicting <em>‘no movement’</em> when in fact, the person was walking at a very slow pace. This is an extreme example but even within the same age groups, there are going to be differences between users (<em>inter-user variance</em>). Or even the same user will evolve over time and will change her/his behaviors (<em>intra-user variance</em>).</p>
<p>So, how can we evaluate multi-user systems to reduce the unexpected effects once the system is deployed? Most of the time there’s going to be surprises when testing a system on new users so we need to be aware of that. But in this chapter, I will present <span class="math inline">\(3\)</span> types of models that will help you to reduce that uncertainty to some extent so you will have a better idea of how the system will behave when tested on more realistic conditions. The models are: <strong>mixed models</strong>, <strong>user-independent models</strong>, and <strong>user-dependent models</strong>. We will see how to train each type of model using a database with actions recorded with a motion capture system. After that, I will also show you how to build <strong>adaptive models</strong> that are tuned with the objective of increasing their performance for a particular user.</p>
<div id="mixed-models" class="section level2">
<h2><span class="header-section-number">9.1</span> Mixed Models</h2>
<p>Mixed models are trained and validated as usual without considering information about mappings between data points and users. Suppose we have a dataset as shown in Figure <a href="multiuser.html#fig:tblMixModel">9.1</a>. The first column is the user id, the second column the label we want to predict and the last two columns are two arbitrary features.</p>
<div class="figure" style="text-align: center"><span id="fig:tblMixModel"></span>
<img src="images/table_mix_model.png" alt="Example dataset with a binary label and 2 features." width="30%" />
<p class="caption">
Figure 9.1: Example dataset with a binary label and 2 features.
</p>
</div>
<p>With a mixed model we would just remove the <em>userid</em> column and perform <span class="math inline">\(k\)</span>-fold cross-validation or hold-out validation as usual. In fact, this is what we have been doing so far. By doing so, some random data points will end up in the train set and others in the test set regardless of which data point was generated by which user. The user rows are just <em>mixed</em>, thus the <em>mixed model</em> name. This model assumes that the data was generated by a single user. One of the disadvantages of validating a system using a mixed model is that the performance results could be overestimated. When randomly splitting into train and test sets, some data points for a given user will end up in each of the splits. At inference time, when showing a test sample belonging to a particular user to the model, it is likely that the training set of that model included some data from that particular user. Thus, the model already knows a little bit about that user so we can expect an accurate prediction. However, this assumption not always holds true. If the model is to be used on a <strong>new user</strong> that the model has never seen before, then, it may not produce very accurate predictions.</p>
<p><strong>When should a mixed model be used to validate a system?</strong></p>
<ol style="list-style-type: decimal">
<li>When you know that you will have some available data to train the model for all the users that are intended to use the system.</li>
<li>In many cases, a dataset has already missing information about the mapping between rows and users. That is, a <em>userid</em> column is not present. In those cases, the best performance estimation would be through the use of a mixed model.</li>
</ol>
<p>To demonstrate the differences between the different types of models (mixed, user-independent, and user-dependent) I will use the <em>SKELETON ACTIONS</em> dataset. First, a brief description of the dataset is presented including details about how the features were extracted. Then, the dataset is used to train a mixed model and in the following subsections, it is used to train user-independent and user-dependent models.</p>
<div id="skeleton-action-recognition-with-mixed-models" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Skeleton Action Recognition with Mixed Models</h3>

<div class="rmdfolder">
<code>preprocess_skeleton_actions.R</code> <code>classify_skeleton_actions.R</code>
</div>

<p>To demonstrate the <span class="math inline">\(3\)</span> different types of models I chose the <strong>UTD-MHAD dataset</strong> <span class="citation">(Chen, Jafari, and Kehtarnavaz <a href="#ref-chen2015utd" role="doc-biblioref">2015</a>)</span> and from now on, I will refer to it as the <em>SKELETON ACTIONS</em> dataset. This database is suitable because it was collected by <span class="math inline">\(8\)</span> persons (<span class="math inline">\(4\)</span> females/<span class="math inline">\(4\)</span> males) and each file has a subject id, thus, we know which actions were collected by which users. The number of actions is <span class="math inline">\(27\)</span> and some of the actions are: <em>‘right-hand wave’</em>, <em>‘two hand front clap’</em>, <em>‘basketball shoot’</em>, <em>‘front boxing’</em>, etc.</p>
<p>The data was recorded using a Kinect camera and an inertial sensor unit and each subject repeated each of the <span class="math inline">\(27\)</span> actions <span class="math inline">\(4\)</span> times. More information about the collection process and pictures can be consulted on the original dataset website <a href="https://personal.utdallas.edu/~kehtar/UTD-MHAD.html" class="uri">https://personal.utdallas.edu/~kehtar/UTD-MHAD.html</a>.</p>
<p>For our examples, I will only focus on the <em>skeleton data</em> generated by the Kinect camera. These data consists of human body joints (<span class="math inline">\(20\)</span> joints). Each file contains one action for one user and one repetition. The file names have the structure <code>aA_sS_tT_skeleton.mat</code>. The <code>A</code> is the action id, the <code>S</code> is the subject id and the <code>T</code> is the trial (repetition) number. For each time frame, the <span class="math inline">\(3\)</span>D positions of the <span class="math inline">\(20\)</span> joints are recorded.</p>
<p>The script <code>preprocess_skeleton_actions.R</code> shows how to read the files and plot the actions. The files are stored in Matlab format. The library <code>R.matlab</code> <span class="citation">(Bengtsson <a href="#ref-rmatlab" role="doc-biblioref">2018</a>)</span> can be used to read the files.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="multiuser.html#cb192-1"></a><span class="co"># Path to one of the files.</span></span>
<span id="cb192-2"><a href="multiuser.html#cb192-2"></a>filepath &lt;-<span class="st"> &quot;/skeleton_actions/a7_s1_t1_skeleton.mat&quot;</span></span>
<span id="cb192-3"><a href="multiuser.html#cb192-3"></a></span>
<span id="cb192-4"><a href="multiuser.html#cb192-4"></a><span class="co"># Read skeleton file.</span></span>
<span id="cb192-5"><a href="multiuser.html#cb192-5"></a>df &lt;-<span class="st"> </span><span class="kw">readMat</span>(filepath)<span class="op">$</span>d.skel</span>
<span id="cb192-6"><a href="multiuser.html#cb192-6"></a></span>
<span id="cb192-7"><a href="multiuser.html#cb192-7"></a><span class="co"># Print dimensions.</span></span>
<span id="cb192-8"><a href="multiuser.html#cb192-8"></a><span class="kw">dim</span>(df)</span>
<span id="cb192-9"><a href="multiuser.html#cb192-9"></a><span class="co">#&gt; [1] 20  3 66</span></span></code></pre></div>
<p>From the file name, we can see that this corresponds to action <span class="math inline">\(7\)</span> (basketball shoot), from subject <span class="math inline">\(1\)</span> and trial <span class="math inline">\(1\)</span>. The <code>readMat()</code> function is used to read the file contents and store them as a <span class="math inline">\(3\)</span>D array in <code>df</code>. If we print the dimensions we see that the first one corresponds to the number of joints, the second one are the positions (<em>x</em>, <em>y</em>, <em>z</em>), and the last dimension is the number of frames, in this case <span class="math inline">\(66\)</span> frames.</p>
<p>We can extract the first time-frame as follows:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="multiuser.html#cb193-1"></a><span class="co"># Select the first frame.</span></span>
<span id="cb193-2"><a href="multiuser.html#cb193-2"></a>frame &lt;-<span class="st"> </span><span class="kw">data.frame</span>(df[, , <span class="dv">1</span>])</span>
<span id="cb193-3"><a href="multiuser.html#cb193-3"></a></span>
<span id="cb193-4"><a href="multiuser.html#cb193-4"></a><span class="co"># Print dimensions.</span></span>
<span id="cb193-5"><a href="multiuser.html#cb193-5"></a><span class="kw">dim</span>(frame)</span>
<span id="cb193-6"><a href="multiuser.html#cb193-6"></a><span class="co">#&gt; [1] 20  3</span></span></code></pre></div>
<p>Each frame can then be plotted. The plotting code is included in the script. The Figure below shows how the skeleton looks like for <span class="math inline">\(6\)</span> of the time frames. The script also has code to play the action as an animation.</p>
<div class="figure" style="text-align: center"><span id="fig:sklBasket"></span>
<img src="images/skl_basket.png" alt="Skeleton of basketball shoot action. 6 frames sampled from the entire sequence." width="100%" />
<p class="caption">
Figure 9.2: Skeleton of basketball shoot action. 6 frames sampled from the entire sequence.
</p>
</div>
<p>We will represent each action (file) as a feature vector. The same script also shows the code to extract the feature vectors from each action. To extract the features, a reference point in the skeleton is selected, in this case the spine (joint <span class="math inline">\(3\)</span>). Then, for each time frame, the distance between all joints (excluding the reference point) and the reference point is calculated. Finally, for each distance, the <em>mean</em>, <em>min</em>, and <em>max</em> are computed across all time frames. Since there are <span class="math inline">\(19\)</span> joints (excluding the spine), we end up with <span class="math inline">\(19*3=57\)</span> features. Figure <a href="multiuser.html#fig:sklFeatures">9.3</a> shows how the final dataset looks like. Only showing the first <span class="math inline">\(4\)</span> features out of the <span class="math inline">\(57\)</span> and user id and labels.</p>
<div class="figure" style="text-align: center"><span id="fig:sklFeatures"></span>
<img src="images/skl_features.png" alt="First rows of the skeleton dataset after feature extraction showing the first 4 features." width="60%" />
<p class="caption">
Figure 9.3: First rows of the skeleton dataset after feature extraction showing the first 4 features.
</p>
</div>

<div class="rmdgoodpractice">
The following examples assume that the file <em>dataset.csv</em> with the extracted features already exsits in the <code>skeleton_actions/</code> directory. To generate this file, run the feature extraction code in the script <code>preprocess_skeleton_actions.R</code>.
</div>

<p>Once the dataset in a suitable format, we can proceed to <strong>train our mixed model</strong>. The script containing the full code for training the different types of models is <code>classify_skeleton_actions.R</code>. This script makes use of the <em>dataset.csv</em> file.</p>
<p>First, the auxiliary functions are loaded because we will use the <code>normalize()</code> function to normalize the data. We will use a Random Forest for the classification and the <code>caret</code> package to compute the performance metrics.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="multiuser.html#cb194-1"></a><span class="kw">source</span>(<span class="kw">file.path</span>(<span class="st">&quot;..&quot;</span>,<span class="st">&quot;auxiliary_functions&quot;</span>,<span class="st">&quot;globals.R&quot;</span>))</span>
<span id="cb194-2"><a href="multiuser.html#cb194-2"></a><span class="kw">source</span>(<span class="kw">file.path</span>(<span class="st">&quot;..&quot;</span>,<span class="st">&quot;auxiliary_functions&quot;</span>,<span class="st">&quot;functions.R&quot;</span>))</span>
<span id="cb194-3"><a href="multiuser.html#cb194-3"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb194-4"><a href="multiuser.html#cb194-4"></a><span class="kw">library</span>(caret)</span>
<span id="cb194-5"><a href="multiuser.html#cb194-5"></a></span>
<span id="cb194-6"><a href="multiuser.html#cb194-6"></a><span class="co"># Path to the csv file containing the extracted features.</span></span>
<span id="cb194-7"><a href="multiuser.html#cb194-7"></a><span class="co"># preprocess_skeleton_actins.R contains</span></span>
<span id="cb194-8"><a href="multiuser.html#cb194-8"></a><span class="co"># the code used to extract the features.</span></span>
<span id="cb194-9"><a href="multiuser.html#cb194-9"></a>filepath &lt;-<span class="st"> </span><span class="kw">file.path</span>(datasets_path,</span>
<span id="cb194-10"><a href="multiuser.html#cb194-10"></a>                      <span class="st">&quot;skeleton_actions&quot;</span>,</span>
<span id="cb194-11"><a href="multiuser.html#cb194-11"></a>                      <span class="st">&quot;dataset.csv&quot;</span>)</span>
<span id="cb194-12"><a href="multiuser.html#cb194-12"></a><span class="co"># Load dataset.</span></span>
<span id="cb194-13"><a href="multiuser.html#cb194-13"></a>dataset &lt;-<span class="st"> </span><span class="kw">read.csv</span>(filepath, <span class="dt">stringsAsFactors =</span> T)</span>
<span id="cb194-14"><a href="multiuser.html#cb194-14"></a></span>
<span id="cb194-15"><a href="multiuser.html#cb194-15"></a><span class="co"># Extract unique labels.</span></span>
<span id="cb194-16"><a href="multiuser.html#cb194-16"></a>unique.actions &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unique</span>(dataset<span class="op">$</span>label))</span>
<span id="cb194-17"><a href="multiuser.html#cb194-17"></a></span>
<span id="cb194-18"><a href="multiuser.html#cb194-18"></a><span class="co"># Print the unique labels.</span></span>
<span id="cb194-19"><a href="multiuser.html#cb194-19"></a><span class="kw">print</span>(unique.actions)</span>
<span id="cb194-20"><a href="multiuser.html#cb194-20"></a><span class="co">#&gt;  [1] &quot;a1&quot;  &quot;a10&quot; &quot;a11&quot; &quot;a12&quot; &quot;a13&quot; &quot;a14&quot; &quot;a15&quot; &quot;a16&quot; &quot;a17&quot;</span></span>
<span id="cb194-21"><a href="multiuser.html#cb194-21"></a><span class="co">#&gt; [10] &quot;a18&quot; &quot;a19&quot; &quot;a2&quot;  &quot;a20&quot; &quot;a21&quot; &quot;a22&quot; &quot;a23&quot; &quot;a24&quot; &quot;a25&quot;</span></span>
<span id="cb194-22"><a href="multiuser.html#cb194-22"></a><span class="co">#&gt; [19] &quot;a26&quot; &quot;a27&quot; &quot;a3&quot;  &quot;a4&quot;  &quot;a5&quot;  &quot;a6&quot;  &quot;a7&quot;  &quot;a8&quot;  &quot;a9&quot; </span></span></code></pre></div>
<p>The <code>unique.actions</code> variable stores the name of all actions. We will need it later to define the levels of the factor object. Next, we generate <span class="math inline">\(10\)</span> folds and define some variables to store the performance metrics including the <em>accuracy</em>, <em>recall</em>, and <em>precision</em>. In each iteration during cross-validation, we will compute and store those performance metrics.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="multiuser.html#cb195-1"></a>k &lt;-<span class="st"> </span><span class="dv">10</span> <span class="co"># Number of folds.</span></span>
<span id="cb195-2"><a href="multiuser.html#cb195-2"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb195-3"><a href="multiuser.html#cb195-3"></a>folds &lt;-<span class="st"> </span><span class="kw">sample</span>(k, <span class="kw">nrow</span>(dataset), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb195-4"><a href="multiuser.html#cb195-4"></a>accuracies &lt;-<span class="st"> </span><span class="ot">NULL</span>; recalls &lt;-<span class="st"> </span><span class="ot">NULL</span>; precisions &lt;-<span class="st"> </span><span class="ot">NULL</span></span></code></pre></div>
<p>In the next code snippet, the actual cross-validation is performed. This is just the usual cross-validation procedure. The <code>normalize()</code> function defined in the auxiliary functions is used to normalize the data by only learning the parameters from the train set and applying them to the test set. Then, the actual Random Forest is fitted with the train set. One thing to note here is that the <code>userid</code> field is removed: <code>trainset[,-1]</code> since we are not using users’ information in the mixed model. Then, predictions on the test set are obtained and the accuracy, recall, and precision are computed during each iteration.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="multiuser.html#cb196-1"></a><span class="co"># Perform k-fold cross-validation.</span></span>
<span id="cb196-2"><a href="multiuser.html#cb196-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k){</span>
<span id="cb196-3"><a href="multiuser.html#cb196-3"></a>  </span>
<span id="cb196-4"><a href="multiuser.html#cb196-4"></a>  trainset &lt;-<span class="st"> </span>dataset[<span class="kw">which</span>(folds <span class="op">!=</span><span class="st"> </span>i,),]</span>
<span id="cb196-5"><a href="multiuser.html#cb196-5"></a>  testset &lt;-<span class="st"> </span>dataset[<span class="kw">which</span>(folds <span class="op">==</span><span class="st"> </span>i,),]</span>
<span id="cb196-6"><a href="multiuser.html#cb196-6"></a>  </span>
<span id="cb196-7"><a href="multiuser.html#cb196-7"></a>  <span class="co">#Normalize.</span></span>
<span id="cb196-8"><a href="multiuser.html#cb196-8"></a>  res &lt;-<span class="st"> </span><span class="kw">normalize</span>(trainset, testset)</span>
<span id="cb196-9"><a href="multiuser.html#cb196-9"></a>  trainset &lt;-<span class="st"> </span>res<span class="op">$</span>train</span>
<span id="cb196-10"><a href="multiuser.html#cb196-10"></a>  testset &lt;-<span class="st"> </span>res<span class="op">$</span>test</span>
<span id="cb196-11"><a href="multiuser.html#cb196-11"></a>    </span>
<span id="cb196-12"><a href="multiuser.html#cb196-12"></a>  rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(label <span class="op">~</span>., trainset[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb196-13"><a href="multiuser.html#cb196-13"></a>  preds.rf &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">predict</span>(rf,</span>
<span id="cb196-14"><a href="multiuser.html#cb196-14"></a>                                   <span class="dt">newdata =</span> testset[,<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb196-15"><a href="multiuser.html#cb196-15"></a>  groundTruth &lt;-<span class="st"> </span><span class="kw">as.character</span>(testset<span class="op">$</span>label)</span>
<span id="cb196-16"><a href="multiuser.html#cb196-16"></a>  cm.rf &lt;-<span class="st"> </span><span class="kw">confusionMatrix</span>(<span class="kw">factor</span>(preds.rf,</span>
<span id="cb196-17"><a href="multiuser.html#cb196-17"></a>                                  <span class="dt">levels =</span> unique.actions),</span>
<span id="cb196-18"><a href="multiuser.html#cb196-18"></a>                           <span class="kw">factor</span>(groundTruth,</span>
<span id="cb196-19"><a href="multiuser.html#cb196-19"></a>                                  <span class="dt">levels =</span> unique.actions))</span>
<span id="cb196-20"><a href="multiuser.html#cb196-20"></a>  </span>
<span id="cb196-21"><a href="multiuser.html#cb196-21"></a>  accuracies &lt;-<span class="st"> </span><span class="kw">c</span>(accuracies, cm.rf<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>])</span>
<span id="cb196-22"><a href="multiuser.html#cb196-22"></a>  metrics &lt;-<span class="st"> </span><span class="kw">colMeans</span>(cm.rf<span class="op">$</span>byClass[,<span class="kw">c</span>(<span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb196-23"><a href="multiuser.html#cb196-23"></a>                                       <span class="st">&quot;Specificity&quot;</span>,</span>
<span id="cb196-24"><a href="multiuser.html#cb196-24"></a>                                       <span class="st">&quot;Precision&quot;</span>,</span>
<span id="cb196-25"><a href="multiuser.html#cb196-25"></a>                                       <span class="st">&quot;F1&quot;</span>)],</span>
<span id="cb196-26"><a href="multiuser.html#cb196-26"></a>                      <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb196-27"><a href="multiuser.html#cb196-27"></a>  recalls &lt;-<span class="st"> </span><span class="kw">c</span>(recalls, metrics[<span class="st">&quot;Recall&quot;</span>])</span>
<span id="cb196-28"><a href="multiuser.html#cb196-28"></a>  precisions &lt;-<span class="st"> </span><span class="kw">c</span>(precisions, metrics[<span class="st">&quot;Precision&quot;</span>])</span>
<span id="cb196-29"><a href="multiuser.html#cb196-29"></a>}</span></code></pre></div>
<p>Finally, the average performance across folds of each of the metrics is printed.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="multiuser.html#cb197-1"></a><span class="co"># Print performance metrics.</span></span>
<span id="cb197-2"><a href="multiuser.html#cb197-2"></a><span class="kw">mean</span>(accuracies)</span>
<span id="cb197-3"><a href="multiuser.html#cb197-3"></a><span class="co">#&gt; [1] 0.9277258</span></span>
<span id="cb197-4"><a href="multiuser.html#cb197-4"></a><span class="kw">mean</span>(recalls)</span>
<span id="cb197-5"><a href="multiuser.html#cb197-5"></a><span class="co">#&gt; [1] 0.9372515</span></span>
<span id="cb197-6"><a href="multiuser.html#cb197-6"></a><span class="kw">mean</span>(precisions)</span>
<span id="cb197-7"><a href="multiuser.html#cb197-7"></a><span class="co">#&gt; [1] 0.9208455</span></span></code></pre></div>
<p>The results look promising with an average <em>accuracy</em> of <span class="math inline">\(92.7\%\)</span>, a <em>recall</em> of <span class="math inline">\(93.7\%\)</span>, and a <em>precision</em> of <span class="math inline">\(92\%\)</span>. One important thing to remember is that the mixed model assumes that the training data contains instances belonging to users in the test set. Thus, the model already knows a little bit about the users in the test set.</p>
<p>Imagine that now you want to estimate what would be the performance of the model in a situation where a completely new user is shown to the model, that is, the model does not know anything about this user. We can model these situations using a <strong>user-independent model</strong> which is the topic of the next section.</p>
</div>
</div>
<div id="user-independent-models" class="section level2">
<h2><span class="header-section-number">9.2</span> User-Independent Models</h2>
<p>The <strong>user-independent</strong> model allows us to estimate the performance of a system on new users. That is, the model does not contain any information about the target user. This resembles a scenario when the user wants to use a service out-of-the-box without having to go through a calibration process or having to collect training data. To build a user-independent model we just need to make sure that the training data does not contain any information about the users on the test set. We can achieve this by splitting the dataset into two disjoint groups of users based on their ids. For example, assign <span class="math inline">\(70\%\)</span> of the users to the train set and the remaining to the test set. If the dataset is small, one way to optimize it is by performing <strong>leave-one-user-out validation</strong>: If the dataset has <span class="math inline">\(n\)</span> users, then, <span class="math inline">\(n\)</span> iterations are performed. In each iteration, one user is selected as the test set and the remaining ones are used as the train set. Figure <a href="multiuser.html#fig:loov">9.4</a> illustrates <em>leave-one-user-out validation</em> for the first <span class="math inline">\(2\)</span> iterations of the procedure.</p>
<div class="figure" style="text-align: center"><span id="fig:loov"></span>
<img src="images/loov.png" alt="First 2 iterations of leave-one-user-out validation." width="70%" />
<p class="caption">
Figure 9.4: First 2 iterations of leave-one-user-out validation.
</p>
</div>
<p>By doing this, we guarantee that the model knows anything about the target user. To implement this leave-one-user-out validation method in our skeleton recognition case, let’s first define some initialization variables. These include the <code>unique.users</code> variable which stores the ids of all users in the database. As before, we will compute the <em>accuracy</em>, <em>recall</em>, and <em>precision</em> so we define variables to store those metrics for each user.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="multiuser.html#cb198-1"></a><span class="co"># Get a list of unique users.</span></span>
<span id="cb198-2"><a href="multiuser.html#cb198-2"></a>unique.users &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unique</span>(dataset<span class="op">$</span>userid))</span>
<span id="cb198-3"><a href="multiuser.html#cb198-3"></a></span>
<span id="cb198-4"><a href="multiuser.html#cb198-4"></a><span class="co"># Print the unique user ids.</span></span>
<span id="cb198-5"><a href="multiuser.html#cb198-5"></a>unique.users</span>
<span id="cb198-6"><a href="multiuser.html#cb198-6"></a><span class="co">#&gt; [1] &quot;s1&quot; &quot;s2&quot; &quot;s3&quot; &quot;s4&quot; &quot;s5&quot; &quot;s6&quot; &quot;s7&quot; &quot;s8&quot;</span></span>
<span id="cb198-7"><a href="multiuser.html#cb198-7"></a></span>
<span id="cb198-8"><a href="multiuser.html#cb198-8"></a>accuracies &lt;-<span class="st"> </span><span class="ot">NULL</span>; recalls &lt;-<span class="st"> </span><span class="ot">NULL</span>; precisions &lt;-<span class="st"> </span><span class="ot">NULL</span></span></code></pre></div>
<p>Then, we iterate through each user, build the corresponding train and test sets, and train the classifiers. Here, we make sure that the test set only includes data points belonging to a single user.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="multiuser.html#cb199-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb199-2"><a href="multiuser.html#cb199-2"></a></span>
<span id="cb199-3"><a href="multiuser.html#cb199-3"></a><span class="cf">for</span>(user <span class="cf">in</span> unique.users){</span>
<span id="cb199-4"><a href="multiuser.html#cb199-4"></a>  </span>
<span id="cb199-5"><a href="multiuser.html#cb199-5"></a>  testset &lt;-<span class="st"> </span>dataset[<span class="kw">which</span>(dataset<span class="op">$</span>userid <span class="op">==</span><span class="st"> </span>user),]</span>
<span id="cb199-6"><a href="multiuser.html#cb199-6"></a>  trainset &lt;-<span class="st"> </span>dataset[<span class="kw">which</span>(dataset<span class="op">$</span>userid <span class="op">!=</span><span class="st"> </span>user),]</span>
<span id="cb199-7"><a href="multiuser.html#cb199-7"></a>  </span>
<span id="cb199-8"><a href="multiuser.html#cb199-8"></a>  <span class="co"># Normalize. Not really needed since RF</span></span>
<span id="cb199-9"><a href="multiuser.html#cb199-9"></a>  <span class="co"># is not affected by different features scale.</span></span>
<span id="cb199-10"><a href="multiuser.html#cb199-10"></a>  res &lt;-<span class="st"> </span><span class="kw">normalize</span>(trainset, testset)</span>
<span id="cb199-11"><a href="multiuser.html#cb199-11"></a>  trainset &lt;-<span class="st"> </span>res<span class="op">$</span>train</span>
<span id="cb199-12"><a href="multiuser.html#cb199-12"></a>  testset &lt;-<span class="st"> </span>res<span class="op">$</span>test</span>
<span id="cb199-13"><a href="multiuser.html#cb199-13"></a>  </span>
<span id="cb199-14"><a href="multiuser.html#cb199-14"></a>  rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(label <span class="op">~</span>., trainset[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb199-15"><a href="multiuser.html#cb199-15"></a>  </span>
<span id="cb199-16"><a href="multiuser.html#cb199-16"></a>  preds.rf &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">predict</span>(rf, <span class="dt">newdata =</span> testset[,<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb199-17"><a href="multiuser.html#cb199-17"></a>  </span>
<span id="cb199-18"><a href="multiuser.html#cb199-18"></a>  groundTruth &lt;-<span class="st"> </span><span class="kw">as.character</span>(testset<span class="op">$</span>label)</span>
<span id="cb199-19"><a href="multiuser.html#cb199-19"></a>  </span>
<span id="cb199-20"><a href="multiuser.html#cb199-20"></a>  cm.rf &lt;-<span class="st"> </span><span class="kw">confusionMatrix</span>(<span class="kw">factor</span>(preds.rf,</span>
<span id="cb199-21"><a href="multiuser.html#cb199-21"></a>                                  <span class="dt">levels =</span> unique.actions),</span>
<span id="cb199-22"><a href="multiuser.html#cb199-22"></a>                           <span class="kw">factor</span>(groundTruth,</span>
<span id="cb199-23"><a href="multiuser.html#cb199-23"></a>                                  <span class="dt">levels =</span> unique.actions))</span>
<span id="cb199-24"><a href="multiuser.html#cb199-24"></a>  </span>
<span id="cb199-25"><a href="multiuser.html#cb199-25"></a>  accuracies &lt;-<span class="st"> </span><span class="kw">c</span>(accuracies, cm.rf<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>])</span>
<span id="cb199-26"><a href="multiuser.html#cb199-26"></a>  </span>
<span id="cb199-27"><a href="multiuser.html#cb199-27"></a>  metrics &lt;-<span class="st"> </span><span class="kw">colMeans</span>(cm.rf<span class="op">$</span>byClass[,<span class="kw">c</span>(<span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb199-28"><a href="multiuser.html#cb199-28"></a>                                       <span class="st">&quot;Specificity&quot;</span>,</span>
<span id="cb199-29"><a href="multiuser.html#cb199-29"></a>                                       <span class="st">&quot;Precision&quot;</span>,</span>
<span id="cb199-30"><a href="multiuser.html#cb199-30"></a>                                       <span class="st">&quot;F1&quot;</span>)],</span>
<span id="cb199-31"><a href="multiuser.html#cb199-31"></a>           <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb199-32"><a href="multiuser.html#cb199-32"></a>  </span>
<span id="cb199-33"><a href="multiuser.html#cb199-33"></a>  recalls &lt;-<span class="st"> </span><span class="kw">c</span>(recalls, metrics[<span class="st">&quot;Recall&quot;</span>])</span>
<span id="cb199-34"><a href="multiuser.html#cb199-34"></a>  </span>
<span id="cb199-35"><a href="multiuser.html#cb199-35"></a>  precisions &lt;-<span class="st"> </span><span class="kw">c</span>(precisions, metrics[<span class="st">&quot;Precision&quot;</span>])</span>
<span id="cb199-36"><a href="multiuser.html#cb199-36"></a>}</span></code></pre></div>
<p>Now we print the average performance metrics across users.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="multiuser.html#cb200-1"></a><span class="kw">mean</span>(accuracies)</span>
<span id="cb200-2"><a href="multiuser.html#cb200-2"></a><span class="co">#&gt; [1] 0.5807805</span></span>
<span id="cb200-3"><a href="multiuser.html#cb200-3"></a><span class="kw">mean</span>(recalls)</span>
<span id="cb200-4"><a href="multiuser.html#cb200-4"></a><span class="co">#&gt; [1] 0.5798611</span></span>
<span id="cb200-5"><a href="multiuser.html#cb200-5"></a><span class="kw">mean</span>(precisions)</span>
<span id="cb200-6"><a href="multiuser.html#cb200-6"></a><span class="co">#&gt; [1] 0.6539715</span></span></code></pre></div>
<p>Those numbers are surprising! In the previous section, our <strong>mixed model</strong> had an accuracy of <span class="math inline">\(92.7\%\)</span> and now the <strong>user-independent model</strong> has an accuracy of only <span class="math inline">\(58\%\)</span>! This is because the latter didn’t know anything about the target user. Since each person different, the <strong>user-independent model</strong> was not able to capture the patterns of new users and this had a big impact on the performance.</p>
<p><strong>When should a user-independent model be used to validate a system?</strong></p>
<ol style="list-style-type: decimal">
<li>When you expect the system to be used out-of-the-box by new users and the system does not have any data from those new users.</li>
</ol>
<p>The main advantage of the user-independent model is that it does not require training data from the <em>target users</em> so they can start using it right away at the expense of lower accuracy.</p>
<p>The opposite case is when a model is trained specifically for the <em>target user</em>. This model is called the <strong>user-dependent model</strong> and will be presented in the next section.</p>
</div>
<div id="user-dependent-models" class="section level2">
<h2><span class="header-section-number">9.3</span> User-Dependent Models</h2>
<p>A <strong>user-dependent model</strong> is trained with data belonging only to the <em>target user</em>. In general, this type of model performs better compared to the <em>mixed model</em> and <em>user-independent model</em>. This is because the model captures the particularities of a specific user. The way to evaluate user-dependent models is to iterate through each user, and for each user, build and test a model only with her/his data. The per-user evaluation can be done using <span class="math inline">\(k\)</span>-fold cross-validation, for example. For the skeleton database, we only have <span class="math inline">\(4\)</span> instances per type of action. The number of unique classes (<span class="math inline">\(27\)</span>) is also high compared to the number of instances per action. If we do, for example, <span class="math inline">\(10\)</span>-fold cross-validation, it is very likely that the train sets will not contain examples for several of the possible actions. To avoid this, we will do <em>leave-one-out validation</em> within each user. This means that we iterate through each instance. In each iteration, the instance is used as the test set and the remaining ones are used for the train set.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="multiuser.html#cb201-1"></a>unique.users &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unique</span>(dataset<span class="op">$</span>userid))</span>
<span id="cb201-2"><a href="multiuser.html#cb201-2"></a></span>
<span id="cb201-3"><a href="multiuser.html#cb201-3"></a>accuracies &lt;-<span class="st"> </span><span class="ot">NULL</span>; recalls &lt;-<span class="st"> </span><span class="ot">NULL</span>; precisions &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb201-4"><a href="multiuser.html#cb201-4"></a></span>
<span id="cb201-5"><a href="multiuser.html#cb201-5"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb201-6"><a href="multiuser.html#cb201-6"></a></span>
<span id="cb201-7"><a href="multiuser.html#cb201-7"></a><span class="co"># Iterate through each user.</span></span>
<span id="cb201-8"><a href="multiuser.html#cb201-8"></a><span class="cf">for</span>(user <span class="cf">in</span> unique.users){</span>
<span id="cb201-9"><a href="multiuser.html#cb201-9"></a>  </span>
<span id="cb201-10"><a href="multiuser.html#cb201-10"></a>  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Evaluating user &quot;</span>, user))</span>
<span id="cb201-11"><a href="multiuser.html#cb201-11"></a>  </span>
<span id="cb201-12"><a href="multiuser.html#cb201-12"></a>  user.data &lt;-<span class="st"> </span>dataset[<span class="kw">which</span>(dataset<span class="op">$</span>userid <span class="op">==</span><span class="st"> </span>user), <span class="dv">-1</span>]</span>
<span id="cb201-13"><a href="multiuser.html#cb201-13"></a>  </span>
<span id="cb201-14"><a href="multiuser.html#cb201-14"></a>  <span class="co"># Leave-one-out cross validation within each user.</span></span>
<span id="cb201-15"><a href="multiuser.html#cb201-15"></a>  </span>
<span id="cb201-16"><a href="multiuser.html#cb201-16"></a>  predictions.rf &lt;-<span class="st"> </span><span class="ot">NULL</span>; groundTruth &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb201-17"><a href="multiuser.html#cb201-17"></a>  </span>
<span id="cb201-18"><a href="multiuser.html#cb201-18"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(user.data)){</span>
<span id="cb201-19"><a href="multiuser.html#cb201-19"></a>    </span>
<span id="cb201-20"><a href="multiuser.html#cb201-20"></a>    <span class="co"># Normalize. Not really needed since RF</span></span>
<span id="cb201-21"><a href="multiuser.html#cb201-21"></a>    <span class="co"># is not affected by different features scale.</span></span>
<span id="cb201-22"><a href="multiuser.html#cb201-22"></a>    testset &lt;-<span class="st"> </span>user.data[i,]</span>
<span id="cb201-23"><a href="multiuser.html#cb201-23"></a>    trainset &lt;-<span class="st"> </span>user.data[<span class="op">-</span>i,]</span>
<span id="cb201-24"><a href="multiuser.html#cb201-24"></a>    res &lt;-<span class="st"> </span><span class="kw">normalize</span>(trainset, testset)</span>
<span id="cb201-25"><a href="multiuser.html#cb201-25"></a>    </span>
<span id="cb201-26"><a href="multiuser.html#cb201-26"></a>    testset &lt;-<span class="st"> </span>res<span class="op">$</span>test</span>
<span id="cb201-27"><a href="multiuser.html#cb201-27"></a>    trainset &lt;-<span class="st"> </span>res<span class="op">$</span>train</span>
<span id="cb201-28"><a href="multiuser.html#cb201-28"></a>    </span>
<span id="cb201-29"><a href="multiuser.html#cb201-29"></a>    rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(label <span class="op">~</span>., trainset)</span>
<span id="cb201-30"><a href="multiuser.html#cb201-30"></a>    </span>
<span id="cb201-31"><a href="multiuser.html#cb201-31"></a>    preds.rf &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">predict</span>(rf, <span class="dt">newdata =</span> testset))</span>
<span id="cb201-32"><a href="multiuser.html#cb201-32"></a>    </span>
<span id="cb201-33"><a href="multiuser.html#cb201-33"></a>    predictions.rf &lt;-<span class="st"> </span><span class="kw">c</span>(predictions.rf, preds.rf)</span>
<span id="cb201-34"><a href="multiuser.html#cb201-34"></a>    </span>
<span id="cb201-35"><a href="multiuser.html#cb201-35"></a>    groundTruth &lt;-<span class="st"> </span><span class="kw">c</span>(groundTruth, <span class="kw">as.character</span>(testset<span class="op">$</span>label))</span>
<span id="cb201-36"><a href="multiuser.html#cb201-36"></a>  }</span>
<span id="cb201-37"><a href="multiuser.html#cb201-37"></a>  </span>
<span id="cb201-38"><a href="multiuser.html#cb201-38"></a>  cm.rf &lt;-<span class="st"> </span><span class="kw">confusionMatrix</span>(<span class="kw">factor</span>(predictions.rf,</span>
<span id="cb201-39"><a href="multiuser.html#cb201-39"></a>                                  <span class="dt">levels =</span> unique.actions),</span>
<span id="cb201-40"><a href="multiuser.html#cb201-40"></a>                           <span class="kw">factor</span>(groundTruth,</span>
<span id="cb201-41"><a href="multiuser.html#cb201-41"></a>                                  <span class="dt">levels =</span> unique.actions))</span>
<span id="cb201-42"><a href="multiuser.html#cb201-42"></a>  </span>
<span id="cb201-43"><a href="multiuser.html#cb201-43"></a>  </span>
<span id="cb201-44"><a href="multiuser.html#cb201-44"></a>  accuracies &lt;-<span class="st"> </span><span class="kw">c</span>(accuracies, cm.rf<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>])</span>
<span id="cb201-45"><a href="multiuser.html#cb201-45"></a>  </span>
<span id="cb201-46"><a href="multiuser.html#cb201-46"></a>  metrics &lt;-<span class="st"> </span><span class="kw">colMeans</span>(cm.rf<span class="op">$</span>byClass[,<span class="kw">c</span>(<span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb201-47"><a href="multiuser.html#cb201-47"></a>                                       <span class="st">&quot;Specificity&quot;</span>,</span>
<span id="cb201-48"><a href="multiuser.html#cb201-48"></a>                                       <span class="st">&quot;Precision&quot;</span>,</span>
<span id="cb201-49"><a href="multiuser.html#cb201-49"></a>                                       <span class="st">&quot;F1&quot;</span>)],</span>
<span id="cb201-50"><a href="multiuser.html#cb201-50"></a>                      <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb201-51"><a href="multiuser.html#cb201-51"></a>  </span>
<span id="cb201-52"><a href="multiuser.html#cb201-52"></a>  recalls &lt;-<span class="st"> </span><span class="kw">c</span>(recalls, metrics[<span class="st">&quot;Recall&quot;</span>])</span>
<span id="cb201-53"><a href="multiuser.html#cb201-53"></a>  </span>
<span id="cb201-54"><a href="multiuser.html#cb201-54"></a>  precisions &lt;-<span class="st"> </span><span class="kw">c</span>(precisions, metrics[<span class="st">&quot;Precision&quot;</span>])</span>
<span id="cb201-55"><a href="multiuser.html#cb201-55"></a>} <span class="co"># end of users iteration.</span></span></code></pre></div>
<p>We iterated through each user and performed the leave-one-out-validation for each, independently of the others and stored their results. We can now compute the average performance across all users.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="multiuser.html#cb202-1"></a><span class="co"># Print average performance across users.</span></span>
<span id="cb202-2"><a href="multiuser.html#cb202-2"></a></span>
<span id="cb202-3"><a href="multiuser.html#cb202-3"></a><span class="kw">mean</span>(accuracies)</span>
<span id="cb202-4"><a href="multiuser.html#cb202-4"></a><span class="co">#&gt; [1] 0.943114</span></span>
<span id="cb202-5"><a href="multiuser.html#cb202-5"></a><span class="kw">mean</span>(recalls)</span>
<span id="cb202-6"><a href="multiuser.html#cb202-6"></a><span class="co">#&gt; [1] 0.9425154</span></span>
<span id="cb202-7"><a href="multiuser.html#cb202-7"></a><span class="kw">mean</span>(precisions)</span>
<span id="cb202-8"><a href="multiuser.html#cb202-8"></a><span class="co">#&gt; [1] 0.9500772</span></span></code></pre></div>
<p>This time, the average accuracy was <span class="math inline">\(94.3\%\)</span> which is higher than the accuracy achieved with the mixed model and the user-independent model. The average recall and precision were also higher compared to the other types of models. The high performance is because each model was targeted to a particular user.</p>
<p><strong>When should a user-dependent model be used to validate a system?</strong></p>
<ol style="list-style-type: decimal">
<li>When the model will be trained only using data from the target user that will use the system.</li>
</ol>
<p>In general, user-dependent models have the best accuracy. The disadvantage is that they require training data from the target user and for some applications, collecting training data can be very difficult and expensive.</p>
<p>Can we have a system that has the best of both worlds from user dependent/independent models? That is, a model that is as accurate as a user-dependent model but requires small quantities of training data from the target user. The answer is <em>yes</em>, and how we can do that is covered in the next section <strong>User-Adaptive Models</strong>.</p>
</div>
<div id="user-adaptive-models" class="section level2">
<h2><span class="header-section-number">9.4</span> User-Adaptive Models</h2>
<p>We have already talked about some of the limitations of <strong>user-dependent</strong> and <strong>user-independent</strong> models. On one hand, user-dependent models require training data from the target user. In many situations, collecting training data is difficult. On the other hand, user-independent models do not need data from the target user but are less accurate. To overcome those limitations, models that evolve over time as more information is available can be built. One can start with a user-independent model and as more data is available from the target user, the model can be updated accordingly. In this situation, there is no need to wait to start using the system and as new feedback is available, the model gets better and better by learning the specific patterns of a particular user.</p>
<p>In this section, I will explain how a technique called <strong>transfer learning</strong> can be used to build an <strong>adaptive model</strong> that updates itself as new training data is available. First, in the following subsection the idea of transfer learning is introduced and next, the method is used to build an adaptive model for activity recognition.</p>
<div id="transfer-learning" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Transfer Learning</h3>
<p>In machine learning, <strong>transfer learning</strong> refers to the idea of using the knowledge gained when solving a problem to solve another different problem. The new problem can be a similar one but also could be very unrelated. For example, a model trained to detect smiles from images could also be used to predict gender (of course with some fine-tuning). In humans, learning is a lifelong process in which many tasks are interrelated. When we are faced with a new problem, we tend to find solutions that have worked in the past for similar problems. However, in machine learning most of the time the models are trained from scratch for every new problem. For many tasks, training a model from scratch is very time consuming and requires a lot of effort, especially during the data collection and labeling phase.</p>
<p>The idea of transfer learning dates back to 1991 <span class="citation">(Pratt et al. <a href="#ref-pratt1991" role="doc-biblioref">1991</a>)</span> but with the advent of <em>deep learning</em> and in particular, with convolutional neural networks (see chapter <a href="deeplearning.html#deeplearning">8</a>), it has gained popularity because it has proven to be a valuable tool when solving challenging problems. In 2014 a CNN architecture called VGG16 was proposed by <span class="citation">Simonyan and Zisserman (<a href="#ref-simonyan2014" role="doc-biblioref">2014</a>)</span> and won the ILSVR image recognition competition. This CNN was trained with more than <span class="math inline">\(1\)</span> million images to recognize <span class="math inline">\(1000\)</span> categories and it consists of several convolution layers, max pooling operations, and fully connected layers. In total, the network has <span class="math inline">\(\approx 138\)</span> million parameters and it took some weeks to train.</p>
<p>What if you wanted to add a new category to the <span class="math inline">\(1000\)</span> labels? Or maybe, you only want to focus on a subset of the categories? With transfer learning you can take advantage of a network that has already been trained and adapt it to your particular problem. In the case of <em>deep learning</em>, the approach consists of ‘freezing’ the first layers of a network and only retrain and/or modify the last layers to adapt them for the particular problem. During training, the frozen layers’ parameters will not change and the unfrozen ones are updated as usual during the gradient descent procedure. As discussed in chapter <a href="deeplearning.html#deeplearning">8</a>, the first layers can act as feature extractors and can be reused. With this approach, you can easily retrain a VGG16 network in an average computer and within a reasonable time. In fact, Keras already provides interfaces to common pre-trained architectures that you can reuse.</p>
<p>In the following section we will use this idea to build a <strong>user-adaptive model</strong> for activity recognition using transfer learning.</p>
</div>
<div id="a-user-adaptive-model-for-activity-recognition" class="section level3">
<h3><span class="header-section-number">9.4.2</span> A User-Adaptive Model for Activity Recognition</h3>

<div class="rmdfolder">
<code>keras/adaptive_cnn.R</code>
</div>

<p>For this example, we will use the <em>SMARTPHONE ACTIVITIES</em> dataset <strong>encoded as images </strong>. In chapter <a href="representations.html#representations">7</a> (section: Images) I showed you how timeseries data can be represented as an image with an example of how an activity can be represented as an RBG color image where each channel corresponds to one of the acceleration axes (<em>x</em>, <em>y</em>, <em>z</em>). We will use the file <code>images.txt</code> that already contains the activities in image format. The procedure of converting the raw data into this format was explained in chapter <a href="representations.html#representations">7</a> and the corresponding code is in script <code>timeseries_to_images.R</code>. Since the input data are images, we will use a convolutional neural network (see chapter <a href="deeplearning.html#deeplearning">8</a>).</p>
<p>The main objective will be to build an adaptive model with a small amount of training data from the target user. What we will do first is build a <strong>user-independent model</strong>. That is, we will select one of the users as the <em>target user</em>. We will train a user-independent model with data from the remaining users (excluding the target user). Then, we will apply transfer learning on this model to adapt it to the target user.</p>
<p>The target user’s data will be split into a test set and an <strong>adaptive set</strong>. The test set will be used to evaluate the performance of the model and the adaptive set will be used to fine-tune the model. The adaptive set is used to simulate that we have obtained new data from the target user.</p>
<p>The complete code is in script <code>keras/adaptive_cnn.R</code>. First, we start by reading the images file. Each row corresponds to one activity. The last two columns are the <code>userid</code> and the <code>class</code>. The first <span class="math inline">\(300\)</span> columns correspond to the image pixels. Each image has a size of <span class="math inline">\(10 \times 10 \times 3\)</span> (height, width, depth).</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="multiuser.html#cb203-1"></a><span class="co"># Path to smartphone activities in image format.</span></span>
<span id="cb203-2"><a href="multiuser.html#cb203-2"></a>filepath &lt;-<span class="st"> </span><span class="kw">file.path</span>(datasets_path,</span>
<span id="cb203-3"><a href="multiuser.html#cb203-3"></a>                      <span class="st">&quot;smartphone_activities&quot;</span>,</span>
<span id="cb203-4"><a href="multiuser.html#cb203-4"></a>                      <span class="st">&quot;images.txt&quot;</span>)</span>
<span id="cb203-5"><a href="multiuser.html#cb203-5"></a></span>
<span id="cb203-6"><a href="multiuser.html#cb203-6"></a><span class="co"># Read data.</span></span>
<span id="cb203-7"><a href="multiuser.html#cb203-7"></a>df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(filepath, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb203-8"><a href="multiuser.html#cb203-8"></a></span>
<span id="cb203-9"><a href="multiuser.html#cb203-9"></a><span class="co"># Shuffle rows.</span></span>
<span id="cb203-10"><a href="multiuser.html#cb203-10"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb203-11"><a href="multiuser.html#cb203-11"></a>df &lt;-<span class="st"> </span>df[<span class="kw">sample</span>(<span class="kw">nrow</span>(df)),]</span></code></pre></div>
<p>The rows happen to be ordered by user and activity, so we shuffle them to ensure that the model is not biased towards the last users and activities.</p>
<p>Since we will train a CNN using keras, we need the classes to be in integer format. The following code is used to append a new column <code>intlabel</code> to the database. This new column contains the classes as integers. We also create a variable <code>mapping</code> to keep track of the mapping between integers and the actual labels. By printing the <code>mapping</code> variable we can see that for example, the <em>‘Walking’</em> label has a corresponding integer value of <span class="math inline">\(0\)</span>, <em>‘Downstairs’</em> <span class="math inline">\(1\)</span>, and so on.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="multiuser.html#cb204-1"></a><span class="co">## Convert labels to integers starting at 0. ##</span></span>
<span id="cb204-2"><a href="multiuser.html#cb204-2"></a></span>
<span id="cb204-3"><a href="multiuser.html#cb204-3"></a><span class="co"># Get the unique labels.</span></span>
<span id="cb204-4"><a href="multiuser.html#cb204-4"></a>labels &lt;-<span class="st"> </span><span class="kw">unique</span>(df<span class="op">$</span>label)</span>
<span id="cb204-5"><a href="multiuser.html#cb204-5"></a></span>
<span id="cb204-6"><a href="multiuser.html#cb204-6"></a>mapping &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span>(<span class="kw">length</span>(labels) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb204-7"><a href="multiuser.html#cb204-7"></a></span>
<span id="cb204-8"><a href="multiuser.html#cb204-8"></a><span class="kw">names</span>(mapping) &lt;-<span class="st"> </span>labels</span>
<span id="cb204-9"><a href="multiuser.html#cb204-9"></a></span>
<span id="cb204-10"><a href="multiuser.html#cb204-10"></a><span class="kw">print</span>(mapping)</span>
<span id="cb204-11"><a href="multiuser.html#cb204-11"></a><span class="co">#&gt;    Walking Downstairs    Jogging   Standing   Upstairs    Sitting </span></span>
<span id="cb204-12"><a href="multiuser.html#cb204-12"></a><span class="co">#&gt;         0          1          2          3          4          5 </span></span>
<span id="cb204-13"><a href="multiuser.html#cb204-13"></a></span>
<span id="cb204-14"><a href="multiuser.html#cb204-14"></a><span class="co"># Append labels as integers at the end of data frame.</span></span>
<span id="cb204-15"><a href="multiuser.html#cb204-15"></a>df<span class="op">$</span>intlabel &lt;-<span class="st"> </span>mapping[df<span class="op">$</span>label]</span></code></pre></div>
<p>Now we store the unique users’ ids in the <code>users</code> variable. After printing it, you can notice that there are <span class="math inline">\(19\)</span> distinct users in this database. The original database has more users but we only kept those that performed all the activities. Then, we can select one of the users to act as the <em>target user</em>. I will just select one of them at random (turned out to be user <span class="math inline">\(24\)</span>). Feel free to select another user if you want.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="multiuser.html#cb205-1"></a><span class="co"># Get the unique user ids.</span></span>
<span id="cb205-2"><a href="multiuser.html#cb205-2"></a>users &lt;-<span class="st"> </span><span class="kw">unique</span>(df<span class="op">$</span>userid)</span>
<span id="cb205-3"><a href="multiuser.html#cb205-3"></a></span>
<span id="cb205-4"><a href="multiuser.html#cb205-4"></a><span class="co"># Print all user ids.</span></span>
<span id="cb205-5"><a href="multiuser.html#cb205-5"></a><span class="kw">print</span>(users)</span>
<span id="cb205-6"><a href="multiuser.html#cb205-6"></a><span class="co">#&gt; [1] 29 20 18  8 32 27  3 36 34  5  7 12  6 21 24 31 13 33 19</span></span>
<span id="cb205-7"><a href="multiuser.html#cb205-7"></a></span>
<span id="cb205-8"><a href="multiuser.html#cb205-8"></a><span class="co"># Choose one user at random to be the target user.</span></span>
<span id="cb205-9"><a href="multiuser.html#cb205-9"></a>targetUser &lt;-<span class="st"> </span><span class="kw">sample</span>(users, <span class="dv">1</span>)</span></code></pre></div>
<p>Next, we split the data into two sets. The first set <code>trainset</code> contains the data from all users but <strong>excluding the target user</strong>. Then we create two variables: <code>train.y</code> and <code>train.x</code>. The first one has the labels as integers and the second one has the actual image pixels (features).</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="multiuser.html#cb206-1"></a><span class="co"># Split into train and target user sets.</span></span>
<span id="cb206-2"><a href="multiuser.html#cb206-2"></a><span class="co"># The train set includes data from all users excluding targetUser.</span></span>
<span id="cb206-3"><a href="multiuser.html#cb206-3"></a>trainset &lt;-<span class="st"> </span>df[df<span class="op">$</span>userid <span class="op">!=</span><span class="st"> </span>targetUser,]</span>
<span id="cb206-4"><a href="multiuser.html#cb206-4"></a></span>
<span id="cb206-5"><a href="multiuser.html#cb206-5"></a><span class="co"># Save train labels in a separate variable.</span></span>
<span id="cb206-6"><a href="multiuser.html#cb206-6"></a>train.y &lt;-<span class="st"> </span>trainset<span class="op">$</span>intlabel</span>
<span id="cb206-7"><a href="multiuser.html#cb206-7"></a></span>
<span id="cb206-8"><a href="multiuser.html#cb206-8"></a><span class="co"># Save train pixels in a separate variable.</span></span>
<span id="cb206-9"><a href="multiuser.html#cb206-9"></a>train.x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(trainset[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">301</span>,<span class="dv">302</span>,<span class="dv">303</span>)])</span></code></pre></div>
<p>Now we split the target’s user data into <span class="math inline">\(50\%\)</span> test data and <span class="math inline">\(50\%\)</span> adaptive data such that we end up with <span class="math inline">\(4\)</span> variables:</p>
<ol style="list-style-type: decimal">
<li><code>target.adaptive.y</code> Integer labels for the adaptive data of the target user.</li>
<li><code>target.adaptive.x</code> Pixels of the adaptive data of the target user.</li>
<li><code>target.test.y</code> Integer labels for the test data of the target user.</li>
<li><code>target.test.x</code> Pixels of the test data of the target user.</li>
</ol>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="multiuser.html#cb207-1"></a><span class="co"># This contains all data from the target user.</span></span>
<span id="cb207-2"><a href="multiuser.html#cb207-2"></a>target.data &lt;-<span class="st"> </span>df[df<span class="op">$</span>userid <span class="op">==</span><span class="st"> </span>targetUser,]</span>
<span id="cb207-3"><a href="multiuser.html#cb207-3"></a></span>
<span id="cb207-4"><a href="multiuser.html#cb207-4"></a><span class="co"># Split the target user&#39;s data into 50% adaptive</span></span>
<span id="cb207-5"><a href="multiuser.html#cb207-5"></a><span class="co"># and 50% test data.</span></span>
<span id="cb207-6"><a href="multiuser.html#cb207-6"></a>idxs &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(target.data),</span>
<span id="cb207-7"><a href="multiuser.html#cb207-7"></a>               <span class="dt">size =</span> <span class="kw">nrow</span>(target.data) <span class="op">*</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb207-8"><a href="multiuser.html#cb207-8"></a>               <span class="dt">replace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb207-9"><a href="multiuser.html#cb207-9"></a></span>
<span id="cb207-10"><a href="multiuser.html#cb207-10"></a><span class="co"># Target user adaptive set.</span></span>
<span id="cb207-11"><a href="multiuser.html#cb207-11"></a><span class="co"># This data is used to adapt the model to the target user.</span></span>
<span id="cb207-12"><a href="multiuser.html#cb207-12"></a>target.adaptive &lt;-<span class="st"> </span>target.data[idxs,]</span>
<span id="cb207-13"><a href="multiuser.html#cb207-13"></a></span>
<span id="cb207-14"><a href="multiuser.html#cb207-14"></a><span class="co"># Save target.adaptive labels in a separate variable.</span></span>
<span id="cb207-15"><a href="multiuser.html#cb207-15"></a>target.adaptive.y &lt;-<span class="st"> </span>target.adaptive<span class="op">$</span>intlabel</span>
<span id="cb207-16"><a href="multiuser.html#cb207-16"></a></span>
<span id="cb207-17"><a href="multiuser.html#cb207-17"></a><span class="co"># Save target.adaptive pixels in a separate variable.</span></span>
<span id="cb207-18"><a href="multiuser.html#cb207-18"></a>target.adaptive.x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(target.adaptive[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">301</span>,<span class="dv">302</span>,<span class="dv">303</span>)])</span>
<span id="cb207-19"><a href="multiuser.html#cb207-19"></a></span>
<span id="cb207-20"><a href="multiuser.html#cb207-20"></a><span class="co"># Target user test set.</span></span>
<span id="cb207-21"><a href="multiuser.html#cb207-21"></a><span class="co"># This data is used to test the performance.</span></span>
<span id="cb207-22"><a href="multiuser.html#cb207-22"></a>target.test &lt;-<span class="st"> </span>target.data[<span class="op">-</span>idxs,]</span>
<span id="cb207-23"><a href="multiuser.html#cb207-23"></a></span>
<span id="cb207-24"><a href="multiuser.html#cb207-24"></a><span class="co"># Save target.test labels in a separate variable.</span></span>
<span id="cb207-25"><a href="multiuser.html#cb207-25"></a>target.test.y &lt;-<span class="st"> </span>target.test<span class="op">$</span>intlabel</span>
<span id="cb207-26"><a href="multiuser.html#cb207-26"></a></span>
<span id="cb207-27"><a href="multiuser.html#cb207-27"></a><span class="co"># Save target.test pixels in a separate variable.</span></span>
<span id="cb207-28"><a href="multiuser.html#cb207-28"></a>target.test.x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(target.test[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">301</span>,<span class="dv">302</span>,<span class="dv">303</span>)])</span></code></pre></div>
<p>We also need to normalize the data and reshape it into the actual image format since in their current form, the pixels are stored into <span class="math inline">\(1\)</span>-dimensional arrays. We learn the normalization parameters only from the train set and then we used the <code>normalize.reshape()</code> function (defined in the same script file) to perform the actual normalization and formatting.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="multiuser.html#cb208-1"></a><span class="co"># Learn min and max values from train set for normalization.</span></span>
<span id="cb208-2"><a href="multiuser.html#cb208-2"></a>maxv &lt;-<span class="st"> </span><span class="kw">max</span>(train.x)</span>
<span id="cb208-3"><a href="multiuser.html#cb208-3"></a>minv &lt;-<span class="st"> </span><span class="kw">min</span>(train.x)</span>
<span id="cb208-4"><a href="multiuser.html#cb208-4"></a></span>
<span id="cb208-5"><a href="multiuser.html#cb208-5"></a><span class="co"># Normalize and reshape. May take some minutes.</span></span>
<span id="cb208-6"><a href="multiuser.html#cb208-6"></a>train.x &lt;-<span class="st"> </span><span class="kw">normalize.reshape</span>(train.x, minv, maxv)</span>
<span id="cb208-7"><a href="multiuser.html#cb208-7"></a>target.adaptive.x &lt;-<span class="st"> </span><span class="kw">normalize.reshape</span>(target.adaptive.x, minv, maxv)</span>
<span id="cb208-8"><a href="multiuser.html#cb208-8"></a>target.test.x &lt;-<span class="st"> </span><span class="kw">normalize.reshape</span>(target.test.x, minv, maxv)</span></code></pre></div>
<p>Let’s inspect how the structure of the final datasets looks like.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="multiuser.html#cb209-1"></a><span class="kw">dim</span>(train.x)</span>
<span id="cb209-2"><a href="multiuser.html#cb209-2"></a><span class="co">#&gt; [1] 6399   10   10    3</span></span>
<span id="cb209-3"><a href="multiuser.html#cb209-3"></a><span class="kw">dim</span>(target.adaptive.x)</span>
<span id="cb209-4"><a href="multiuser.html#cb209-4"></a><span class="co">#&gt; [1] 124  10  10   3</span></span>
<span id="cb209-5"><a href="multiuser.html#cb209-5"></a><span class="kw">dim</span>(target.test.x)</span>
<span id="cb209-6"><a href="multiuser.html#cb209-6"></a><span class="co">#&gt; [1] 124  10  10   3</span></span></code></pre></div>
<p>Here, we see that the train set has <span class="math inline">\(6399\)</span> instances (images). The adaptive and test sets both have <span class="math inline">\(124\)</span> instances.</p>
<p>Now that we are finally done with all the preprocessing, it is time to build the CNN model! This one will be the initial user-independent model and is trained with all the training data <code>train.x</code>, <code>train.y</code>.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="multiuser.html#cb210-1"></a>model &lt;-<span class="st"> </span><span class="kw">keras_model_sequential</span>()</span>
<span id="cb210-2"><a href="multiuser.html#cb210-2"></a></span>
<span id="cb210-3"><a href="multiuser.html#cb210-3"></a>model <span class="op">%&gt;%</span></span>
<span id="cb210-4"><a href="multiuser.html#cb210-4"></a><span class="st">  </span><span class="kw">layer_conv_2d</span>(<span class="dt">name =</span> <span class="st">&quot;conv1&quot;</span>,</span>
<span id="cb210-5"><a href="multiuser.html#cb210-5"></a>                <span class="dt">filters =</span> <span class="dv">8</span>,</span>
<span id="cb210-6"><a href="multiuser.html#cb210-6"></a>                <span class="dt">kernel_size =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb210-7"><a href="multiuser.html#cb210-7"></a>                <span class="dt">activation =</span> <span class="st">&#39;relu&#39;</span>,</span>
<span id="cb210-8"><a href="multiuser.html#cb210-8"></a>                <span class="dt">input_shape =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">3</span>)) <span class="op">%&gt;%</span></span>
<span id="cb210-9"><a href="multiuser.html#cb210-9"></a><span class="st">  </span><span class="kw">layer_conv_2d</span>(<span class="dt">name =</span> <span class="st">&quot;conv2&quot;</span>,</span>
<span id="cb210-10"><a href="multiuser.html#cb210-10"></a>                <span class="dt">filters =</span> <span class="dv">16</span>,</span>
<span id="cb210-11"><a href="multiuser.html#cb210-11"></a>                <span class="dt">kernel_size =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb210-12"><a href="multiuser.html#cb210-12"></a>                <span class="dt">activation =</span> <span class="st">&#39;relu&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb210-13"><a href="multiuser.html#cb210-13"></a><span class="st">  </span><span class="kw">layer_max_pooling_2d</span>(<span class="dt">pool_size =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb210-14"><a href="multiuser.html#cb210-14"></a><span class="st">  </span><span class="kw">layer_flatten</span>() <span class="op">%&gt;%</span></span>
<span id="cb210-15"><a href="multiuser.html#cb210-15"></a><span class="st">  </span><span class="kw">layer_dense</span>(<span class="dt">name =</span> <span class="st">&quot;hidden1&quot;</span>, <span class="dt">units =</span> <span class="dv">32</span>,</span>
<span id="cb210-16"><a href="multiuser.html#cb210-16"></a>              <span class="dt">activation =</span> <span class="st">&#39;relu&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb210-17"><a href="multiuser.html#cb210-17"></a><span class="st">  </span><span class="kw">layer_dropout</span>(<span class="fl">0.25</span>) <span class="op">%&gt;%</span></span>
<span id="cb210-18"><a href="multiuser.html#cb210-18"></a><span class="st">  </span><span class="kw">layer_dense</span>(<span class="dt">units =</span> <span class="dv">6</span>, <span class="dt">activation =</span> <span class="st">&#39;softmax&#39;</span>)</span></code></pre></div>
<p>This CNN has two convolutional layers followed by a max pooling operation, a fully connected layer, and an output layer. One important thing to note is that <strong>we have specified a name for each layer</strong> with the <code>name</code> parameter. For example, the first convolution’s name is <code>conv1</code>, the second one is <code>conv2</code>, and the fully connected layer was named <code>hidden1</code>. These names must be unique because they will allow us to later select specific layers fo freeze and unfreeze.</p>
<p>If we print the model’s summary we can see that in total it has <span class="math inline">\(9,054\)</span> <strong>trainable parameters</strong> and <span class="math inline">\(0\)</span> <strong>non-trainable parameters</strong>. This means that all the parameters of the network will be updated during the gradient descent procedure, as usual.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="multiuser.html#cb211-1"></a><span class="co"># Print summary.</span></span>
<span id="cb211-2"><a href="multiuser.html#cb211-2"></a><span class="kw">summary</span>(model)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:adaptSummary1"></span>
<img src="images/adaptive_summary.png" alt="Summary of initial user-independent model." width="90%" />
<p class="caption">
Figure 9.5: Summary of initial user-independent model.
</p>
</div>
<p>The next code will compile the model and initiate the training phase.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="multiuser.html#cb212-1"></a><span class="co"># Compile model.</span></span>
<span id="cb212-2"><a href="multiuser.html#cb212-2"></a>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">compile</span>(</span>
<span id="cb212-3"><a href="multiuser.html#cb212-3"></a>  <span class="dt">loss =</span> <span class="st">&#39;sparse_categorical_crossentropy&#39;</span>,</span>
<span id="cb212-4"><a href="multiuser.html#cb212-4"></a>  <span class="dt">optimizer =</span> <span class="kw">optimizer_sgd</span>(<span class="dt">lr =</span> <span class="fl">0.01</span>),</span>
<span id="cb212-5"><a href="multiuser.html#cb212-5"></a>  <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb212-6"><a href="multiuser.html#cb212-6"></a>)</span>
<span id="cb212-7"><a href="multiuser.html#cb212-7"></a></span>
<span id="cb212-8"><a href="multiuser.html#cb212-8"></a><span class="co"># Fit the user-independent model.</span></span>
<span id="cb212-9"><a href="multiuser.html#cb212-9"></a>history &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(</span>
<span id="cb212-10"><a href="multiuser.html#cb212-10"></a>  train.x, train.y,</span>
<span id="cb212-11"><a href="multiuser.html#cb212-11"></a>  <span class="dt">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb212-12"><a href="multiuser.html#cb212-12"></a>  <span class="dt">batch_size =</span> <span class="dv">8</span>,</span>
<span id="cb212-13"><a href="multiuser.html#cb212-13"></a>  <span class="dt">validation_split =</span> <span class="fl">0.15</span>,</span>
<span id="cb212-14"><a href="multiuser.html#cb212-14"></a>  <span class="dt">verbose =</span> <span class="dv">1</span>,</span>
<span id="cb212-15"><a href="multiuser.html#cb212-15"></a>  <span class="dt">view_metrics =</span> <span class="ot">TRUE</span></span>
<span id="cb212-16"><a href="multiuser.html#cb212-16"></a>)</span>
<span id="cb212-17"><a href="multiuser.html#cb212-17"></a></span>
<span id="cb212-18"><a href="multiuser.html#cb212-18"></a><span class="kw">plot</span>(history)</span></code></pre></div>

<div class="rmdinfo">
Note that this time the loss was defined as <code>loss = 'sparse_categorical_crossentropy'</code> instead of the usual <code>loss = 'categorical_crossentropy'</code>. Here, the <code>sparse_</code> suffix was added. You may have noted that in this example we did not one-hot encode the labels but they were only transformed into integers. By adding the <code>sparse_</code> suffix we are telling Keras that our labels are not one-hot-encoded but encoded as integers starting at <span class="math inline">\(0\)</span> so it will perform the one-hot encoding for us. This is a little trick that saved us some time.
</div>

<p><img src="images/adapt_loss1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>We save the model so we can load it later. Let’s also estimate the model’s performance on the target user test set.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="multiuser.html#cb213-1"></a><span class="co"># Save model.</span></span>
<span id="cb213-2"><a href="multiuser.html#cb213-2"></a><span class="kw">save_model_hdf5</span>(model, <span class="st">&quot;user-independent.hdf5&quot;</span>)</span>
<span id="cb213-3"><a href="multiuser.html#cb213-3"></a></span>
<span id="cb213-4"><a href="multiuser.html#cb213-4"></a><span class="co"># Compute performance (accuracy) on the target user test set.</span></span>
<span id="cb213-5"><a href="multiuser.html#cb213-5"></a>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">evaluate</span>(target.test.x, target.test.y)</span>
<span id="cb213-6"><a href="multiuser.html#cb213-6"></a><span class="co">#&gt;      loss  accuracy </span></span>
<span id="cb213-7"><a href="multiuser.html#cb213-7"></a><span class="co">#&gt; 2.1888916 0.6129032</span></span></code></pre></div>
<p>The overall <em>accuracy</em> of this user-independent model when tested on the target user was <span class="math inline">\(61.2\%\)</span> (quite low). Now, we can apply transfer learning and see if we can do better. We will ‘freeze’ the first convolution layer and only update the second convolution layer and the remaining fully connected layers using the target user-adaptive data. The following code loads the previously trained user-independent model. Then all the CNN’s weights are frozen using the <code>freeze_weights()</code> function. The <code>from</code> parameter specifies the first layer (inclusive) from which the parameters are to be frozen. Here, we set it to <span class="math inline">\(1\)</span> so all parameters in the network are ‘frozen’. Then, we can use the <code>unfreeze_weights()</code> function to specify from which layer (inclusive) the parameters should be unfrozen. In this case, we want to retrain from the second convolutional layer so we set it to <code>conv2</code> which is how we named this layer earlier.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="multiuser.html#cb214-1"></a>adaptive.model &lt;-<span class="st"> </span><span class="kw">load_model_hdf5</span>(<span class="st">&quot;user-independent.hdf5&quot;</span>)</span>
<span id="cb214-2"><a href="multiuser.html#cb214-2"></a></span>
<span id="cb214-3"><a href="multiuser.html#cb214-3"></a><span class="co"># Freeze all layers.</span></span>
<span id="cb214-4"><a href="multiuser.html#cb214-4"></a><span class="kw">freeze_weights</span>(adaptive.model, <span class="dt">from =</span> <span class="dv">1</span>)</span>
<span id="cb214-5"><a href="multiuser.html#cb214-5"></a></span>
<span id="cb214-6"><a href="multiuser.html#cb214-6"></a><span class="co"># Unfreeze layers from conv2.</span></span>
<span id="cb214-7"><a href="multiuser.html#cb214-7"></a><span class="kw">unfreeze_weights</span>(adaptive.model, <span class="dt">from =</span> <span class="st">&quot;conv2&quot;</span>)</span></code></pre></div>
<p>After defining those changes we need to compile the model so the modifications take effect.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="multiuser.html#cb215-1"></a><span class="co"># Compile model. We need to compile after freezing/unfreezing weights.</span></span>
<span id="cb215-2"><a href="multiuser.html#cb215-2"></a>adaptive.model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">compile</span>(</span>
<span id="cb215-3"><a href="multiuser.html#cb215-3"></a>  <span class="dt">loss =</span> <span class="st">&#39;sparse_categorical_crossentropy&#39;</span>,</span>
<span id="cb215-4"><a href="multiuser.html#cb215-4"></a>  <span class="dt">optimizer =</span> <span class="kw">optimizer_sgd</span>(<span class="dt">lr =</span> <span class="fl">0.01</span>),</span>
<span id="cb215-5"><a href="multiuser.html#cb215-5"></a>  <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb215-6"><a href="multiuser.html#cb215-6"></a>)</span>
<span id="cb215-7"><a href="multiuser.html#cb215-7"></a></span>
<span id="cb215-8"><a href="multiuser.html#cb215-8"></a><span class="kw">summary</span>(adaptive.model)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:adaptSummary2"></span>
<img src="images/adaptive_summary2.png" alt="Summary of user-independent model after freezing first convolutional layer." width="90%" />
<p class="caption">
Figure 9.6: Summary of user-independent model after freezing first convolutional layer.
</p>
</div>
<p>After printing the summary, now you can note that the number of <strong>trainable and non-trainable parameters</strong> has changed. Now, the non-trainable parameters are <span class="math inline">\(104\)</span> but before they were <span class="math inline">\(0\)</span>. These <span class="math inline">\(104\)</span> parameters correspond to the first convolutional layer but this time they will not be updated during the gradient descent training phase.</p>
<p>The following code will retrain the model using the adaptive data but keeping the first convolutional layer fixed.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="multiuser.html#cb216-1"></a><span class="co"># Update model with adaptive data.</span></span>
<span id="cb216-2"><a href="multiuser.html#cb216-2"></a>history &lt;-<span class="st"> </span>adaptive.model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(</span>
<span id="cb216-3"><a href="multiuser.html#cb216-3"></a>  target.adaptive.x, target.adaptive.y,</span>
<span id="cb216-4"><a href="multiuser.html#cb216-4"></a>  <span class="dt">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb216-5"><a href="multiuser.html#cb216-5"></a>  <span class="dt">batch_size =</span> <span class="dv">8</span>,</span>
<span id="cb216-6"><a href="multiuser.html#cb216-6"></a>  <span class="dt">validation_split =</span> <span class="dv">0</span>,</span>
<span id="cb216-7"><a href="multiuser.html#cb216-7"></a>  <span class="dt">verbose =</span> <span class="dv">1</span>,</span>
<span id="cb216-8"><a href="multiuser.html#cb216-8"></a>  <span class="dt">view_metrics =</span> <span class="ot">TRUE</span></span>
<span id="cb216-9"><a href="multiuser.html#cb216-9"></a>)</span></code></pre></div>

<div class="rmdcaution">
Note that this time the <code>validation_split</code> was set to <span class="math inline">\(0\)</span>. This is because the target user data set is very small so there is not enough data to use as validation set. One possible approach to overcome this is to leave a percentage of users out when building the train set for the user-independent model. Then, use those left-out users to find which are the most appropriate layers to keep frozen. Once you are happy with the results, evaluate the model with the target user.
</div>

<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="multiuser.html#cb217-1"></a><span class="co"># Compute performance (accuracy) on the target user test set.</span></span>
<span id="cb217-2"><a href="multiuser.html#cb217-2"></a>adaptive.model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">evaluate</span>(target.test.x, target.test.y)</span>
<span id="cb217-3"><a href="multiuser.html#cb217-3"></a><span class="co">#&gt;      loss  accuracy </span></span>
<span id="cb217-4"><a href="multiuser.html#cb217-4"></a><span class="co">#&gt; 0.4652017 0.8548387</span></span></code></pre></div>
<p>If we evaluate the adaptive model performance on the target’s user test set, now we see that the accuracy is <span class="math inline">\(85.4\%\)</span> which is a considerable increase! (<span class="math inline">\(\approx 24\%\)</span> increase).</p>
<p>At this point, you may be wondering that this accuracy increase was due to the fact that the model was trained for an additional <span class="math inline">\(50\)</span> epochs. To check this, we can re-train the initial user-independent model for <span class="math inline">\(50\)</span> more epochs.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="multiuser.html#cb218-1"></a>retrained_model &lt;-<span class="st"> </span><span class="kw">load_model_hdf5</span>(<span class="st">&quot;user-independent.hdf5&quot;</span>)</span>
<span id="cb218-2"><a href="multiuser.html#cb218-2"></a></span>
<span id="cb218-3"><a href="multiuser.html#cb218-3"></a><span class="co"># Fit the user-independent model for 50 more epochs.</span></span>
<span id="cb218-4"><a href="multiuser.html#cb218-4"></a>history &lt;-<span class="st"> </span>retrained_model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(</span>
<span id="cb218-5"><a href="multiuser.html#cb218-5"></a>  train.x, train.y,</span>
<span id="cb218-6"><a href="multiuser.html#cb218-6"></a>  <span class="dt">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb218-7"><a href="multiuser.html#cb218-7"></a>  <span class="dt">batch_size =</span> <span class="dv">8</span>,</span>
<span id="cb218-8"><a href="multiuser.html#cb218-8"></a>  <span class="dt">validation_split =</span> <span class="fl">0.15</span>,</span>
<span id="cb218-9"><a href="multiuser.html#cb218-9"></a>  <span class="dt">verbose =</span> <span class="dv">1</span>,</span>
<span id="cb218-10"><a href="multiuser.html#cb218-10"></a>  <span class="dt">view_metrics =</span> <span class="ot">TRUE</span></span>
<span id="cb218-11"><a href="multiuser.html#cb218-11"></a>)</span>
<span id="cb218-12"><a href="multiuser.html#cb218-12"></a></span>
<span id="cb218-13"><a href="multiuser.html#cb218-13"></a><span class="co"># Compute performance (accuracy) on the target user test set.</span></span>
<span id="cb218-14"><a href="multiuser.html#cb218-14"></a>retrained_model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">evaluate</span>(target.test.x, target.test.y)</span>
<span id="cb218-15"><a href="multiuser.html#cb218-15"></a><span class="co">#&gt;      loss  accuracy </span></span>
<span id="cb218-16"><a href="multiuser.html#cb218-16"></a><span class="co">#&gt; 2.7197671 0.6612903 </span></span></code></pre></div>
<p>After re-training the user-independent model for <span class="math inline">\(50\)</span> more epochs, its <em>accuracy</em> increased to <span class="math inline">\(66.1\%\)</span>. On the other hand, the adaptive model was trained with much less data and produced a much better result (<span class="math inline">\(85.4%\)</span>) with only <span class="math inline">\(124\)</span> instances as compared to the user-independent model <span class="math inline">\(\approx 5440\)</span> instances. That is, the <span class="math inline">\(6399\)</span> instances minus <span class="math inline">\(15\%\)</span> used as the validation set. This also highlights one of the advantages of transfer learning which is a reduction in the needed amount of training data.</p>
</div>
</div>
<div id="SummaryMultiUser" class="section level2">
<h2><span class="header-section-number">9.5</span> Summary</h2>
<p>Many real-life scenarios involve multi-user settings. That is, the system heavily depends on the specific behavior of a given final user. This chapter covered different types of models that can be used to evaluate the performance of a system in such a scenario.</p>
<ul>
<li>A <strong>multi-user setting</strong> is one in which its results depend heavily on the target user.</li>
<li>Inter/Intra -user variance are the differences between users and within the same users, respectively.</li>
<li><strong>Mixed models</strong> are trained without considering unique users (user ids) information.</li>
<li><strong>User-independent models</strong> are trained without including data from the <em>target user</em>.</li>
<li><strong>User-dependent models</strong> are trained only with data from the <em>target user</em>.</li>
<li><strong>User-adaptive models</strong> can be adapted to a particular <em>target user</em> as more data is available.</li>
<li><strong>Transfer learning</strong> is a method that can be used to adapt a model to a particular user without requiring big quantities of data.</li>
</ul>
<p><img src="images/comic_opera.png" width="100%" style="display: block; margin: auto;" />
</p>


</div>
</div>



<h3>References</h3>
<div id="refs" class="references">
<div id="ref-rmatlab">
<p>Bengtsson, Henrik. 2018. <em>R.matlab: Read and Write Mat Files and Call Matlab from Within R</em>. <a href="https://CRAN.R-project.org/package=R.matlab">https://CRAN.R-project.org/package=R.matlab</a>.</p>
</div>
<div id="ref-chen2015utd">
<p>Chen, Chen, Roozbeh Jafari, and Nasser Kehtarnavaz. 2015. “UTD-Mhad: A Multimodal Dataset for Human Action Recognition Utilizing a Depth Camera and a Wearable Inertial Sensor.” In <em>2015 Ieee International Conference on Image Processing (Icip)</em>, 168–72. IEEE.</p>
</div>
<div id="ref-pratt1991">
<p>Pratt, Lorien Y, Jack Mostow, Candace A Kamm, and Ace A Kamm. 1991. “Direct Transfer of Learned Information Among Neural Networks.” In <em>Aaai</em>, 91:584–89.</p>
</div>
<div id="ref-simonyan2014">
<p>Simonyan, Karen, and Andrew Zisserman. 2014. “Very Deep Convolutional Networks for Large-Scale Image Recognition.” <em>arXiv Preprint arXiv:1409.1556</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="deeplearning.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendixInstall.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
