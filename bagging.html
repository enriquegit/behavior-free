<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.1 Bagging | Behavior Analysis with Machine Learning and R</title>
  <meta name="description" content="3.1 Bagging | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors or stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="3.1 Bagging | Behavior Analysis with Machine Learning and R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="3.1 Bagging | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors or stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.1 Bagging | Behavior Analysis with Machine Learning and R" />
  
  <meta name="twitter:description" content="3.1 Bagging | Behavior Analysis with Machine Learning and R teaches you how to train machine learning models in the R programming language to make sense of behavioral data collected with sensors or stored in electronic records. This book introduces machine learning concepts and algorithms applied to a diverse set of behavior analysis problems by focusing on practical aspects. Some of the topics include how to: Build supervised models to predict indoor locations based on Wi-Fi signals, recognize physical activities from smartphone sensors, use unsupervised learning to discover criminal behavioral patterns, build deep learning models to analyze electromyography signals, CNNs to detect smiles in images and much more." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Enrique Garcia Ceja" />


<meta name="date" content="2020-09-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ensemble.html"/>
<link rel="next" href="random-forest.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/d3-4.9.0/d3.min.js"></script>
<script src="libs/d3-tip-0.7.1/index-min.js"></script>
<link href="libs/d3panels-1.4.9/d3panels.min.css" rel="stylesheet" />
<script src="libs/d3panels-1.4.9/d3panels.min.js"></script>
<script src="libs/qtlcharts_iplotCorr-0.11.6/iplotCorr.js"></script>
<script src="libs/qtlcharts_iplotCorr-0.11.6/iplotCorr_noscat.js"></script>
<script src="libs/iplotCorr-binding-0.11.6/iplotCorr.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-178679335-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178679335-1', { 'anonymize_ip': true });
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="#">Behavior Analysis with Machine Learning and R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#supplemental-material"><i class="fa fa-check"></i>Supplemental Material</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html"><i class="fa fa-check"></i><b>1.1</b> What is Machine Learning?</a></li>
<li class="chapter" data-level="1.2" data-path="taxonomy.html"><a href="taxonomy.html"><i class="fa fa-check"></i><b>1.2</b> Types of Machine Learning</a></li>
<li class="chapter" data-level="1.3" data-path="terminology.html"><a href="terminology.html"><i class="fa fa-check"></i><b>1.3</b> Terminology</a><ul>
<li class="chapter" data-level="1.3.1" data-path="terminology.html"><a href="terminology.html#tables"><i class="fa fa-check"></i><b>1.3.1</b> Tables</a></li>
<li class="chapter" data-level="1.3.2" data-path="terminology.html"><a href="terminology.html#variable-types"><i class="fa fa-check"></i><b>1.3.2</b> Variable types</a></li>
<li class="chapter" data-level="1.3.3" data-path="terminology.html"><a href="terminology.html#predictive-models"><i class="fa fa-check"></i><b>1.3.3</b> Predictive Models</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="pipeline.html"><a href="pipeline.html"><i class="fa fa-check"></i><b>1.4</b> Data Analysis Pipeline</a></li>
<li class="chapter" data-level="1.5" data-path="trainingeval.html"><a href="trainingeval.html"><i class="fa fa-check"></i><b>1.5</b> Evaluating Predictive Models</a></li>
<li class="chapter" data-level="1.6" data-path="simple-classification-example.html"><a href="simple-classification-example.html"><i class="fa fa-check"></i><b>1.6</b> Simple Classification Example</a><ul>
<li class="chapter" data-level="1.6.1" data-path="simple-classification-example.html"><a href="simple-classification-example.html#k-fold-cross-validation-example"><i class="fa fa-check"></i><b>1.6.1</b> K-fold Cross-Validation Example</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="simple-regression-example.html"><a href="simple-regression-example.html"><i class="fa fa-check"></i><b>1.7</b> Simple Regression Example</a></li>
<li class="chapter" data-level="1.8" data-path="underfitting-and-overfitting.html"><a href="underfitting-and-overfitting.html"><i class="fa fa-check"></i><b>1.8</b> Underfitting and Overfitting</a></li>
<li class="chapter" data-level="1.9" data-path="bias-and-variance.html"><a href="bias-and-variance.html"><i class="fa fa-check"></i><b>1.9</b> Bias and Variance</a></li>
<li class="chapter" data-level="1.10" data-path="SummaryIntro.html"><a href="SummaryIntro.html"><i class="fa fa-check"></i><b>1.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>2</b> Predicting Behavior with Classification Models</a><ul>
<li class="chapter" data-level="2.1" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html"><i class="fa fa-check"></i><b>2.1</b> <em>k</em>-nearest Neighbors</a><ul>
<li class="chapter" data-level="2.1.1" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html#indoor-location-with-wi-fi-signals"><i class="fa fa-check"></i><b>2.1.1</b> Indoor Location with Wi-Fi Signals</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="performance-metrics.html"><a href="performance-metrics.html"><i class="fa fa-check"></i><b>2.2</b> Performance Metrics</a></li>
<li class="chapter" data-level="2.3" data-path="decision-trees.html"><a href="decision-trees.html"><i class="fa fa-check"></i><b>2.3</b> Decision Trees</a><ul>
<li class="chapter" data-level="2.3.1" data-path="decision-trees.html"><a href="decision-trees.html#activityRecognition"><i class="fa fa-check"></i><b>2.3.1</b> Activity Recognition with Smartphones</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="dynamic-time-warping.html"><a href="dynamic-time-warping.html"><i class="fa fa-check"></i><b>2.4</b> Dynamic Time Warping</a><ul>
<li class="chapter" data-level="2.4.1" data-path="dynamic-time-warping.html"><a href="dynamic-time-warping.html#sechandgestures"><i class="fa fa-check"></i><b>2.4.1</b> Hand Gesture Recognition</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="summaryClassification.html"><a href="summaryClassification.html"><i class="fa fa-check"></i><b>2.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ensemble.html"><a href="ensemble.html"><i class="fa fa-check"></i><b>3</b> Predicting Behavior with Ensemble Learning</a><ul>
<li class="chapter" data-level="3.1" data-path="bagging.html"><a href="bagging.html"><i class="fa fa-check"></i><b>3.1</b> Bagging</a><ul>
<li class="chapter" data-level="3.1.1" data-path="bagging.html"><a href="bagging.html#activity-recognition-with-bagging"><i class="fa fa-check"></i><b>3.1.1</b> Activity recognition with Bagging</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="random-forest.html"><a href="random-forest.html"><i class="fa fa-check"></i><b>3.2</b> Random Forest</a></li>
<li class="chapter" data-level="3.3" data-path="stacked-generalization.html"><a href="stacked-generalization.html"><i class="fa fa-check"></i><b>3.3</b> Stacked Generalization</a></li>
<li class="chapter" data-level="3.4" data-path="multiviewhometasks.html"><a href="multiviewhometasks.html"><i class="fa fa-check"></i><b>3.4</b> Multi-view Stacking for Home Tasks Recognition</a></li>
<li class="chapter" data-level="3.5" data-path="SummaryEnsemble.html"><a href="SummaryEnsemble.html"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="edavis.html"><a href="edavis.html"><i class="fa fa-check"></i><b>4</b> Exploring and Visualizing Behavioral Data</a><ul>
<li class="chapter" data-level="4.1" data-path="talking-with-field-experts.html"><a href="talking-with-field-experts.html"><i class="fa fa-check"></i><b>4.1</b> Talking with field experts</a></li>
<li class="chapter" data-level="4.2" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>4.2</b> Summary Statistics</a></li>
<li class="chapter" data-level="4.3" data-path="class-distributions.html"><a href="class-distributions.html"><i class="fa fa-check"></i><b>4.3</b> Class Distributions</a></li>
<li class="chapter" data-level="4.4" data-path="user-class-sparsity-matrix.html"><a href="user-class-sparsity-matrix.html"><i class="fa fa-check"></i><b>4.4</b> User-Class Sparsity Matrix</a></li>
<li class="chapter" data-level="4.5" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>4.5</b> Boxplots</a></li>
<li class="chapter" data-level="4.6" data-path="correlation-plots.html"><a href="correlation-plots.html"><i class="fa fa-check"></i><b>4.6</b> Correlation Plots</a><ul>
<li class="chapter" data-level="4.6.1" data-path="correlation-plots.html"><a href="correlation-plots.html#interactive-correlation-plots"><i class="fa fa-check"></i><b>4.6.1</b> Interactive Correlation Plots</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="timeseries.html"><a href="timeseries.html"><i class="fa fa-check"></i><b>4.7</b> Timeseries</a><ul>
<li class="chapter" data-level="4.7.1" data-path="timeseries.html"><a href="timeseries.html#interactive-timeseries"><i class="fa fa-check"></i><b>4.7.1</b> Interactive Timeseries</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="multidimensional-scaling-mds.html"><a href="multidimensional-scaling-mds.html"><i class="fa fa-check"></i><b>4.8</b> Multidimensional Scaling (MDS)</a></li>
<li class="chapter" data-level="4.9" data-path="heatmaps.html"><a href="heatmaps.html"><i class="fa fa-check"></i><b>4.9</b> Heatmaps</a></li>
<li class="chapter" data-level="4.10" data-path="automated-eda.html"><a href="automated-eda.html"><i class="fa fa-check"></i><b>4.10</b> Automated EDA</a></li>
<li class="chapter" data-level="4.11" data-path="SummaryExploratory.html"><a href="SummaryExploratory.html"><i class="fa fa-check"></i><b>4.11</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i><b>5</b> Preprocessing Behavioral Data</a><ul>
<li class="chapter" data-level="5.1" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>5.1</b> Missing Values</a><ul>
<li class="chapter" data-level="5.1.1" data-path="missing-values.html"><a href="missing-values.html#imputation"><i class="fa fa-check"></i><b>5.1.1</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="smoothing.html"><a href="smoothing.html"><i class="fa fa-check"></i><b>5.2</b> Smoothing</a></li>
<li class="chapter" data-level="5.3" data-path="normalization.html"><a href="normalization.html"><i class="fa fa-check"></i><b>5.3</b> Normalization</a></li>
<li class="chapter" data-level="5.4" data-path="imbalanced-classes.html"><a href="imbalanced-classes.html"><i class="fa fa-check"></i><b>5.4</b> Imbalanced Classes</a><ul>
<li class="chapter" data-level="5.4.1" data-path="imbalanced-classes.html"><a href="imbalanced-classes.html#random-oversampling"><i class="fa fa-check"></i><b>5.4.1</b> Random oversampling</a></li>
<li class="chapter" data-level="5.4.2" data-path="imbalanced-classes.html"><a href="imbalanced-classes.html#smote"><i class="fa fa-check"></i><b>5.4.2</b> SMOTE</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="infoinjection.html"><a href="infoinjection.html"><i class="fa fa-check"></i><b>5.5</b> Information Injection</a></li>
<li class="chapter" data-level="5.6" data-path="one-hot-encoding.html"><a href="one-hot-encoding.html"><i class="fa fa-check"></i><b>5.6</b> One-hot Encoding</a></li>
<li class="chapter" data-level="5.7" data-path="SummaryPreprocessing.html"><a href="SummaryPreprocessing.html"><i class="fa fa-check"></i><b>5.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="unsupervised.html"><a href="unsupervised.html"><i class="fa fa-check"></i><b>6</b> Discovering Behaviors with Unsupervised Learning</a><ul>
<li class="chapter" data-level="6.1" data-path="k-means-clustering.html"><a href="k-means-clustering.html"><i class="fa fa-check"></i><b>6.1</b> K-means clustering</a><ul>
<li class="chapter" data-level="6.1.1" data-path="k-means-clustering.html"><a href="k-means-clustering.html#studentresponses"><i class="fa fa-check"></i><b>6.1.1</b> Grouping Student Responses</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-silhouette-index.html"><a href="the-silhouette-index.html"><i class="fa fa-check"></i><b>6.2</b> The Silhouette Index</a></li>
<li class="chapter" data-level="6.3" data-path="associationrules.html"><a href="associationrules.html"><i class="fa fa-check"></i><b>6.3</b> Mining Association Rules</a><ul>
<li class="chapter" data-level="6.3.1" data-path="associationrules.html"><a href="associationrules.html#finding-rules-for-criminal-behavior"><i class="fa fa-check"></i><b>6.3.1</b> Finding Rules for Criminal Behavior</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="SummaryUnsupervised.html"><a href="SummaryUnsupervised.html"><i class="fa fa-check"></i><b>6.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="representations.html"><a href="representations.html"><i class="fa fa-check"></i><b>7</b> Encoding Behavioral Data</a><ul>
<li class="chapter" data-level="7.1" data-path="feature-vectors.html"><a href="feature-vectors.html"><i class="fa fa-check"></i><b>7.1</b> Feature Vectors</a></li>
<li class="chapter" data-level="7.2" data-path="sectimeseries.html"><a href="sectimeseries.html"><i class="fa fa-check"></i><b>7.2</b> Timeseries</a></li>
<li class="chapter" data-level="7.3" data-path="transactions.html"><a href="transactions.html"><i class="fa fa-check"></i><b>7.3</b> Transactions</a></li>
<li class="chapter" data-level="7.4" data-path="images.html"><a href="images.html"><i class="fa fa-check"></i><b>7.4</b> Images</a></li>
<li class="chapter" data-level="7.5" data-path="recurrence-plots.html"><a href="recurrence-plots.html"><i class="fa fa-check"></i><b>7.5</b> Recurrence Plots</a><ul>
<li class="chapter" data-level="7.5.1" data-path="recurrence-plots.html"><a href="recurrence-plots.html#computing-recurence-plots"><i class="fa fa-check"></i><b>7.5.1</b> Computing Recurence Plots</a></li>
<li class="chapter" data-level="7.5.2" data-path="recurrence-plots.html"><a href="recurrence-plots.html#recurrence-plots-of-hand-gestures"><i class="fa fa-check"></i><b>7.5.2</b> Recurrence Plots of Hand Gestures</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="bag-of-words.html"><a href="bag-of-words.html"><i class="fa fa-check"></i><b>7.6</b> Bag-of-Words</a><ul>
<li class="chapter" data-level="7.6.1" data-path="bag-of-words.html"><a href="bag-of-words.html#bow-for-complex-activities."><i class="fa fa-check"></i><b>7.6.1</b> BoW for Complex Activities.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>7.7</b> Graphs</a><ul>
<li class="chapter" data-level="7.7.1" data-path="graphs.html"><a href="graphs.html#complex-activities-as-graphs"><i class="fa fa-check"></i><b>7.7.1</b> Complex activities as graphs</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="SummaryRepresentations.html"><a href="SummaryRepresentations.html"><i class="fa fa-check"></i><b>7.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="deeplearning.html"><a href="deeplearning.html"><i class="fa fa-check"></i><b>8</b> Predicting Behavior with Deep Learning</a><ul>
<li class="chapter" data-level="8.1" data-path="ann.html"><a href="ann.html"><i class="fa fa-check"></i><b>8.1</b> Introduction to Artificial Neural Networks</a><ul>
<li class="chapter" data-level="8.1.1" data-path="ann.html"><a href="ann.html#sigmoid-and-relu-units"><i class="fa fa-check"></i><b>8.1.1</b> Sigmoid and ReLU units</a></li>
<li class="chapter" data-level="8.1.2" data-path="ann.html"><a href="ann.html#assembling-units-into-layers"><i class="fa fa-check"></i><b>8.1.2</b> Assembling Units into Layers</a></li>
<li class="chapter" data-level="8.1.3" data-path="ann.html"><a href="ann.html#deep-neural-networks"><i class="fa fa-check"></i><b>8.1.3</b> Deep Neural Networks</a></li>
<li class="chapter" data-level="8.1.4" data-path="ann.html"><a href="ann.html#learning-the-parameters"><i class="fa fa-check"></i><b>8.1.4</b> Learning the Parameters</a></li>
<li class="chapter" data-level="8.1.5" data-path="ann.html"><a href="ann.html#parameter-learning-example-in-r"><i class="fa fa-check"></i><b>8.1.5</b> Parameter Learning Example in R</a></li>
<li class="chapter" data-level="8.1.6" data-path="ann.html"><a href="ann.html#stochastic-gradient-descent"><i class="fa fa-check"></i><b>8.1.6</b> Stochastic Gradient Descent</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="keras-and-tensorflow-with-r.html"><a href="keras-and-tensorflow-with-r.html"><i class="fa fa-check"></i><b>8.2</b> Keras and TensorFlow with R</a><ul>
<li class="chapter" data-level="8.2.1" data-path="keras-and-tensorflow-with-r.html"><a href="keras-and-tensorflow-with-r.html#keras-example"><i class="fa fa-check"></i><b>8.2.1</b> Keras Example</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="classification-with-neural-networks.html"><a href="classification-with-neural-networks.html"><i class="fa fa-check"></i><b>8.3</b> Classification with Neural Networks</a><ul>
<li class="chapter" data-level="8.3.1" data-path="classification-with-neural-networks.html"><a href="classification-with-neural-networks.html#classification-of-electromyography-signals"><i class="fa fa-check"></i><b>8.3.1</b> Classification of Electromyography Signals</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="overfitting.html"><a href="overfitting.html"><i class="fa fa-check"></i><b>8.4</b> Overfitting</a><ul>
<li class="chapter" data-level="8.4.1" data-path="overfitting.html"><a href="overfitting.html#early-stopping"><i class="fa fa-check"></i><b>8.4.1</b> Early Stopping</a></li>
<li class="chapter" data-level="8.4.2" data-path="overfitting.html"><a href="overfitting.html#dropout"><i class="fa fa-check"></i><b>8.4.2</b> Dropout</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="fine-tuning-a-neural-network.html"><a href="fine-tuning-a-neural-network.html"><i class="fa fa-check"></i><b>8.5</b> Fine-Tuning a Neural Network</a></li>
<li class="chapter" data-level="8.6" data-path="cnns.html"><a href="cnns.html"><i class="fa fa-check"></i><b>8.6</b> Convolutional Neural Networks</a><ul>
<li class="chapter" data-level="8.6.1" data-path="cnns.html"><a href="cnns.html#convolutions"><i class="fa fa-check"></i><b>8.6.1</b> Convolutions</a></li>
<li class="chapter" data-level="8.6.2" data-path="cnns.html"><a href="cnns.html#pooling-operations"><i class="fa fa-check"></i><b>8.6.2</b> Pooling Operations</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="cnns-with-keras.html"><a href="cnns-with-keras.html"><i class="fa fa-check"></i><b>8.7</b> CNNs with Keras</a><ul>
<li class="chapter" data-level="8.7.1" data-path="cnns-with-keras.html"><a href="cnns-with-keras.html#example-1"><i class="fa fa-check"></i><b>8.7.1</b> Example 1</a></li>
<li class="chapter" data-level="8.7.2" data-path="cnns-with-keras.html"><a href="cnns-with-keras.html#example-2"><i class="fa fa-check"></i><b>8.7.2</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="cnnSmile.html"><a href="cnnSmile.html"><i class="fa fa-check"></i><b>8.8</b> Smiles Detection with a CNN</a></li>
<li class="chapter" data-level="8.9" data-path="SummaryDeepLearning.html"><a href="SummaryDeepLearning.html"><i class="fa fa-check"></i><b>8.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="multiuser.html"><a href="multiuser.html"><i class="fa fa-check"></i><b>9</b> Multi-User Validation</a><ul>
<li class="chapter" data-level="9.1" data-path="mixed-models.html"><a href="mixed-models.html"><i class="fa fa-check"></i><b>9.1</b> Mixed Models</a><ul>
<li class="chapter" data-level="9.1.1" data-path="mixed-models.html"><a href="mixed-models.html#skeleton-action-recognition-with-mixed-models"><i class="fa fa-check"></i><b>9.1.1</b> Skeleton Action Recognition with Mixed Models</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="user-independent-models.html"><a href="user-independent-models.html"><i class="fa fa-check"></i><b>9.2</b> User-Independent Models</a></li>
<li class="chapter" data-level="9.3" data-path="user-dependent-models.html"><a href="user-dependent-models.html"><i class="fa fa-check"></i><b>9.3</b> User-Dependent Models</a></li>
<li class="chapter" data-level="9.4" data-path="user-adaptive-models.html"><a href="user-adaptive-models.html"><i class="fa fa-check"></i><b>9.4</b> User-Adaptive Models</a><ul>
<li class="chapter" data-level="9.4.1" data-path="user-adaptive-models.html"><a href="user-adaptive-models.html#transfer-learning"><i class="fa fa-check"></i><b>9.4.1</b> Transfer Learning</a></li>
<li class="chapter" data-level="9.4.2" data-path="user-adaptive-models.html"><a href="user-adaptive-models.html#a-user-adaptive-model-for-activity-recognition"><i class="fa fa-check"></i><b>9.4.2</b> A User-Adaptive Model for Activity Recognition</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="SummaryMultiUser.html"><a href="SummaryMultiUser.html"><i class="fa fa-check"></i><b>9.5</b> Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendixInstall.html"><a href="appendixInstall.html"><i class="fa fa-check"></i><b>A</b> Setup Your Environment</a><ul>
<li class="chapter" data-level="A.1" data-path="installing-the-datasets.html"><a href="installing-the-datasets.html"><i class="fa fa-check"></i><b>A.1</b> Installing the Datasets</a></li>
<li class="chapter" data-level="A.2" data-path="installing-the-examples-source-code.html"><a href="installing-the-examples-source-code.html"><i class="fa fa-check"></i><b>A.2</b> Installing the Examples Source Code</a></li>
<li class="chapter" data-level="A.3" data-path="installing-keras-and-tensorflow-.html"><a href="installing-keras-and-tensorflow-.html"><i class="fa fa-check"></i><b>A.3</b> Installing Keras and TensorFlow.</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendixDatasets.html"><a href="appendixDatasets.html"><i class="fa fa-check"></i><b>B</b> Datasets</a><ul>
<li class="chapter" data-level="B.1" data-path="complex-activities.html"><a href="complex-activities.html"><i class="fa fa-check"></i><b>B.1</b> COMPLEX ACTIVITIES</a></li>
<li class="chapter" data-level="B.2" data-path="depresjon.html"><a href="depresjon.html"><i class="fa fa-check"></i><b>B.2</b> DEPRESJON</a></li>
<li class="chapter" data-level="B.3" data-path="electromyography.html"><a href="electromyography.html"><i class="fa fa-check"></i><b>B.3</b> ELECTROMYOGRAPHY</a></li>
<li class="chapter" data-level="B.4" data-path="hand-gestures.html"><a href="hand-gestures.html"><i class="fa fa-check"></i><b>B.4</b> HAND GESTURES</a></li>
<li class="chapter" data-level="B.5" data-path="home-tasks.html"><a href="home-tasks.html"><i class="fa fa-check"></i><b>B.5</b> HOME TASKS</a></li>
<li class="chapter" data-level="B.6" data-path="homicide-reports.html"><a href="homicide-reports.html"><i class="fa fa-check"></i><b>B.6</b> HOMICIDE REPORTS</a></li>
<li class="chapter" data-level="B.7" data-path="indoor-location.html"><a href="indoor-location.html"><i class="fa fa-check"></i><b>B.7</b> INDOOR LOCATION</a></li>
<li class="chapter" data-level="B.8" data-path="sheep-goats.html"><a href="sheep-goats.html"><i class="fa fa-check"></i><b>B.8</b> SHEEP GOATS</a></li>
<li class="chapter" data-level="B.9" data-path="skeleton-actions.html"><a href="skeleton-actions.html"><i class="fa fa-check"></i><b>B.9</b> SKELETON ACTIONS</a></li>
<li class="chapter" data-level="B.10" data-path="smartphone-activities.html"><a href="smartphone-activities.html"><i class="fa fa-check"></i><b>B.10</b> SMARTPHONE ACTIVITIES</a></li>
<li class="chapter" data-level="B.11" data-path="smiles.html"><a href="smiles.html"><i class="fa fa-check"></i><b>B.11</b> SMILES</a></li>
<li class="chapter" data-level="B.12" data-path="students-mental-health.html"><a href="students-mental-health.html"><i class="fa fa-check"></i><b>B.12</b> STUDENTS’ MENTAL HEALTH</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="citing-this-book.html"><a href="citing-this-book.html"><i class="fa fa-check"></i>Citing this Book</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Behavior Analysis with Machine Learning and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bagging" class="section level2">
<h2><span class="header-section-number">3.1</span> Bagging</h2>
<p>Bagging stands for “bootstrap aggregating” and is an ensemble learning method proposed by <span class="citation">Breiman (<a href="#ref-breimanBagging1996" role="doc-biblioref">1996</a>)</span>. Ummm…, <em>Bootstrap</em>, <em>aggregating</em>? Let’s start with the <em>aggregating</em> part. As the name implies, this method is based on training several <em>base learners</em> (e.g., decision trees) and combining their outputs to produce a single final prediction. One way to combine the results is by taking the majority vote for classification tasks or the average for regression. In an ideal case, we would have enough data to train each <em>base learner</em> with an independent train set. However, in practice we may only have a single train set of limited size. Training several <em>base learners</em> with the same train set is equivalent to having a single learner, provided that the training procedure of the base learners is deterministic. Even if the training procedure is not deterministic, the resulting models could be very similar. What we would like to have is accurate base learners but at the same time they should be different. Then, how can we train those base learners? Well, this is where the <em>bootstrap</em> part comes into play.</p>
<p>Bootstrapping means generating new train sets by sampling instances with replacement from the original train set. If the original train set has <span class="math inline">\(N\)</span> instances, the method selects <span class="math inline">\(N\)</span> instances at random to produce a new train set. <em>With replacement</em> means that repeated instances are allowed. This has the effect of generating a new train set of size <span class="math inline">\(N\)</span> by removing some instances and duplicating other instances. By using this method, <span class="math inline">\(n\)</span> different train sets can be generated and used to train <span class="math inline">\(n\)</span> different learners.</p>
<p>It has been shown that having more diverse base learners increases performance. One way of generating diverse learners is by using different train sets as just described. In his original work, <span class="citation">Breiman (<a href="#ref-breimanBagging1996" role="doc-biblioref">1996</a>)</span> used decision trees as base learners. Decision trees are considered to be very unstable. This means that small changes in the train set produce very different trees–but this is a good thing for bagging! Most of the time, the aggregated predictions will produce better results than the best individual learner from the ensemble.</p>
<p>Figure <a href="bagging.html#fig:baggingexample">3.1</a> shows bootstrapping in action. The train set is sampled with replacement <span class="math inline">\(3\)</span> times. The numbers represent indices to arbitrary train instances. Here, we can see that in the first sample, the instance number <span class="math inline">\(5\)</span> is missing but instead, instance <span class="math inline">\(2\)</span> is duplicated. All samples have five elements. Then, each sample is used to train individual decision trees.</p>
<div class="figure" style="text-align: center"><span id="fig:baggingexample"></span>
<img src="images/bagging.png" alt="Bagging example." width="70%" />
<p class="caption">
Figure 3.1: Bagging example.
</p>
</div>
<p>One of the disadvantages of ensemble methods is their higher computational time both during training and inference. Another disadvantage of ensemble methods is that they are more difficult to interpret. Still, there exist model agnostic interpretability methods <span class="citation">(Molnar <a href="#ref-molnarInterpretable" role="doc-biblioref">2019</a>)</span> that can help to analyze the results. In the next section, I will show you how to implement your own Bagging model with decision trees in R.</p>
<div id="activity-recognition-with-bagging" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Activity recognition with Bagging</h3>

<div class="rmdfolder">
<code>bagging_activities.R</code> <code>iterated_bagging_activities.R</code>
</div>

<p>In this section, we will implement Bagging with decision trees. Then, we will test our implementation on the <em>SMARTPHONE ACTIVITIES</em> dataset. The following code snippet shows the implementation of <code>my_bagging()</code> function. The complete code is in the script <code>bagging_activities.R</code>. The function accepts three arguments. The first one is the formula, the second one is the train set, and the third argument is the number of base learners (<span class="math inline">\(10\)</span> by default). Here, we will use the <code>rpart</code> package to train the decision trees.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="bagging.html#cb47-1"></a><span class="co"># Define our bagging classifier.</span></span>
<span id="cb47-2"><a href="bagging.html#cb47-2"></a>my_bagging &lt;-<span class="st"> </span><span class="cf">function</span>(theFormula, data, <span class="dt">ntrees =</span> <span class="dv">10</span>){</span>
<span id="cb47-3"><a href="bagging.html#cb47-3"></a>  </span>
<span id="cb47-4"><a href="bagging.html#cb47-4"></a>  N &lt;-<span class="st"> </span><span class="kw">nrow</span>(data)</span>
<span id="cb47-5"><a href="bagging.html#cb47-5"></a>  </span>
<span id="cb47-6"><a href="bagging.html#cb47-6"></a>  <span class="co"># A list to store the individual trees</span></span>
<span id="cb47-7"><a href="bagging.html#cb47-7"></a>  models &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb47-8"><a href="bagging.html#cb47-8"></a>  </span>
<span id="cb47-9"><a href="bagging.html#cb47-9"></a>  <span class="co"># Train individual trees and add each to &#39;models&#39; list.</span></span>
<span id="cb47-10"><a href="bagging.html#cb47-10"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ntrees){</span>
<span id="cb47-11"><a href="bagging.html#cb47-11"></a>    </span>
<span id="cb47-12"><a href="bagging.html#cb47-12"></a>    <span class="co"># Bootstrap instances from data.</span></span>
<span id="cb47-13"><a href="bagging.html#cb47-13"></a>    idxs &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>N, <span class="dt">size =</span> N, <span class="dt">replace =</span> T)</span>
<span id="cb47-14"><a href="bagging.html#cb47-14"></a>    </span>
<span id="cb47-15"><a href="bagging.html#cb47-15"></a>    bootstrappedInstances &lt;-<span class="st"> </span>data[idxs,]</span>
<span id="cb47-16"><a href="bagging.html#cb47-16"></a>    </span>
<span id="cb47-17"><a href="bagging.html#cb47-17"></a>    treeModel &lt;-<span class="st"> </span><span class="kw">rpart</span>(<span class="kw">as.formula</span>(theFormula),</span>
<span id="cb47-18"><a href="bagging.html#cb47-18"></a>                       bootstrappedInstances,</span>
<span id="cb47-19"><a href="bagging.html#cb47-19"></a>                       <span class="dt">xval =</span> <span class="dv">0</span>,</span>
<span id="cb47-20"><a href="bagging.html#cb47-20"></a>                       <span class="dt">cp =</span> <span class="dv">0</span>)</span>
<span id="cb47-21"><a href="bagging.html#cb47-21"></a>    </span>
<span id="cb47-22"><a href="bagging.html#cb47-22"></a>    models &lt;-<span class="st"> </span><span class="kw">c</span>(models, <span class="kw">list</span>(treeModel))</span>
<span id="cb47-23"><a href="bagging.html#cb47-23"></a>  }</span>
<span id="cb47-24"><a href="bagging.html#cb47-24"></a>  </span>
<span id="cb47-25"><a href="bagging.html#cb47-25"></a>  res &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">list</span>(<span class="dt">models =</span> models),</span>
<span id="cb47-26"><a href="bagging.html#cb47-26"></a>                   <span class="dt">class =</span> <span class="st">&quot;my_bagging&quot;</span>)</span>
<span id="cb47-27"><a href="bagging.html#cb47-27"></a>  </span>
<span id="cb47-28"><a href="bagging.html#cb47-28"></a>  <span class="kw">return</span>(res)</span>
<span id="cb47-29"><a href="bagging.html#cb47-29"></a>}</span></code></pre></div>
<p>First, a list that will store each individual learner is defined <code>models &lt;- list()</code>. Then, the function iterates <code>ntrees</code> times. In each iteration, a bootstrapped train set is generated and used to train a <code>rpart</code> model. The <code>xval = 0</code> parameter tells rpart not to perform cross-validation internally. The <code>cp</code> parameter is also set to <span class="math inline">\(0\)</span>. This value controls the amount of pruning. The default is <span class="math inline">\(0.01\)</span> leading to smaller trees. This makes the trees to be more similar but since we want diversity we are setting this to <span class="math inline">\(0\)</span> so bigger trees are generated and as a consequence, more diverse.</p>
<p>Finally, an object of class <code>"my_bagging"</code> is returned. This is just a list containing the trained base learners. The <code>class = "my_bagging"</code> argument is important. This tells R that this object is of type <code>my_bagging</code>. Setting the class will allow us to use the generic <code>predict()</code> function and R will automatically call the corresponding <code>predict.my_bagging()</code> function which we will shortly define. The class name and the function name after <code>predict.</code> need to be the same.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="bagging.html#cb48-1"></a><span class="co"># Define the predict function for my_bagging.</span></span>
<span id="cb48-2"><a href="bagging.html#cb48-2"></a>predict.my_bagging &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata){</span>
<span id="cb48-3"><a href="bagging.html#cb48-3"></a>  </span>
<span id="cb48-4"><a href="bagging.html#cb48-4"></a>  ntrees &lt;-<span class="st"> </span><span class="kw">length</span>(object<span class="op">$</span>models)</span>
<span id="cb48-5"><a href="bagging.html#cb48-5"></a>  N &lt;-<span class="st"> </span><span class="kw">nrow</span>(newdata)</span>
<span id="cb48-6"><a href="bagging.html#cb48-6"></a>  </span>
<span id="cb48-7"><a href="bagging.html#cb48-7"></a>  <span class="co"># Matrix to store predictions for each instance</span></span>
<span id="cb48-8"><a href="bagging.html#cb48-8"></a>  <span class="co"># in newdata and for each tree.</span></span>
<span id="cb48-9"><a href="bagging.html#cb48-9"></a>  M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>,N <span class="op">*</span><span class="st"> </span>ntrees), <span class="dt">nrow =</span> N)</span>
<span id="cb48-10"><a href="bagging.html#cb48-10"></a>  </span>
<span id="cb48-11"><a href="bagging.html#cb48-11"></a>  <span class="co"># Populate matrix.</span></span>
<span id="cb48-12"><a href="bagging.html#cb48-12"></a>  <span class="co"># Each column of M contains all predictions for a given tree.</span></span>
<span id="cb48-13"><a href="bagging.html#cb48-13"></a>  <span class="co"># Each row contains the predictions for a given instance.</span></span>
<span id="cb48-14"><a href="bagging.html#cb48-14"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ntrees){</span>
<span id="cb48-15"><a href="bagging.html#cb48-15"></a>    m &lt;-<span class="st"> </span>object<span class="op">$</span>models[[i]]</span>
<span id="cb48-16"><a href="bagging.html#cb48-16"></a>    tmp &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">predict</span>(m, newdata, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>))</span>
<span id="cb48-17"><a href="bagging.html#cb48-17"></a>    M[,i] &lt;-<span class="st"> </span>tmp</span>
<span id="cb48-18"><a href="bagging.html#cb48-18"></a>  }</span>
<span id="cb48-19"><a href="bagging.html#cb48-19"></a>  </span>
<span id="cb48-20"><a href="bagging.html#cb48-20"></a>  <span class="co"># Final predictions</span></span>
<span id="cb48-21"><a href="bagging.html#cb48-21"></a>  predictions &lt;-<span class="st"> </span><span class="kw">character</span>()</span>
<span id="cb48-22"><a href="bagging.html#cb48-22"></a>  </span>
<span id="cb48-23"><a href="bagging.html#cb48-23"></a>  <span class="co"># Iterate through each row of M.</span></span>
<span id="cb48-24"><a href="bagging.html#cb48-24"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N){</span>
<span id="cb48-25"><a href="bagging.html#cb48-25"></a>    <span class="co"># Compute class counts</span></span>
<span id="cb48-26"><a href="bagging.html#cb48-26"></a>    classCounts &lt;-<span class="st"> </span><span class="kw">table</span>(M[i,])</span>
<span id="cb48-27"><a href="bagging.html#cb48-27"></a>    </span>
<span id="cb48-28"><a href="bagging.html#cb48-28"></a>    <span class="co"># Get the class with the most counts.</span></span>
<span id="cb48-29"><a href="bagging.html#cb48-29"></a>    predictions &lt;-<span class="st"> </span><span class="kw">c</span>(predictions,</span>
<span id="cb48-30"><a href="bagging.html#cb48-30"></a>                     <span class="kw">names</span>(classCounts)[<span class="kw">which.max</span>(classCounts)])</span>
<span id="cb48-31"><a href="bagging.html#cb48-31"></a>  }</span>
<span id="cb48-32"><a href="bagging.html#cb48-32"></a>  <span class="kw">return</span>(predictions)</span>
<span id="cb48-33"><a href="bagging.html#cb48-33"></a>}</span></code></pre></div>
<p>Now let’s dissect the <code>predict.my_bagging()</code> function. First, note that the function name starts with <code>predict.</code> followed by the type of object. Following this convention will allow us to call <code>predict()</code> and R will call the corresponding method based on the class of the object. The first argument <code>object</code> is an object of type “my_bagging” as returned by <code>my_bagging()</code>. The second argument <code>newdata</code> is the test set we want to generate predictions for. A matrix <code>M</code> that will store the predictions for each tree is defined. This matrix has <span class="math inline">\(N\)</span> rows and <span class="math inline">\(ntrees\)</span> columns where <span class="math inline">\(N\)</span> is the number of instances in <code>newdata</code> and <span class="math inline">\(ntrees\)</span> is the number of trees. Thus, each column stores the predictions for each of the base learners. This function iterates through each base learner (rpart in this case), and makes a prediction for each instance in <code>newdata</code>. Then, the results are stored in matrix <code>M</code>. Finally, it iterates through each instance and computes the most common predicted class from the base learners.</p>
<p>Let’s test our Bagging function! We will test it with the activity recognition dataset introduced in section <a href="decision-trees.html#activityRecognition">2.3.1</a> and set the number of trees to <span class="math inline">\(10\)</span>. The following code shows how we would use our bagging functions to train the model and make predictions on a test set.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="bagging.html#cb49-1"></a>baggingClassifier &lt;-<span class="st"> </span><span class="kw">my_bagging</span>(class <span class="op">~</span><span class="st"> </span>., trainSet, <span class="dt">ntree =</span> <span class="dv">10</span>)</span>
<span id="cb49-2"><a href="bagging.html#cb49-2"></a>predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(baggingClassifier, testSet)</span></code></pre></div>
<p>The following will perform <span class="math inline">\(5\)</span>-fold cross-validation and print the results.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="bagging.html#cb50-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb50-2"><a href="bagging.html#cb50-2"></a>k &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb50-3"><a href="bagging.html#cb50-3"></a>folds &lt;-<span class="st"> </span><span class="kw">sample</span>(k, <span class="dt">size =</span> <span class="kw">nrow</span>(df), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb50-4"><a href="bagging.html#cb50-4"></a></span>
<span id="cb50-5"><a href="bagging.html#cb50-5"></a><span class="co"># Variable to store ground truth classes.</span></span>
<span id="cb50-6"><a href="bagging.html#cb50-6"></a>groundTruth &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb50-7"><a href="bagging.html#cb50-7"></a></span>
<span id="cb50-8"><a href="bagging.html#cb50-8"></a><span class="co"># Variable to store the classifier&#39;s predictions.</span></span>
<span id="cb50-9"><a href="bagging.html#cb50-9"></a>predictions &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb50-10"><a href="bagging.html#cb50-10"></a></span>
<span id="cb50-11"><a href="bagging.html#cb50-11"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k){</span>
<span id="cb50-12"><a href="bagging.html#cb50-12"></a>  trainSet &lt;-<span class="st"> </span>df[<span class="kw">which</span>(folds <span class="op">!=</span><span class="st"> </span>i), ]</span>
<span id="cb50-13"><a href="bagging.html#cb50-13"></a>  testSet &lt;-<span class="st"> </span>df[<span class="kw">which</span>(folds <span class="op">==</span><span class="st"> </span>i), ]</span>
<span id="cb50-14"><a href="bagging.html#cb50-14"></a>  treeClassifier &lt;-<span class="st"> </span><span class="kw">my_bagging</span>(class <span class="op">~</span><span class="st"> </span>., trainSet, <span class="dt">ntree =</span> <span class="dv">10</span>)</span>
<span id="cb50-15"><a href="bagging.html#cb50-15"></a>  foldPredictions &lt;-<span class="st"> </span><span class="kw">predict</span>(treeClassifier, testSet)</span>
<span id="cb50-16"><a href="bagging.html#cb50-16"></a>  predictions &lt;-<span class="st"> </span><span class="kw">c</span>(predictions, <span class="kw">as.character</span>(foldPredictions))</span>
<span id="cb50-17"><a href="bagging.html#cb50-17"></a>  groundTruth &lt;-<span class="st"> </span><span class="kw">c</span>(groundTruth, <span class="kw">as.character</span>(testSet<span class="op">$</span>class))</span>
<span id="cb50-18"><a href="bagging.html#cb50-18"></a>}</span>
<span id="cb50-19"><a href="bagging.html#cb50-19"></a>cm &lt;-<span class="st"> </span><span class="kw">confusionMatrix</span>(<span class="kw">as.factor</span>(predictions), <span class="kw">as.factor</span>(groundTruth))</span>
<span id="cb50-20"><a href="bagging.html#cb50-20"></a></span>
<span id="cb50-21"><a href="bagging.html#cb50-21"></a><span class="co"># Print accuracy</span></span>
<span id="cb50-22"><a href="bagging.html#cb50-22"></a>cm<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb50-23"><a href="bagging.html#cb50-23"></a><span class="co">#&gt; Accuracy </span></span>
<span id="cb50-24"><a href="bagging.html#cb50-24"></a><span class="co">#&gt; 0.861388</span></span>
<span id="cb50-25"><a href="bagging.html#cb50-25"></a></span>
<span id="cb50-26"><a href="bagging.html#cb50-26"></a><span class="co"># Print other metrics per class.</span></span>
<span id="cb50-27"><a href="bagging.html#cb50-27"></a>cm<span class="op">$</span>byClass[,<span class="kw">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>, <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)]</span>
<span id="cb50-28"><a href="bagging.html#cb50-28"></a><span class="co">#&gt;                      Recall Specificity Precision        F1</span></span>
<span id="cb50-29"><a href="bagging.html#cb50-29"></a><span class="co">#&gt; Class: Downstairs 0.5378788   0.9588957 0.5855670 0.5607108</span></span>
<span id="cb50-30"><a href="bagging.html#cb50-30"></a><span class="co">#&gt; Class: Jogging    0.9618462   0.9820722 0.9583078 0.9600737</span></span>
<span id="cb50-31"><a href="bagging.html#cb50-31"></a><span class="co">#&gt; Class: Sitting    0.9607843   0.9982394 0.9702970 0.9655172</span></span>
<span id="cb50-32"><a href="bagging.html#cb50-32"></a><span class="co">#&gt; Class: Standing   0.9146341   0.9988399 0.9740260 0.9433962</span></span>
<span id="cb50-33"><a href="bagging.html#cb50-33"></a><span class="co">#&gt; Class: Upstairs   0.5664557   0.9563310 0.6313933 0.5971643</span></span>
<span id="cb50-34"><a href="bagging.html#cb50-34"></a><span class="co">#&gt; Class: Walking    0.9336857   0.9226850 0.8827806 0.9075199</span></span>
<span id="cb50-35"><a href="bagging.html#cb50-35"></a></span>
<span id="cb50-36"><a href="bagging.html#cb50-36"></a><span class="co"># Print average performance metrics across classes.</span></span>
<span id="cb50-37"><a href="bagging.html#cb50-37"></a><span class="kw">colMeans</span>(cm<span class="op">$</span>byClass[,<span class="kw">c</span>(<span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Specificity&quot;</span>, <span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;F1&quot;</span>)])</span>
<span id="cb50-38"><a href="bagging.html#cb50-38"></a><span class="co">#&gt;     Recall Specificity   Precision          F1 </span></span>
<span id="cb50-39"><a href="bagging.html#cb50-39"></a><span class="co">#&gt;  0.8125475   0.9695105   0.8337286   0.8223970</span></span></code></pre></div>
<p>The accuracy was much better now compared to <span class="math inline">\(0.789\)</span> from the previous chapter without using Bagging!.</p>
<p>We can also check what is the effect of adding more trees to the ensemble. The script <code>iterated_bagging_activities.R</code> does <span class="math inline">\(5\)</span>-fold cross-validation as we just did but starting with <span class="math inline">\(1\)</span> tree in the ensemble and repeating the process by adding more trees until <span class="math inline">\(50\)</span>.</p>
<p>Figure <a href="bagging.html#fig:iteratedBagging">3.2</a> shows the effect on the train and test accuracy with different number of trees. Here, we can see that <span class="math inline">\(3\)</span> trees already produce a significant performance increase compared to <span class="math inline">\(1\)</span> or <span class="math inline">\(2\)</span> trees. This makes sense since having only <span class="math inline">\(2\)</span> trees does not add additional information. If the two trees produce different predictions then, it becomes a random choice between the two labels. In fact, <span class="math inline">\(2\)</span> trees produced worse results than <span class="math inline">\(1\)</span> tree. But we cannot make strong conclusions since the experiment was run only once. One possibility to break ties when there are only two trees is to use the averaged probabilities of each label. rpart can return those probabilities by setting <code>type = "prob"</code> in the <code>predict()</code> function which is the default behavior. This is left as an exercise for the reader. In the following section, Random Forest will be described which is a way of introducing more diversity to the base learners.</p>
<div class="figure" style="text-align: center"><span id="fig:iteratedBagging"></span>
<img src="images/iterated_bagging.png" alt="Bagging results for different number of trees." width="100%" />
<p class="caption">
Figure 3.2: Bagging results for different number of trees.
</p>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-breimanBagging1996">
<p>Breiman, Leo. 1996. “Bagging Predictors.” <em>Machine Learning</em> 24 (2): 123–40. <a href="https://doi.org/10.1023/A:1018054314350">https://doi.org/10.1023/A:1018054314350</a>.</p>
</div>
<div id="ref-molnarInterpretable">
<p>Molnar, Christoph. 2019. <em>Interpretable Machine Learning. A Guide for Making Black Box Models Explainable</em>. Leanpub.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ensemble.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="random-forest.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
